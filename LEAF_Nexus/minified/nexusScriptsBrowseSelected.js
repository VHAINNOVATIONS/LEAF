function employeeSelector(t){this.apiPath="./api/?a=",this.rootPath="",this.useJSONP=0,this.selection="",this.containerID=t,this.prefixID="empSel"+Math.floor(1e3*Math.random())+"_",this.timer=0,this.q="",this.isBusy=1,this.backgroundImage="images/indicator.gif",this.intervalID=null,this.selectHandler=null,this.resultHandler=null,this.selectLink=null,this.selectionData=new Object,this.optionNoLimit=0,this.currRequest=null,this.outputStyle="standard",this.emailHref=!1,this.numResults=0}function dialogController(t,e,i,o,r){this.containerID=t,this.contentID=e,this.indicatorID=i,this.btnSaveID=o,this.btnCancelID=r,this.dialogControllerXhrEvent=null,this.prefixID="dialog"+Math.floor(1e3*Math.random())+"_",this.validators=new Object,this.validatorErrors=new Object,this.validatorOks=new Object,this.invalid=0,$("#"+this.containerID).dialog({autoOpen:!1,modal:!0,height:"auto",width:"auto"}),this.clearDialog();var a=this;$("#"+this.btnCancelID).on("click",function(){a.hide()})}function orgchartForm(t){this.containerID=t,this.prefixID="orgForm"+Math.floor(1e3*Math.random())+"_",this.dialog=null,this.updateEvents=new Object,this.currUID=null}employeeSelector.prototype.initialize=function(){var t=this;$("#"+this.containerID).html('<div id="'+this.prefixID+'border" class="employeeSelectorBorder">\t\t\t<div style="float: left"><img id="'+this.prefixID+'icon" src="'+t.rootPath+'../libs/dynicons/?img=search.svg&w=16" class="employeeSelectorIcon" alt="search" />\t\t\t<img id="'+this.prefixID+'iconBusy" src="'+t.rootPath+'images/indicator.gif" style="display: none" class="employeeSelectorIcon" alt="busy" /></div>\t\t\t<input id="'+this.prefixID+'input" type="search" class="employeeSelectorInput" aria-label="search input"></input></div>\t\t\t<div id="'+this.prefixID+'result" aria-label="search results"></div>'),$("#"+this.prefixID+"input").on("keydown",function(e){t.showBusy(),t.timer=0,13==e.keyCode&&t.search()}),this.showNotBusy(),this.intervalID=setInterval(function(){t.search()},200)},employeeSelector.prototype.showNotBusy=function(){1==this.isBusy&&($("#"+this.prefixID+"icon").css("display","inline"),$("#"+this.prefixID+"iconBusy").css("display","none"),this.isBusy=0)},employeeSelector.prototype.showBusy=function(){$("#"+this.prefixID+"icon").css("display","none"),$("#"+this.prefixID+"iconBusy").css("display","inline"),this.isBusy=1},employeeSelector.prototype.select=function(t){this.selection=t,$.each($("#"+this.containerID+" .employeeSelected"),function(t,e){$("#"+e.id).removeClass("employeeSelected"),$("#"+e.id).addClass("employeeSelector")}),$("#"+this.prefixID+"emp"+t).removeClass("employeeSelector"),$("#"+this.prefixID+"emp"+t).addClass("employeeSelected"),null!=this.selectHandler&&this.selectHandler()},employeeSelector.prototype.setSelectHandler=function(t){this.selectHandler=t},employeeSelector.prototype.setResultHandler=function(t){this.resultHandler=t},employeeSelector.prototype.setSelectLink=function(t){this.selectLink=t},employeeSelector.prototype.clearSearch=function(){$("#"+this.prefixID+"input").val("")},employeeSelector.prototype.forceSearch=function(t){$("#"+this.prefixID+"input").val(t.replace(/<[^>]*>/g,""))},employeeSelector.prototype.hideInput=function(){$("#"+this.prefixID+"border").css("display","none")},employeeSelector.prototype.showInput=function(){$("#"+this.prefixID+"border").css("display","block")},employeeSelector.prototype.hideResults=function(){$("#"+this.prefixID+"result").css("display","none")},employeeSelector.prototype.showResults=function(){$("#"+this.prefixID+"result").css("display","inline")},employeeSelector.prototype.getSelectorFunction=function(t){var e=this;return function(){e.select(t)}},employeeSelector.prototype.enableNoLimit=function(){this.optionNoLimit=1},employeeSelector.prototype.search=function(){if(void 0==$("#"+this.prefixID+"input").val()||null==$("#"+this.prefixID+"input"))return clearInterval(this.intervalID),!1;if(this.timer+=this.timer>5e3?0:200,this.timer>300){var t=$("#"+this.prefixID+"input").val().replace(/<[^>]*>/g,"");if(""!=t&&t!=this.q){this.q=t,null!=this.currRequest&&this.currRequest.abort();var e={url:this.apiPath+"employee/search",dataType:"json",data:{q:this.q,noLimit:this.optionNoLimit},success:function(e){i.currRequest=null,i.numResults=0,i.selection="",$("#"+i.prefixID+"result").html("");var o="";o="micro"==i.outputStyle?'<table class="employeeSelectorTable"><tr><th>Name</th><th>Contact</th></tr><tbody id="'+i.prefixID+'result_table"></tbody></table>':'<table class="employeeSelectorTable"><tr><th>Name</th><th>Location</th><th>Contact</th></tr><tbody id="'+i.prefixID+'result_table"></tbody></table>',$("#"+i.prefixID+"result").html(o),0==e.length&&$("#"+i.prefixID+"result_table").append('<tr id="'+i.prefixID+'emp0"><td style="font-size: 120%; background-color: white; text-align: center" colspan=3>No results for &quot;<span style="color: red">'+t+"</span>&quot;</td></tr>"),i.selectionData=new Object;for(var r in e){i.selectionData[e[r].empUID]=e[r];var a=void 0!=e[r].data[1]&&""!=e[r].data[1].data?'<img class="employeeSelectorPhoto" src="'+i.rootPath+"image.php?categoryID=1&amp;UID="+e[r].empUID+'&amp;indicatorID=1" alt="photo" />':"",s=void 0!=e[r].positionData?e[r].positionData.positionTitle:"",l="";if(void 0!=e[r].serviceData&&void 0!=e[r].serviceData[0]&&null!=e[r].serviceData[0].groupTitle){var n=0,c="";for(var p in e[r].serviceData)n>0&&(c=" - "),l+=c+(null==e[r].serviceData[p].groupAbbreviation?e[r].serviceData[p].groupTitle:e[r].serviceData[p].groupAbbreviation)+"<br />",n++}room="",void 0!=e[r].data[8]&&""!=e[r].data[8].data&&(room=e[r].data[8].data);var d="";d=i.emailHref?void 0!=e[r].data[6]?'<b>Email:</b> <a href="mailto:'+e[r].data[6].data+'" onclick="event.stopPropagation();">'+e[r].data[6].data+"</a><br />":"":void 0!=e[r].data[6]?"<b>Email:</b> "+e[r].data[6].data+"<br />":"",phone=void 0!=e[r].data[5]?"<b>Phone:</b> "+e[r].data[5].data+"<br />":"",midName=""==e[r].middleName?"":"&nbsp;"+e[r].middleName+".",linkText=e[r].lastName+", "+e[r].firstName+midName,null!=i.selectLink&&(linkText='<a href="'+i.selectLink+"&empUID="+e[r].empUID+'">'+linkText+"</a>"),"micro"==i.outputStyle?$("#"+i.prefixID+"result_table").append('<tr id="'+i.prefixID+"emp"+e[r].empUID+'">\t\t\t                \t\t\t<td class="employeeSelectorName" title="'+e[r].empUID+" - "+e[r].userName+'">'+a+linkText+'<br /><span class="employeeSelectorTitle">'+s+'</span></td>\t\t\t                \t\t\t<td class="employeeSelectorContact">'+d+phone+"</td>\t\t\t                \t\t\t</tr>"):$("#"+i.prefixID+"result_table").append('<tr id="'+i.prefixID+"emp"+e[r].empUID+'">\t\t\t                \t\t\t<td class="employeeSelectorName" title="'+e[r].empUID+" - "+e[r].userName+'">'+a+linkText+'<br /><span class="employeeSelectorTitle">'+s+'</span></td>\t\t                    \t\t\t<td class="employeeSelectorService">'+l+"<span>"+room+'</span></td>\t\t                    \t\t\t<td class="employeeSelectorContact">'+d+phone+"</td>\t\t\t                \t\t\t</tr>"),$("#"+i.prefixID+"emp"+e[r].empUID).addClass("employeeSelector"),$("#"+i.prefixID+"emp"+e[r].empUID).on("click",i.getSelectorFunction(e[r].empUID)),i.numResults++}if(1==i.numResults&&(i.selection=e[r].empUID),i.numResults>=5){var h=3;"micro"==i.outputStyle&&(h=2),$("#"+i.prefixID+"result_table").append('<tr id="'+i.prefixID+'tip">\t\t                \t\t\t<td class="employeeSelectorName" colspan="'+h+'" style="background-color: white; text-align: center; font-weight: normal">&#x1f4a1; Can&apos;t find someone? Trying searching their Email address</td>\t\t                \t\t\t</tr>')}null!=i.resultHandler&&i.resultHandler(),i.showNotBusy()},cache:!1},i=this;1==this.useJSONP&&(e.url+="&format=jsonp",e.dataType="jsonp"),this.currRequest=$.ajax(e)}else""==t?(this.q=t,$("#"+this.prefixID+"result").html(""),this.numResults=0,this.selection="",null!=this.resultHandler&&this.resultHandler(),this.showNotBusy()):this.showNotBusy()}},dialogController.prototype.clearDialog=function(){$("#"+this.contentID).empty(),$("#"+this.containerID).dialog("option","title","Org. Chart Editor"),$("#"+this.btnSaveID).off()},dialogController.prototype.setTitle=function(t){$("#"+this.containerID).dialog("option","title",t)},dialogController.prototype.hide=function(){$("#"+this.containerID).dialog("close"),this.clearDialog()},dialogController.prototype.show=function(){""==$("#"+this.contentID).html()&&$("#"+this.indicatorID).css("visibility","visible"),$("#"+this.containerID).dialog("open"),$("#"+this.containerID).css("visibility","visible"),$("input:visible:first, select:visible:first").focus()},dialogController.prototype.setContent=function(t){this.clearValidators(),$("#"+this.contentID).empty().html(t),$("#"+this.indicatorID).css("visibility","hidden")},dialogController.prototype.indicateBusy=function(){$("#"+this.indicatorID).css("visibility","visible")},dialogController.prototype.indicateIdle=function(t){$("#"+this.indicatorID).css("visibility","hidden")},dialogController.prototype.enableLiveValidation=function(){var t=this;$('input[type="text"]').on("keyup",function(){t.isValid()})},dialogController.prototype.isValid=function(){this.invalid=0;for(var t in this.validators)this.validators[t]()?void 0!=this.validatorOks[t]&&this.validatorOks[t]():(this.invalid=1,void 0!=this.validatorErrors[t]?this.validatorErrors[t]():alert("Data entry error. Please check your input."));return 1==this.invalid?0:1},dialogController.prototype.setSaveHandler=function(t){$("#"+this.btnSaveID).off();var e=this;this.dialogControllerXhrEvent=$("#"+this.btnSaveID).on("click",function(){1==e.isValid()&&t()})},dialogController.prototype.setCancelHandler=function(t){$("#"+this.containerID).off(),$("#"+this.containerID).on("dialogclose",function(){t()})},dialogController.prototype.setJqueryButtons=function(t){$("#"+this.containerID).dialog("option","buttons",t)},dialogController.prototype.clickSave=function(){$("#"+this.btnSaveID).click()},dialogController.prototype.setValidator=function(t,e){this.validators[t]=e},dialogController.prototype.clearValidators=function(){this.validators=new Object,this.validatorErrors=new Object},dialogController.prototype.setValidatorError=function(t,e){this.validatorErrors[t]=e},dialogController.prototype.setValidatorOk=function(t,e){this.validatorOks[t]=e},orgchartForm.prototype.initialize=function(){$("#"+this.containerID).html('<div id="'+this.prefixID+'xhrDialog" style="visibility: hidden">\t\t\t\t<form id="'+this.prefixID+'record" enctype="multipart/form-data" action="javascript:void(0);">\t\t\t\t    <div>\t\t\t\t        <button id="'+this.prefixID+'button_cancelchange" class="buttonNorm" style="position: absolute; left: 10px"><img src="../libs/dynicons/?img=process-stop.svg&amp;w=16" alt="cancel" /> Cancel</button>\t\t\t\t        <button id="'+this.prefixID+'button_save" class="buttonNorm" style="position: absolute; right: 10px"><img src="../libs/dynicons/?img=media-floppy.svg&amp;w=16" alt="save" /> Save Change</button>\t\t\t\t        <div style="border-bottom: 2px solid black; line-height: 30px"><br /></div>\t\t\t\t        <div id="'+this.prefixID+'loadIndicator" style="visibility: hidden; position: absolute; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; height: 300px; width: 460px">Loading... <img src="images/largespinner.gif" alt="loading..." /></div>\t\t\t\t        <div id="'+this.prefixID+'xhr" style="width: 500px; height: 400px; overflow: auto"></div>\t\t\t\t    </div>\t\t\t\t</form>\t\t\t\t</div>'),this.dialog=new dialogController(this.prefixID+"xhrDialog",this.prefixID+"xhr",this.prefixID+"loadIndicator",this.prefixID+"button_save",this.prefixID+"button_cancelchange")},orgchartForm.prototype.getForm=function(t,e,i){this.currUID=t,this.dialog.clearDialog();var o=this.dialog,r=this;switch(e){case 1:$.ajax({url:"ajaxEmployee.php?a=getindicator&empUID="+t+"&indicatorID="+i,success:function(t){o.setContent(t),$("input:visible:first, select:visible:first").focus(),$("input:visible:first, select:visible:first").keypress(function(t){13==t.which&&$("#"+o.btnSaveID).trigger("click")})},error:function(t,e,i){o.setContent("Error: "+i)},cache:!1}),this.dialog.setSaveHandler(function(){$.ajax({type:"POST",url:"./api/?a=employee/"+t,data:$("#"+r.prefixID+"record").serialize(),success:function(a,s){o.hide(),r.updateFormDisplay(t,e,i)},cache:!1})}),this.dialog.show();break;case 2:$.ajax({url:"ajaxPosition.php?a=getindicator&pID="+t+"&indicatorID="+i,success:function(t){o.setContent(t),$("input:visible:first, select:visible:first").focus(),$("input:visible:first, select:visible:first").keypress(function(t){13==t.which&&$("#"+o.btnSaveID).trigger("click")})},error:function(t,e,i){o.setContent("Error: "+i)},cache:!1}),this.dialog.setSaveHandler(function(){$.ajax({type:"POST",url:"./api/?a=position/"+t,data:$("#"+r.prefixID+"record").serialize(),success:function(a){o.hide(),r.updateFormDisplay(t,e,i)},cache:!1})}),this.dialog.show();break;case 3:$.ajax({url:"ajaxGroup.php?a=getindicator&groupID="+t+"&indicatorID="+i,success:function(t){o.setContent(t),$("input:visible:first, select:visible:first").focus(),$("input:visible:first, select:visible:first").keypress(function(t){13==t.which&&$("#"+o.btnSaveID).trigger("click")})},error:function(t,e,i){o.setContent("Error: "+i)},cache:!1}),this.dialog.setSaveHandler(function(){$.ajax({type:"POST",url:"./api/?a=group/"+t,data:$("#"+r.prefixID+"record").serialize(),success:function(a,s){o.hide(),r.updateFormDisplay(t,e,i)},cache:!1})}),this.dialog.show();break;default:alert("default")}},orgchartForm.prototype.updateFormDisplay=function(t,e,i){var o=this;switch(e){case 1:$.ajax({url:"ajaxEmployee.php?a=getFormContent&indicatorID="+i+"&empUID="+t,success:function(r){$("#xhrIndicator_"+i+"_"+e+"_"+t).empty(),$("#xhrIndicator_"+i+"_"+e+"_"+t).html(r),$("#xhrIndicator_"+i+"_"+e+"_"+t).fadeOut(250).fadeIn(250),o.handleUpdateEvents(r,i)},cache:!1});break;case 2:$.ajax({url:"ajaxPosition.php?a=getFormContent&indicatorID="+i+"&pID="+t,success:function(r){$("#xhrIndicator_"+i+"_"+e+"_"+t).empty(),$("#xhrIndicator_"+i+"_"+e+"_"+t).html(r),$("#xhrIndicator_"+i+"_"+e+"_"+t).fadeOut(250).fadeIn(250),o.handleUpdateEvents(r,i)},cache:!1});break;case 3:$.ajax({url:"ajaxGroup.php?a=getFormContent&indicatorID="+i+"&groupID="+t,success:function(r){$("#xhrIndicator_"+i+"_"+e+"_"+t).empty(),$("#xhrIndicator_"+i+"_"+e+"_"+t).html(r),$("#xhrIndicator_"+i+"_"+e+"_"+t).fadeOut(250).fadeIn(250),o.handleUpdateEvents(r,i)},cache:!1});break;default:alert("Unhandled categoryID")}},orgchartForm.prototype.addUpdateEvent=function(t,e){this.updateEvents[t]=e},orgchartForm.prototype.handleUpdateEvents=function(t,e){this.updateEvents[e]&&this.updateEvents[e](t)};