var form,workflow,formValidator={},LeafForm=function(t){t=t;var a,n,r="LeafForm"+Math.floor(1e3*Math.random())+"_",d=r+"record",i=0;function o(){if(0==i)return console.log("recordID not set"),0;var e=$("#"+a.btnSaveID).html();$("#"+a.btnSaveID).empty().html('<img src="images/indicator.gif" alt="saving" /> Saving...'),$("#"+d).find(":input:disabled").removeAttr("disabled");var o={recordID:i};$("#"+d).serializeArray().map(function(t){o[t.name]=t.value}),$.ajax({type:"POST",url:"ajaxIndex.php?a=domodify",data:o,dataType:"text",success:function(t){null!=n&&n(),$("#"+a.btnSaveID).empty().html(e)},cache:!1})}return $("#"+t).html('<div id="'+r+'xhrDialog" style="display: none; background-color: white; border-style: none solid solid; border-width: 0 1px 1px; border-color: #e0e0e0; padding: 4px">\t\t\t<form id="'+r+'record" enctype="multipart/form-data" action="javascript:void(0);">\t\t\t    <div>\t\t\t        <button id="'+r+'button_cancelchange" class="buttonNorm" style="position: absolute; left: 10px"><img src="../libs/dynicons/?img=process-stop.svg&amp;w=16" alt="cancel" /> Cancel</button>\t\t\t        <button id="'+r+'button_save" class="buttonNorm" style="position: absolute; right: 10px"><img src="../libs/dynicons/?img=media-floppy.svg&amp;w=16" alt="save" /> Save Change</button>\t\t\t        <div style="border-bottom: 2px solid black; line-height: 30px"><br /></div>\t\t\t        <div id="'+r+'loadIndicator" style="visibility: hidden; position: absolute; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; height: 300px; width: 460px">Loading... <img src="images/largespinner.gif" alt="loading..." /></div>\t\t\t        <div id="'+r+'xhr" style="width: 540px; height: 420px; padding: 8px; overflow: auto"></div>\t\t\t    </div>\t\t\t</form>\t\t\t</div>'),a=new dialogController(r+"xhrDialog",r+"xhr",r+"loadIndicator",r+"button_save",r+"button_cancelchange"),{dialog:function(){return a},getHtmlFormID:function(){return d},serializeData:function(){return $("#"+d).serialize()},setRecordID:function(t){i=t},setPostModifyCallback:function(t){n=t},doModify:o,getForm:function(t,e){if(0==i)return console.log("recordID not set"),0;a.indicateBusy(),a.setSaveHandler(function(){o()}),formValidator=new Object,formRequired=new Object,$.ajax({type:"GET",url:"ajaxIndex.php?a=getindicator&recordID="+i+"&indicatorID="+t+"&series="+e,dataType:"text",success:function(t){for(var e in a.setTitle("Editing #"+i),a.setContent(t),formValidator){var o=e.slice(2);a.setValidator(o,formValidator[e].setValidator),a.setValidatorError(o,formValidator[e].setValidatorError),a.setValidatorOk(o,formValidator[e].setValidatorOk)}for(var e in formRequired)o=e.slice(2),a.setRequired(o,formRequired[e].setRequired),a.setRequiredError(o,formRequired[e].setRequiredError),a.setRequiredOk(o,formRequired[e].setRequiredOk);a.enableLiveValidation()},error:function(t){a.setContent("Error: "+t)},cache:!1})},initCustom:function(t,e,o,n,i){a=new dialogController(t,e,o,n,i),r="",d="record"},setHtmlFormID:function(t){d=t}}},workflowModule=new Object,LeafWorkflow=function(a,d){a=a,d=d,Math.floor(1e3*Math.random());var i,s=0,l=0;function c(t){return bgColor=parseInt(t.substring(1),16),r=(16711680&bgColor)>>16,g=(65280&bgColor)>>8,b=255&bgColor,factor=-.1,r+=Math.round(r*factor),g+=Math.round(g*factor),b+=Math.round(b*factor),"#"+((r<<16)+(g<<8)+b).toString(16)}function p(n){if(1==l)return 1;l=1,$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Applying action... <img src="images/largespinner.gif" alt="loading..." /></div>'),$.ajax({type:"POST",url:"api/?a=formWorkflow/"+s+"/apply",data:n,success:function(t){if(0==t.errors.length)$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Action applied!</div>'),$("#workflowbox_dep"+n.dependencyID).hide("blind",500),h(s),null!=i&&i();else{var e="";for(var o in t.errors)e+=t.errors[o]+"<br />";$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%"><img src="../libs/dynicons/?img=dialog-error.svg&w=48" style="vertical-align: middle" alt="error icon" /> '+e+'<br /><span style="font-size: 14px; font-weight: normal">After resolving the errors, <button id="workflowbtn_tryagain" class="buttonNorm">click here to try again</button>.</span></div>'),$("#workflowbtn_tryagain").on("click",function(){h(s)})}l=0},error:function(t){$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Error: Workflow Events may not have triggered</div>')}})}function u(t){var e=null==t.description?"Your workflow is missing a requirement. Please check your workflow.":t.description;for(var o in $("#"+a).append('<div id="workflowbox_dep'+t.dependencyID+'" class="workflowbox">                <span>                <div id="stepDescription_dep'+t.dependencyID+'" style="background-color: '+c(t.stepBgColor)+'; padding: 8px">'+e+'</div>                </span>                <form id="form_dep'+t.dependencyID+'" enctype="multipart/form-data" action="#">                    <div id="form_dep_extension'+t.dependencyID+'"></div>                </form>                </div>'),$("#workflowbox_dep"+t.dependencyID).css({padding:"0px","background-color":t.stepBgColor,border:t.stepBorder}),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"120%","font-weight":"bold",color:t.stepFontColor}),$("#form_dep"+t.dependencyID).append('<div id="form_dep_container'+t.dependencyID+'">                <span class="noprint" aria-label="comments">Comments:</span><br />                <textarea id="comment_dep'+t.dependencyID+'" aria-label="comment text area"></textarea>                </div>'),$("#form_dep_container"+t.dependencyID).css({margin:"auto",width:"95%",padding:"8px"}),$("#workflowbox_dep"+t.dependencyID).append('<br style="clear: both"/>'),$("#comment_dep"+t.dependencyID).css({height:"40px",width:"100%",padding:"4px",resize:"vertical"}),t.dependencyActions){var n="";""!=t.dependencyActions[o].actionIcon&&(n='<img src="../libs/dynicons/?img='+t.dependencyActions[o].actionIcon+'&amp;w=22" alt="'+t.dependencyActions[o].actionText+'" style="vertical-align: middle" />'),$("#form_dep_container"+t.dependencyID).append('<div id="button_container'+t.dependencyID+"_"+t.dependencyActions[o].actionType+'" style="float: '+t.dependencyActions[o].actionAlignment+'">\t\t            <button type="button" id="button_step'+t.dependencyID+"_"+t.dependencyActions[o].actionType+'" class="button">\t\t            '+n+" "+t.dependencyActions[o].actionText+"\t\t            </button>\t\t            </div>"),$("#button_step"+t.dependencyID+"_"+t.dependencyActions[o].actionType).css({border:"1px solid black",padding:"6px",margin:"4px"}),$("#button_step"+t.dependencyID+"_"+t.dependencyActions[o].actionType).on("click",{step:t,idx:o},function(t){var e=new Object;e.comment=$("#comment_dep"+t.data.step.dependencyID).val(),e.actionType=t.data.step.dependencyActions[t.data.idx].actionType,e.dependencyID=t.data.step.dependencyID,e.CSRFToken=d,0<t.data.step.dependencyActions[t.data.idx].fillDependency&&void 0!==workflowModule[t.data.step.dependencyID]?workflowModule[t.data.step.dependencyID].trigger(function(){p(e)}):p(e)})}for(var i in t.jsSrcList)$.ajax({type:"GET",url:t.jsSrcList[i],dataType:"script",success:function(){workflowModule[t.dependencyID].init(s)}})}function f(e){$("#"+a).append('<div id="workflowbox_dep'+e.dependencyID+'" class="workflowbox"></div>'),$("#workflowbox_dep"+e.dependencyID).css({"background-color":e.stepBgColor,border:e.stepBorder,"text-align":"center",padding:"8px"}),-1==e.dependencyID?$.ajax({type:"GET",url:"api/?a=form/customData/_"+recordID+"/_"+e.indicatorID_for_assigned_empUID,success:function(t){$("#workflowbox_dep"+e.dependencyID).append("<span>Pending action from "+t[recordID].s1["id"+e.indicatorID_for_assigned_empUID]+"</span>"),$("#workflowbox_dep"+e.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:e.stepFontColor})}}):-3==e.dependencyID?$.ajax({type:"GET",url:"api/?a=form/customData/_"+recordID+"/_"+e.indicatorID_for_assigned_groupID,success:function(t){$("#workflowbox_dep"+e.dependencyID).append("<span>Pending action from "+e.description+"</span>"),$("#workflowbox_dep"+e.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:e.stepFontColor})}}):($("#workflowbox_dep"+e.dependencyID).append("<span>Pending "+e.description+"</span>"),$("#workflowbox_dep"+e.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:e.stepFontColor}))}function h(n){$("#"+a).empty(),$("#"+a).css("display","none"),l=0,s=n,$.ajax({type:"GET",url:"api/?a=formWorkflow/"+n+"/currentStep",dataType:"json",success:function(t){for(var e in t)1==t[e].hasAccess?u(t[e]):f(t[e]);var o,i;o=n,i=t,$.ajax({type:"GET",url:"api/?a=formWorkflow/"+o+"/lastAction",dataType:"json",success:function(t){if(null==t)return null==i&&$("#"+a).append("No actions available"),null;t.stepBgColor=null==t.stepBgColor?"#e0e0e0":t.stepBgColor,t.stepFontColor=null==t.stepFontColor?"#000000":t.stepFontColor,t.stepBorder=null==t.stepBorder?"1px solid black":t.stepBorder;var e=5==t.dependencyID?t.categoryName:t.description;if(null!=i){5!=t.dependencyID&&($("#"+a).append('<div id="workflowbox_lastAction" class="workflowbox" style="padding: 0px; margin-top: 8px"></div>'),$("#workflowbox_lastAction").css({"background-color":t.stepBgColor,border:t.stepBorder}));var o=new Date(1e3*t.time),n="";null!=t.description&&null!=t.actionText?(n='<div style="background-color: '+c(t.stepBgColor)+'; padding: 4px"><span style="float: left; font-size: 90%">'+e+": "+t.actionTextPasttense+"</span>",n+='<span style="float: right; font-size: 90%">'+o.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+"</span><br /></div>",""!=t.comment&&null!=t.comment&&(n+='<div style="font-size: 80%; padding: 4px 8px 4px 8px">Comment:<br /><div style="font-weight: normal; padding-left: 16px; font-size: 12px">'+t.comment+"</div></div>")):n="[ Please refer to this request's history for current status ]",5!=t.dependencyID&&$("#workflowbox_lastAction").append('<span style="font-weight: bold; color: '+t.stepFontColor+'">'+n+"</span>")}else $("#workflowcontent").append('<div id="workflowbox_lastAction"></div>'),$("#workflowbox_lastAction").css({"background-color":t.stepBgColor,border:t.stepBorder,"text-align":"center",padding:"0px"}),$("#workflowbox_lastAction").addClass("workflowbox"),o=new Date(1e3*t.time),n="",null!=t.description&&null!=t.actionText?(n='<div style="padding: 4px; background-color: '+c(t.stepBgColor)+'">'+e+": "+t.actionTextPasttense,n+='<br /><span style="font-size: 60%">'+o.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+"</span></div>",""!=t.comment&&null!=t.comment&&(n+='<div style="padding: 4px 16px"><fieldset style="border: 1px solid black"><legend class="noprint">Comment</legend><span style="font-size: 80%; font-weight: normal">'+t.comment+"</span></fieldset></div>")):n="[ Please refer to this request's history for current status. ]",$("#workflowbox_lastAction").append('<span style="font-size: 150%; font-weight: bold", color: '+t.stepFontColor+">"+n+"</span>")},cache:!1}),$("#"+a).show("blind",250)},cache:!1})}return{getWorkflow:h,setActionSuccessCallback:function(t){i=t}}},LeafFormGrid=function(s,t){s=s;var p,u,f="LeafFormGrid"+Math.floor(1e3*Math.random())+"_",h=!0,g=[],m=0,l=!1,y=50,v=50,c="#d1dfff",w={},a=null,b=null,I=null,x="",_=!0,D=!1;$("#"+s).html('<div id="'+f+'grid"></div><div id="'+f+'form" style="display: none"></div>'),$("#"+f+"grid").html('<div style="position: relative"><div id="'+f+'gridToolbar" style="display: none; width: 90px; margin: 0 0 0 auto; text-align: right"></div></div><div id="'+f+'table_stickyHeader" style="display: none"></div><table id="'+f+'table" class="leaf_grid"><thead id="'+f+'thead" aria-label="Search Results"></thead><tbody id="'+f+'tbody"></tbody><tfoot id="'+f+'tfoot"></tfoot></table>'),$("#"+f+"thead").css({"background-color":c}),null==t&&(p=new LeafForm(f+"form"));var S=0;function k(o,t){"recordID"!=o&&v!=1/0&&C(0,1/0),$("."+f+"sort").css("display","none"),"asc"==t.toLowerCase()?($("#"+f+"header_"+o+"_sort").html(" &#9650;"),$("#"+f+"header_"+o+"_sort").css("vertical-align","super")):($("#"+f+"header_"+o+"_sort").html(" &#9660;"),$("#"+f+"header_"+o+"_sort").css("vertical-align","sub")),$("#"+f+"header_"+o+"_sort").css("display","inline");var e,n=[],i=$.isNumeric(o),a=!1,r="id"+o;for(var d in g)g[d].recordID=parseInt(g[d].recordID),null==g[d][o]&&(g[d][o]=$("#"+f+g[d].recordID+"_"+o).html(),g[d][o]=null==g[d][o]?"":g[d][o],g[d][o]=g[d][o].replace(/[\u200B-\u200E]/g,"")),i?(null==g[d].s1&&(g[d].s1={}),null!=g[d].s1[r]&&""!=g[d].s1[r]||(null==g[d].sDate&&(g[d].sDate={}),g[d].s1[r]="",g[d].sDate[o]=0),e=null,!isNaN(g[d].s1[r])||-1==g[d].s1[r].indexOf("-")&&-1==g[d].s1[r].indexOf("/")||(e=Date.parse(g[d].s1[r])),(a||null!=e&&!isNaN(e))&&(a=!0,null==g[d].sDate&&(g[d].sDate={}),g[d].sDate[o]=0,g[d].sDate[o]=isNaN(e)?0:e),$.isNumeric(g[d].s1[r])&&(g[d].s1[r]=parseFloat(g[d].s1[r]))):((e=null)==g[d].sDate&&(g[d].sDate={}),g[d].sDate[o]=0,!isNaN(g[d][o])||-1==g[d][o].indexOf("-")&&-1==g[d][o].indexOf("/")||(e=Date.parse(g[d][o])),(a||null!=e&&!isNaN(e))&&(a=!0,g[d].sDate[o]=isNaN(e)||null==e?0:e)),n.push(g[d]);a?n.sort(function(t,e){return e.sDate[o]>t.sDate[o]?1:e.sDate[o]<t.sDate[o]?-1:0}):$.isNumeric(o)?n.sort(function(t,e){return e.s1[r]>t.s1[r]?1:e.s1[r]<t.s1[r]?-1:0}):"recordID"==o?n.sort(function(t,e){return e[o]>t[o]?1:e[o]<t[o]?-1:0}):n.sort(function(t,e){return null==t[o]&&(t[o]=""),null==e[o]&&(e[o]=""),e[o].toLowerCase()>t[o].toLowerCase()?1:e[o].toLowerCase()<t[o].toLowerCase()?-1:0}),"asc"==t&&n.reverse(),g=n}function T(){if(!_)return!1;var e=[];$("#"+f+"thead>tr>th").each(function(){e.push($(this).css("width"))}),$("#"+f+"table_stickyHeader > table").css({width:$("#"+f+"thead").css("width"),height:"30px"}),$("#"+f+"table_stickyHeader > table > thead > tr > th").each(function(t){$(this).css({width:e[t],padding:"2px","font-weight":"normal"})}),$("#"+f+"table_stickyHeader > table").css({border:"1px solid black","border-collapse":"collapse",margin:"0 2px 0"}),$("#"+f+"table_stickyHeader > table > thead > tr").css({"background-color":"black",color:"white"}),$("#"+f+"table_stickyHeader > table > thead > tr > th").css("border","1px solid #e0e0e0")}function C(t,e){D=!0,null!=b&&b(),null==e&&(e=y),v=e;var o=!1;null!=t&&0!=t||(t=0,$("#"+f+"tbody").empty(),o=!0);var n="",i=[],a=h?u.length+1:u.length;0==g.length&&$("#"+f+"tbody").append('<tr><td colspan="'+a+'" style="text-align: center">No Results</td></tr>');for(var r=0,d=t;d<g.length;d++){if(e<=r){m=d;break}for(var s in n+='<tr id="'+f+"tbody_tr"+g[d].recordID+'">',h&&(n+='<td><a href="index.php?a=printview&recordID='+g[d].recordID+'">'+g[d].recordID+"</a></td>"),u)if(0!=u[s].visible)if(null!=g[d]){var l={};l.recordID=g[d].recordID,l.indicatorID=u[s].indicatorID,l.cellContainerID=f+g[d].recordID+"_"+u[s].indicatorID,l.index=d,l.data="";var c=!1;null!=u[s].editable&&0==u[s].editable||(c=!0),$.isNumeric(l.indicatorID)?(null==g[d].s1&&(g[d].s1={}),l.data=null!=g[d].s1["id"+u[s].indicatorID]?g[d].s1["id"+u[s].indicatorID]:"",n+='<td id="'+f+g[d].recordID+"_"+u[s].indicatorID+'" data-editable="'+c+'" data-record-id="'+g[d].recordID+'" data-indicator-id="'+u[s].indicatorID+'">'+l.data+"</td>"):null!=u[s].callback?n+='<td id="'+f+g[d].recordID+"_"+u[s].indicatorID+'" data-clickable="'+c+'"></td>':n+='<td id="'+f+g[d].recordID+"_"+u[s].indicatorID+'"></td>',null!=u[s].callback&&i.push(function(t,e){return function(){t(e,w)}}(u[s].callback,l))}else n+='<td id="'+f+g[d].recordID+"_"+u[s].indicatorID+'"></td>';n+="</tr>",r++,o&&(m=d+1)}for(var d in m+e>=g.length||null==e?$("#"+f+"tfoot").html(""):$("#"+f+"tfoot").html("<tr><td colspan="+a+' style="padding: 8px; background-color: #feffd1; font-size: 120%; font-weight: bold"><img src="'+x+'images/indicator.gif" style="vertical-align: middle" alt="Loading" /> Loading more results...</td></tr>'),$("#"+f+"tbody").append(n),$("#"+f+"tbody td[data-editable=true]").addClass("table_editable"),$("#"+f+"tbody td[data-clickable=true]").addClass("table_editable"),$("#"+f+"tbody").on("click","td[data-editable=true]",function(t){p.setRecordID($(this).data("record-id"));var e=$(this).data("indicator-id");p.setPostModifyCallback(function(){var i,t;i=e,t=1,$.ajax({type:"GET",url:x+"api/?a=form/"+recordID+"/rawIndicator/"+i+"/"+t,dataType:"json",success:function(t){var e=""!=t[i].displayedValue?t[i].displayedValue:t[i].value;if("checkboxes"==t[i].format&&Array.isArray(e)){var o="";for(var n in e)"no"!=e[n]&&(o+=", "+e[n]);e=o.substr(2)}$("#"+f+recordID+"_"+i).empty().html(e),$("#"+f+recordID+"_"+i).fadeOut(250,function(){$("#"+f+recordID+"_"+i).fadeIn(250)})},cache:!1}),p.dialog().hide()}),p.getForm(e,1),p.dialog().show()}),i)i[d]();$("#"+f+"table>tbody>tr>td").css({border:"1px solid black",padding:"8px","font-size":"12px"}),null!=I&&I(),T()}function n(t){l=!0,g=t}function i(t){w=t}return{getPrefixID:function(){return f},form:function(){return p},headers:function(){return u},getCurrentData:function(){return g},hideIndex:function(){h=!1},setHeaders:function(t){u=t;var e='<tr id="'+f+'thead_tr">',o='<tr id="'+f+'tVirt_tr">';for(var n in h&&(e+='<th id="'+f+'header_UID" style="text-align: center">UID</th>',o+='<th style="text-align: center">UID</th>'),$("#"+f+"thead").html(e),h&&($("#"+f+"header_UID").css("cursor","pointer"),$("#"+f+"header_UID").on("click",null,null,function(t){S=0==S?(k("recordID","asc"),1):(k("recordID","desc"),0),C(0,1/0)}),$("#"+f+"header_UID").on("mouseover",null,null,function(t){$("#"+f+"header_UID").css("background-color","#79a2ff")}),$("#"+f+"header_UID").on("mouseout",null,null,function(t){$("#"+f+"header_UID").css({"background-color":c})})),u)if(0!=u[n].visible){var i=null!=u[n].align?u[n].align:"center";$("#"+f+"thead_tr").append('<th id="'+f+"header_"+u[n].indicatorID+'" tabindex="0"  style="text-align:'+i+'">'+u[n].name+'<span id="'+f+"header_"+u[n].indicatorID+'_sort" class="'+f+'sort"></span></th>'),o+='<th id="Vheader_'+u[n].indicatorID+'" style="text-align:'+i+'">'+u[n].name+"</th>",null!=u[n].sortable&&1!=u[n].sortable||($("#"+f+"header_"+u[n].indicatorID).css("cursor","pointer"),$("#"+f+"header_"+u[n].indicatorID).on("click",null,u[n].indicatorID,function(t){S=0==S?(k(t.data,"asc"),1):(k(t.data,"desc"),0),C(0,1/0)}),$("#"+f+"header_"+u[n].indicatorID).on("keydown",null,u[n].indicatorID,function(t){13==t.keyCode&&(S=0==S?(k(t.data,"asc"),1):(k(t.data,"desc"),0),C(0,1/0))}),$("#"+f+"header_"+u[n].indicatorID).on("mouseover",null,u[n].indicatorID,function(t){$("#"+f+"header_"+t.data).css("background-color","#79a2ff")}),$("#"+f+"header_"+u[n].indicatorID).on("mouseout",null,u[n].indicatorID,function(t){$("#"+f+"header_"+t.data).css({"background-color":c})}))}$("#"+f+"thead").append("</tr>"),o+="</tr>",$("#"+f+"table>thead>tr>th").css({border:"1px solid black",padding:"4px 2px 4px 2px","font-size":"12px"});var a,r=!1;$("#"+f+"table_stickyHeader").html("<table><thead>"+o+"</thead></table>"),$(window).on("resize",function(){T()}),$(window).on("scroll",function(){r=!0});var d=[];setInterval(function(){scrollPos=$(window).scrollTop(),tableHeight=$("#"+f+"table").height(),pageHeight=$(window).height(),r&&null!=$("#"+f+"thead").offset()&&_&&(r=!1,a=$("#"+f+"thead").offset().top,scrollPos>a&&scrollPos<tableHeight+a?($("#"+f+"table_stickyHeader").css("display","inline"),$("#"+f+"table_stickyHeader").css({position:"absolute",top:scrollPos+"px"})):$("#"+f+"table_stickyHeader").css("display","none")),scrollPos>tableHeight-.8*pageHeight&&l&&D&&null==d[m]&&(d[m]=1,C(m,y))},100)},sort:k,renderVirtualHeader:T,renderBody:C,loadData:function(t,i){g=[];var e=h?u.length+1:u.length;$("#"+f+"tbody").html('<tr><td colspan="'+e+'" style="text-align: left; padding: 8px">Building report... <img src="'+x+'images/largespinner.gif" alt="loading..." /></td></tr>');var o="";for(var n in u)$.isNumeric(u[n].indicatorID)&&(o+=u[n].indicatorID+",");$.ajax({type:"POST",url:x+"api/?a=form/customData",dataType:"json",data:{recordList:t,indicatorList:o,CSRFToken:CSRFToken},success:function(t){for(var e in l=!0,t){if(null!=w[e])for(var o in w[e])if("object"==typeof w[e][o])for(var n in w[e][o])t[e][o]=t[e][o]||{},t[e][o][n]=w[e][o][n];else t[e][o]=w[e][o];g.push(t[e])}null!=a&&(g=a(g)),k("recordID","desc"),C(0,y),null!=i&&"function"==typeof i&&i()},cache:!1})},setData:n,setDataBlob:i,importQueryResult:function(t){var e=[];for(var o in t)e.push(t[o]);n(e),i(e)},enableToolbar:function(){s=f+"gridToolbar",$("#"+s).css("display","block"),$("#"+s).html('<button type="button" id="'+f+'getExcel" class="buttonNorm"><img src="../libs/dynicons/?img=x-office-spreadsheet.svg&w=32" alt="Icon of Spreadsheet" /> Export</button>'),$("#"+f+"getExcel").on("click",function(){m!=g.length&&C(0,1/0);var o=[],n=[];$("#"+f+"thead>tr>th").each(function(t,e){n.push($(e).text().trim())});var i={},a=0,r=(document.createElement("a"),n.length-1);$("#"+f+"tbody>tr>td").each(function(t,e){i[n[a]]=$(e).text().trim(),0==a&&"UID"==n[a]&&(i[n[a]]='=HYPERLINK("'+window.location.origin+window.location.pathname+"?a=printview&recordID="+$(e).text().trim()+'", "'+$(e).text().trim()+'")'),r<++a&&(o.push(i),i={},a=0)});var t=$(document.createElement("form"));t.attr({action:x+"api/?a=converter/json&format=csv",method:"POST"});var e=$(document.createElement("input")),d=$(document.createElement("input"));e.attr({type:"hidden",name:"input",value:JSON.stringify(o)}),d.attr({type:"hidden",name:"CSRFToken",value:CSRFToken}),t.append(e),t.append(d),t.appendTo("#"+s),t.submit(),t.remove()})},setPostProcessDataFunc:function(t){a=t},setPreRenderFunc:function(t){b=t},setPostRenderFunc:function(t){I=t},setDefaultLimit:function(t){y=t},getDefaultLimit:function(){return y},getDataByIndex:function(t){return g[t]},getDataByRecordID:function(t){for(var e in g)if(g[e].recordID==t)return g[e];return null},disableVirtualHeader:function(){_=!1},stop:function(){D=!1},setRootURL:function(t){x=t}}},LeafFormQuery=function(){var a={},e=null,o="",n=!1;function t(){a={terms:[],joins:[],sort:{},getData:[]}}function i(t,e,o){var n={};n.id=t,n.operator=e,n.match=o,a.terms.push(n)}function r(t,e,o,n){var i={};i.id=t,i.indicatorID=e,i.operator=o,i.match=n,a.terms.push(i)}function d(t){a.limitOffset=t}function s(t){-1==a.joins.indexOf(t)&&a.joins.push(t)}function l(t){-1==a.getData.indexOf(t)&&a.getData.push(t)}return t(),{clearTerms:t,addTerm:i,addDataTerm:r,importQuery:function(t){for(var e in t.terms)switch(Object.keys(t.terms[e]).length){case 3:i(t.terms[e].id,t.terms[e].operator,t.terms[e].match);break;case 4:r(t.terms[e].id,t.terms[e].indicatorID,t.terms[e].operator,t.terms[e].match);break;default:console.log("Format error")}for(var e in t.joins)s(t.joins[e]);for(var e in t.getData)l(t.getData[e])},getQuery:function(){return a},getData:l,updateTerm:function(t,e,o){for(var n in a.terms)if(a.terms[n].id==t&&a.terms[n].operator==e)return void(a.terms[n].match=o);i(t,e,o)},updateDataTerm:function(t,e,o,n){for(var i in a.terms)if(a.terms[i].id==t&&a.terms[i].indicatorID==e&&a.terms[i].operator==o)return void(a.terms[i].match=n);r(t,e,o,n)},setQuery:function(t){a=t},setLimit:function(t,e){void 0===e?a.limit=t:(a.limit=e,d(t))},setLimitOffset:d,setRootURL:function(t){o=t},getRootURL:function(){return o},useJSONP:function(t){n=t},join:s,sort:function(t,e){a.sort.column=t,a.sort.direction=e},onSuccess:function(t){e=t},execute:function(){return null!=a.getData&&0==a.getData.length&&delete a.getData,0==n?$.ajax({type:"GET",url:o+"api/?a=form/query&q="+JSON.stringify(a),dataType:"json",success:e,cache:!1}):$.ajax({type:"GET",url:o+"api/?a=form/query&q="+JSON.stringify(a)+"&format=jsonp",dataType:"jsonp",success:e,cache:!1})}}},LeafFormSearch=function(t){t=t;var d="LeafFormSearch"+Math.floor(1e3*Math.random())+"_",o="LeafFormSearch"+function(){var t,e,o,n=0;if(0==document.URL.length)return n;for(t=0,o=document.URL.length;t<o;t++)e=document.URL.charCodeAt(t),n=(n<<5)-n+e,n|=0;return n}(),n="",i=0,a="",r=null,s=null,e=null,l=new LeafFormQuery,c=0,p="",u="0",f="0.0";function h(){$("#"+t).html('<div>\t\t\t    <img id="'+d+'searchIcon" class="searchIcon" alt="search" style="vertical-align: middle; padding-right: 4px; display: inline;" src="'+p+'../libs/dynicons/?img=search.svg&w=16">\t\t\t    <img id="'+d+'searchIconBusy" class="searchIcon" alt="loading" style="vertical-align: middle; padding-right: 4px; display:none" src="'+p+'images/indicator.gif">\t\t\t    <input style="border: 1px solid black; padding: 4px" type="text" id="'+d+'searchtxt" name="searchtxt" size="50" title="Enter your search text" value="" />\t\t\t    <button class="buttonNorm" id="'+d+'advancedSearchButton">Advanced Options</button>\t\t\t    <fieldset id="'+d+'advancedOptions" style="position: relative; display: none; margin: 0px; border: 1px solid black; background-color: white">\t\t        <legend>Advanced Search Options</legend>\t\t        <img id="'+d+'advancedOptionsClose" src="'+p+'../libs/dynicons/?img=process-stop.svg&w=16" tabindex="0" style="float: right; margin-top: -20px; margin-right: -14px; display: none; cursor: pointer" alt="Close advanced search"/>\t\t        <div style="width: 550px">Find items where...</div>\t\t        <table id="'+d+'searchTerms"></table>\t\t        <button class="buttonNorm" id="'+d+'addTerm" style="float: left">And...</button>\t\t        <br /><br />\t\t        <button id="'+d+'advancedSearchApply" class="buttonNorm" style="text-align: center; width: 100%">Apply Filters</button>\t\t    </fieldset>\t\t    </div>\t\t    <div id="'+d+'_result" style="margin-top: 8px" aria-label="Search Results">\t\t    </div>');var e=0;$("#"+d+"advancedOptionsClose").on("click",function(){localStorage.setItem(o+".search",""),$("#"+d+"searchtxt").val(""),y(""),$("#"+d+"advancedOptionsClose").css("display","none"),$("#"+d+"advancedOptions").slideUp(function(){$("#"+d+"advancedSearchButton").fadeIn(),$("#"+d+"searchtxt").css("display","inline"),$("#"+d+"searchtxt").animate({width:e},400,"swing"),$("#"+d+"searchtxt").focus()})});e=0;$("#"+d+"advancedOptionsClose").on("keydown",function(t){13==t.keyCode&&(localStorage.setItem(o+".search",""),$("#"+d+"searchtxt").val(""),y(""),$("#"+d+"advancedOptionsClose").css("display","none"),$("#"+d+"advancedOptions").slideUp(function(){$("#"+d+"advancedSearchButton").fadeIn(),$("#"+d+"searchtxt").css("display","inline"),$("#"+d+"searchtxt").animate({width:e},400,"swing"),$("#"+d+"searchtxt").focus()}))}),$("#"+d+"advancedSearchButton").on("click",function(){e=$("#"+d+"searchtxt").width(),$("#"+d+"advancedSearchButton").fadeOut(),$("#"+d+"searchtxt").animate({width:"0px"},400,"swing",function(){$("#"+d+"searchtxt").css("display","none"),$("#"+d+"advancedOptions").slideDown(function(){$("#"+d+"advancedOptionsClose").fadeIn()}),$("#"+d+"advancedOptions").css("display","inline"),$(".chosen").chosen({disable_search_threshold:6}),g(),$("#"+d+"widgetMat_0").focus()})}),$("#"+d+"advancedSearchApply").on("click",function(){w(),k()}),$("#"+d+"addTerm").on("click",function(){S(),$(".chosen").chosen({disable_search_threshold:6})}),$("#"+d+"searchtxt").on("keydown",function(t){w(),i=0,13==t.keyCode&&y($("#"+d+"searchtxt").val())}),S()}function g(t){var e=!0,o={};try{o=null!=t?t:JSON.parse(m())}catch(t){e=!1}if(e&&null!=o&&c<=o.length){for(var n=1;n<o.length;n++)S();for(n=0;n<o.length;n++)$("#"+d+"widgetTerm_"+n).val(o[n].id),$("#"+d+"widgetTerm_"+n).trigger("chosen:updated"),null!=o[n].indicatorID||"serviceID"==o[n].id||"categoryID"==o[n].id||"stepID"==o[n].id?D(n,function(t,e,o,n){return function(){$("#"+d+"widgetIndicator_"+t).val(e),$("#"+d+"widgetIndicator_"+t).trigger("chosen:updated"),$("#"+d+"widgetCod_"+t).val(o),$("#"+d+"widgetCod_"+t).trigger("chosen:updated"),$("#"+d+"widgetMat_"+t).val(n.replace(/\*/g,"")),$("#"+d+"widgetMat_"+t).trigger("chosen:updated")}}(n,o[n].indicatorID,o[n].operator,o[n].match)):D(n),$("#"+d+"widgetCod_"+n).val(o[n].operator),"string"==typeof o[n].match&&$("#"+d+"widgetMat_"+n).val(o[n].match.replace(/\*/g,""))}}function m(){return localStorage.getItem(o+".search")}function y(t){return"*"!=t&&localStorage.setItem(o+".search",t),e(t)}function v(){$("#"+d+"searchtxt").focus()}function w(){$("#"+d+"searchIcon").css("display","none"),$("#"+d+"searchIconBusy").css("display","inline")}function b(){$("#"+d+"searchIcon").css("display","inline"),$("#"+d+"searchIconBusy").css("display","none")}function I(t,e){null==e&&(e="userName"),"undefined"==typeof employeeSelector?($("head").append('<link type="text/css" rel="stylesheet" href="'+n+'/css/employeeSelector.css" />'),$.ajax({type:"GET",url:n+"/js/employeeSelector.js",dataType:"script",success:function(){empSel=new employeeSelector(d+"widgetEmp_"+t),empSel.apiPath=n+"/api/",empSel.rootPath=n+"/",empSel.outputStyle="micro",empSel.setSelectHandler(function(){null!=empSel.selectionData[empSel.selection]&&(selection="empUID"==e?empSel.selection:empSel.selectionData[empSel.selection].userName,$("#"+d+"widgetMat_"+t).val(selection))}),empSel.setResultHandler(function(){null!=empSel.selectionData[empSel.selection]&&(selection="empUID"==e?empSel.selection:empSel.selectionData[empSel.selection].userName,$("#"+d+"widgetMat_"+t).val(selection))}),empSel.initialize()}})):(empSel=new employeeSelector(d+"widgetEmp_"+t),empSel.apiPath=n+"/api/",empSel.rootPath=n+"/",empSel.outputStyle="micro",empSel.setSelectHandler(function(){null!=empSel.selectionData[empSel.selection]&&(selection="empUID"==e?empSel.selection:empSel.selectionData[empSel.selection].userName,$("#"+d+"widgetMat_"+t).val(selection))}),empSel.setResultHandler(function(){null!=empSel.selectionData[empSel.selection]&&(selection="empUID"==e?empSel.selection:empSel.selectionData[empSel.selection].userName,$("#"+d+"widgetMat_"+t).val(selection))}),empSel.initialize())}function x(t){"undefined"==typeof positionSelector?($("head").append('<link type="text/css" rel="stylesheet" href="'+n+'/css/positionSelector.css" />'),$.ajax({type:"GET",url:n+"/js/positionSelector.js",dataType:"script",success:function(){posSel=new positionSelector(d+"widgetPos_"+t),posSel.apiPath=n+"/api/",posSel.rootPath=n+"/",posSel.setSelectHandler(function(){$("#"+d+"widgetMat_"+t).val(posSel.selection)}),posSel.setResultHandler(function(){$("#"+d+"widgetMat_"+t).val(posSel.selection)}),posSel.initialize()}})):(posSel=new positionSelector(d+"widgetPos_"+t),posSel.apiPath=n+"/api/",posSel.rootPath=n+"/",posSel.setSelectHandler(function(){$("#"+d+"widgetMat_"+t).val(posSel.selection)}),posSel.setResultHandler(function(){$("#"+d+"widgetMat_"+t).val(posSel.selection)}),posSel.initialize())}function _(t){"undefined"==typeof groupSelector?($("head").append('<link type="text/css" rel="stylesheet" href="'+n+'/css/groupSelector.css" />'),$.ajax({type:"GET",url:n+"/js/groupSelector.js",dataType:"script",success:function(){grpSel=new groupSelector(d+"widgetGrp_"+t),grpSel.apiPath=n+"/api/",grpSel.rootPath=n+"/",grpSel.setSelectHandler(function(){$("#"+d+"widgetMat_"+t).val(grpSel.selection)}),grpSel.setResultHandler(function(){$("#"+d+"widgetMat_"+t).val(grpSel.selection)}),grpSel.initialize()}})):(grpSel=new groupSelector(d+"widgetGrp_"+t),grpSel.apiPath=n+"/api/",grpSel.rootPath=n+"/",grpSel.setSelectHandler(function(){$("#"+d+"widgetMat_"+t).val(grpSel.selection)}),grpSel.setResultHandler(function(){$("#"+d+"widgetMat_"+t).val(grpSel.selection)}),grpSel.initialize())}function D(r,i){switch($("#"+d+"widgetTerm_"+r).val()){case"title":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" class="chosen"  aria-label="title" style="width: 120px">\t\t\t\t\t\t<option value="LIKE">CONTAINS</option>\t\t\t\t\t\t<option value="NOT LIKE">DOES NOT CONTAIN</option>\t            \t\t<option value="=">=</option>\t\t\t\t\t\t<option value="!=">!=</option>\t            \t</select>'),$("#"+d+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+d+"widgetMat_"+r+'" style="width: 250px" />');break;case"serviceID":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" class="chosen"  aria-label="title" style="width: 120px">                        <option value="=">IS</option>                        <option value="!=">IS NOT</option>                    </select>'),$.ajax({type:"GET",url:"./api/?a=system/services",dataType:"json",success:function(t){var e='<select id="'+d+"widgetMat_"+r+'" class="chosen" aria-label="services" style="width: 250px">';for(var o in t)e+='<option value="'+t[o].groupID+'">'+t[o].groupTitle+"</option>";e+="</select>",$("#"+d+"widgetMatch_"+r).html(e),$(".chosen").chosen({disable_search_threshold:6}),null!=i&&i()}});break;case"date":case"dateInitiated":case"dateSubmitted":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" style="width: 140px" class="chosen" aria-label="date">\t            \t\t<option value="=">ON</option>\t            \t\t<option value=">=">ON AND AFTER</option>\t            \t\t<option value="<=">ON AND BEFORE</option>\t            \t</select>'),$("#"+d+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+d+"widgetMat_"+r+'" style="width: 200px" />'),jQuery.ui?$("#"+d+"widgetMat_"+r).datepicker():$.getScript("../libs/js/jquery/jquery-ui.custom.min.js",function(){$("#"+d+"widgetMat_"+r).datepicker()});break;case"categoryID":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" style="width: 140px" class="chosen" aria-label="categoryID">\t            \t\t<option value="=">IS</option>\t            \t\t<option value="!=">IS NOT</option>\t            \t</select>'),$.ajax({type:"GET",url:"./api/?a=workflow/categoriesUnabridged",dataType:"json",success:function(t){var e='<select id="'+d+"widgetMat_"+r+'" class="chosen" aria-label="categories" style="width: 250px">';for(var o in t)e+='<option value="'+t[o].categoryID+'">'+t[o].categoryName+"</option>";e+="</select>",$("#"+d+"widgetMatch_"+r).html(e),$(".chosen").chosen({disable_search_threshold:6}),null!=i&&i()},cache:!1});break;case"userID":$("#"+d+"widgetCondition_"+r).html('<input type="hidden" id="'+d+"widgetCod_"+r+'" value="=" /> IS'),$("#"+d+"widgetMatch_"+r).html('<div id="'+d+"widgetEmp_"+r+'" style="width: 280px"></div><input type="hidden" id="'+d+"widgetMat_"+r+'" />'),I(r);break;case"dependencyID":$("#"+d+"widgetCondition_"+r).html('<input type="hidden" id="'+d+"widgetCod_"+r+'" value="=" /> ='),$.ajax({type:"GET",url:"./api/?a=workflow/dependencies",dataType:"json",success:function(t){var e='<select id="'+d+"widgetIndicator_"+r+'" class="chosen" aria-label="dependencies" style="width: 250px">';for(var o in t)e+='<option value="'+t[o].dependencyID+'">'+t[o].description+"</option>";e+="</select>",$("#"+d+"widgetTerm_"+r).after(e);var n='<select id="'+d+"widgetMat_"+r+'" class="chosen" aria-label="options" style="width: 250px">';n+='<option value="1">Reviewed</option>',n+='<option value="0">Not Reviewed</option>',n+='<option value="-1">Returned to a previous step</option>',n+="</select>",$("#"+d+"widgetMatch_"+r).html(n),$(".chosen").chosen({disable_search_threshold:6}),$("#"+d+"widgetTerm_"+r+"_chosen").css("display","none"),null!=i&&i()},cache:!1});break;case"stepID":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" style="width: 140px" class="chosen" aria-label="categoryID">\t            \t\t<option value="=">IS</option>\t            \t\t<option value="!=">IS NOT</option>\t            \t</select>'),$.ajax({type:"GET",url:"./api/?a=workflow/steps",dataType:"json",success:function(t){var e='<select id="'+d+"widgetMat_"+r+'" class="chosen" aria-label="stepID" style="width: 250px">';for(var o in e+='<option value="submitted">Submitted</option>',e+='<option value="deleted">Cancelled</option>',e+='<option value="resolved">Resolved</option>',t)e+='<option value="'+t[o].stepID+'">'+t[o].description+": "+t[o].stepTitle+"</option>";e+="</select>",$("#"+d+"widgetMatch_"+r).html(e),$(".chosen").chosen({disable_search_threshold:6}),null!=i&&i()},cache:!1});break;case"data":$.ajax({type:"GET",url:"./api/?a=form/indicator/list",dataType:"json",success:function(a){var t='<select id="'+d+"widgetIndicator_"+r+'" class="chosen" aria-label="data" style="width: 250px">';for(var e in t+='<option value="'+u+'">Any standard data field</option>',t+='<option value="'+f+'">Any Org. Chart employee field</option>',a)t+='<option value="'+a[e].indicatorID+'">'+a[e].categoryName+": "+a[e].name+"</option>";t+="</select><br />",$("#"+d+"widgetTerm_"+r).after(t),$(".chosen").chosen({disable_search_threshold:6}),$("#"+d+"widgetIndicator_"+r).css("float","right"),$("#"+d+"widgetIndicator_"+r).on("change chosen:updated",function(){for(var t in iID=$("#"+d+"widgetIndicator_"+r).val(),iID==u?($("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t\t\t<option value="LIKE">CONTAINS</option>\t\t\t\t\t\t\t\t\t\t<option value="NOT LIKE">DOES NOT CONTAIN</option>\t\t\t\t\t            \t\t<option value="=">=</option>\t\t\t\t\t\t\t\t\t\t<option value="!=">!=</option>\t\t\t\t\t            \t</select>'),$("#"+d+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+d+"widgetMat_"+r+'" style="width: 200px" />'),$(".chosen").chosen({disable_search_threshold:6})):iID==f&&($("#"+d+"widgetCondition_"+r).html('<input type="hidden" id="'+d+"widgetCod_"+r+'" value="=" /> IS'),$("#"+d+"widgetMatch_"+r).html('<div id="'+d+"widgetEmp_"+r+'" style="width: 280px"></div><input type="hidden" id="'+d+"widgetMat_"+r+'" />'),I(r,"empUID")),a)if(a[t].indicatorID==iID){var e=a[t].format.indexOf("\n");switch(-1==e?a[t].format:a[t].format.substr(0,e).trim()){case"number":case"currency":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" class="chosen" aria-label="currency" style="width: 55px">\t\t\t\t\t\t\t\t            \t\t<option value="=">=</option>\t\t\t\t\t\t\t\t            \t\t<option value=">">></option>\t\t\t\t\t\t\t\t            \t\t<option value=">=">>=</option>\t\t\t\t\t\t\t\t            \t\t<option value="<"><</option>\t\t\t\t\t\t\t\t            \t\t<option value="<="><=</option>\t\t\t\t\t\t\t\t            \t</select>'),$(".chosen").chosen({disable_search_threshold:6});break;case"date":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" style="width: 140px" class="chosen" aria-label="date">                            \t            \t\t<option value="=">ON</option>                            \t            \t\t<option value=">=">ON AND AFTER</option>                            \t            \t\t<option value="<=">ON AND BEFORE</option>                            \t            \t</select>'),$("#"+d+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+d+"widgetMat_"+r+'" style="width: 200px" />'),jQuery.ui?$("#"+d+"widgetMat_"+r).datepicker():$.getScript("../libs/js/jquery/jquery-ui.custom.min.js",function(){$("#"+d+"widgetMat_"+r).datepicker()}),$(".chosen").chosen({disable_search_threshold:6});break;case"orgchart_employee":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t            \t\t<option value="=">IS</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="!=">IS NOT</option>\t\t\t\t\t\t\t\t            \t</select>'),$("#"+d+"widgetMatch_"+r).html('<div id="'+d+"widgetEmp_"+r+'" style="width: 280px"></div><input type="hidden" id="'+d+"widgetMat_"+r+'" />'),$(".chosen").chosen({disable_search_threshold:6}),I(r,"empUID");break;case"orgchart_position":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t            \t\t<option value="=">IS</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="!=">IS NOT</option>\t\t\t\t\t\t\t\t            \t</select>'),$("#"+d+"widgetMatch_"+r).html('<div id="'+d+"widgetPos_"+r+'" style="width: 280px"></div><input type="hidden" id="'+d+"widgetMat_"+r+'" />'),$(".chosen").chosen({disable_search_threshold:6}),x(r);break;case"orgchart_group":$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t            \t\t<option value="=">IS</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="!=">IS NOT</option>\t\t\t\t\t\t\t\t            \t</select>'),$("#"+d+"widgetMatch_"+r).html('<div id="'+d+"widgetGrp_"+r+'" style="width: 280px"></div><input type="hidden" id="'+d+"widgetMat_"+r+'" />'),$(".chosen").chosen({disable_search_threshold:6}),_(r);break;case"dropdown":case"radio":$("#"+d+"widgetCondition_"+r).html('<input type="hidden" id="'+d+"widgetCod_"+r+'" value="=" /> IS');var o=a[t].format.split("\n");o.shift();var n='<select id="'+d+"widgetMat_"+r+'" class="chosen" aria-label="options" style="width: 250px">';for(var t in o){var i=-1==o[t].indexOf("default:")?o[t].trim():o[t].substr(8).trim();n+='<option value="'+i+'">'+i+"</option>"}n+="</select>",$("#"+d+"widgetMatch_"+r).html(n),$(".chosen").chosen({disable_search_threshold:6});break;default:$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="LIKE">CONTAINS</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="NOT LIKE">DOES NOT CONTAIN</option>\t\t\t\t\t\t\t\t            \t\t<option value="=">=</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="!=">!=</option>\t\t\t\t\t\t\t\t            \t</select>'),$("#"+d+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+d+"widgetMat_"+r+'" style="width: 200px" />'),$(".chosen").chosen({disable_search_threshold:6})}}}),$("#"+d+"widgetTerm_"+r+"_chosen").css("display","none"),null!=i&&i()},cache:!1});break;default:$("#"+d+"widgetCondition_"+r).html('<select id="'+d+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 55px">\t\t            \t\t<option value="=">=</option>\t\t            \t\t<option value=">">></option>\t\t            \t\t<option value=">=">>=</option>\t\t            \t\t<option value="<"><</option>\t\t            \t\t<option value="<="><=</option>\t\t            \t\t<option value="LIKE">CONTAINS</option>\t\t            \t</select>'),$("#"+d+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+d+"widgetMat_"+r+'" style="width: 200px" />')}}function S(){$('<tr id="'+d+"widget_"+c+'">\t\t\t\t\t\t<td id="'+d+"widgetRemove_"+c+'"><button id="widgetRemoveButton"><img src="'+p+'../libs/dynicons/?img=list-remove.svg&w=16" style="cursor: pointer" alt="remove search term" /></button></td>\t\t\t\t\t\t<td><select id="'+d+"widgetTerm_"+c+'" style="width: 150px" class="chosen" aria-label="condition">            \t\t\t\t<option value="title">Title</option>            \t\t\t\t<option value="serviceID">Service</option>            \t\t\t\t<option value="dateSubmitted">Date Submitted</option>            \t\t\t\t<option value="categoryID">Type</option>            \t\t\t\t<option value="userID">Initiator</option>            \t\t\t\t<option value="dependencyID">Requirement</option>            \t\t\t\t<option value="stepID">Current Status</option>            \t\t\t\t<option value="data">Data Field</option>            \t\t\t\t</select></td>\t\t\t            <td id="'+d+"widgetCondition_"+c+'"></td>\t\t\t\t\t\t<td id="'+d+"widgetMatch_"+c+'"></td>\t\t\t\t\t  </tr>').appendTo("#"+d+"searchTerms"),D(c),$("#"+d+"widgetTerm_"+c).on("change","",c,function(t){D(t.data),$(".chosen").chosen({disable_search_threshold:6})}),$("#"+d+"widgetRemove_"+c).on("click","",c,function(t){$("#"+d+"widget_"+t.data).remove()}),c++}function k(){l.clearTerms();for(var t=0;t<c;t++)null!=$("#"+d+"widgetTerm_"+t).val()&&(term=$("#"+d+"widgetTerm_"+t).val(),"data"!=term&&"dependencyID"!=term?(id=$("#"+d+"widgetTerm_"+t).val(),cod=$("#"+d+"widgetCod_"+t).val(),match=$("#"+d+"widgetMat_"+t).val(),"LIKE"==cod&&(match="*"+match+"*"),l.addTerm(id,cod,match)):(id=$("#"+d+"widgetTerm_"+t).val(),indicatorID=$("#"+d+"widgetIndicator_"+t).val(),cod=$("#"+d+"widgetCod_"+t).val(),match=$("#"+d+"widgetMat_"+t).val(),"LIKE"==cod&&(match="*"+match+"*"),l.addDataTerm(id,indicatorID,cod,match)));0<l.getQuery().terms.length?$("#"+d+"searchtxt").val(JSON.stringify(l.getQuery().terms)):$("#"+d+"searchtxt").val("*")}return{init:function(){if(h(),r=setInterval(function(){!function(){if(null==$("#"+d+"searchtxt"))return clearInterval(r);if(400<(i+=5e3<i?0:200)){var t=$("#"+d+"searchtxt").val();""!=t&&t!=a?(a=t,null!=s&&s.abort(),s=y(t)):(""==t&&(t!=a&&y(""),a=t,$("#"+this.prefixID+"_result").html(""),0),b())}}()},200),/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||v(),null==m())y("*");else{var t=m(),e=!0;try{JSON.parse(t)}catch(t){e=!1}"["!=t.substr(0,1)&&(e=!1),e?($("#"+d+"advancedSearchButton").click(),y(t)):(""==t&&y("*"),$("#"+d+"searchtxt").val(t))}},renderUI:h,setOrgchartPath:function(t){n=t},focus:v,getPrefixID:function(){return d},getSearchInput:function(){return $("#"+d+"searchtxt").val()},getResultContainerID:function(){return d+"_result"},getLastSearch:m,generateQuery:k,getLeafFormQuery:function(){return l},renderPreviousAdvancedSearch:g,setSearchFunc:function(t){e=t},search:y,showBusy:w,showNotBusy:b,setRootURL:function(t){p=t}}},LEAFNexusAPI=function(){var e="./api/?a=",o=NexusEmployeeAPI(e),t=NexusGroupsAPI(this.baseURL);return{getBaseURL:function(){return e},setBaseURL:function(t){e=t,o.setBaseAPIURL(e)},setCSRFToken:function(t){csrfToken=t,o.setCSRFToken(csrfToken)},Employee:o,Groups:t}},NexusEmployeeAPI=function(t){var i=t,r=t+"employee",d="";return{getAPIURL:function(){return r},getBaseAPIURL:function(){return i},getByEmail:function(t,e,o){var n=r+"/search&q="+t+"&noLimit=0";$.ajax({method:"GET",url:n,dataType:"json",cache:!1}).done(e).fail(o)},getByEmailNational:function(t,e,o){var n=i+"national/employee/search&q="+t+"&noLimit=0";$.ajax({method:"GET",url:n,dataType:"json",async:!1,cache:!1}).done(e).fail(o)},importFromNational:function(t,e,o,n){var i=r+"/import/_"+t,a={};a.CSRFToken=d,$.ajax({method:"POST",url:i,data:a,dataType:"json",async:e}).done(o).fail(n)},setBaseAPIURL:function(t){r=(i=t)+"employee"},setCSRFToken:function(t){d=t}}},NexusGroupsAPI=function(t){var e=t,o=function(){return e};return{getAPIURL:o,getBaseAPIURL:o,listGroupEmployeesDetailed:function(t,e,o,n,i){var a=this.apiURL+"/"+t+"/employees/detailed";-1!==e&&(a+="&limit="+e),0<o&&(a+="&offset="+o),0<searchText.length&&(a+="&search="+searchText),$.ajax({method:"GET",url:a,dataType:"json",cache:!1}).done(function(t){n(t)}).fail(function(t){i(t)})}}},LEAFRequestPortalAPI=function(){var e="./api/?a=",o=PortalFormsAPI(e),n=PortalFormEditorAPI(e),i=PortalImportAPI(e),a=PortalSignaturesAPI(e),r=PortalSystemAPI(e),d=PortalWorkflowAPI(e);return{getBaseURL:function(){return e},setBaseURL:function(t){e=t,o.setBaseAPIURL(e),n.setBaseAPIURL(e),i.setBaseAPIURL(e),a.setBaseAPIURL(e),r.setBaseAPIURL(e),d.setBaseAPIURL(e)},setCSRFToken:function(t){t,o.setCSRFToken(t),n.setCSRFToken(t),i.setCSRFToken(t),a.setCSRFToken(t),r.setCSRFToken(t),d.setCSRFToken(t)},Forms:o,FormEditor:n,Import:i,Signature:a,System:r,Workflow:d}},PortalFormsAPI=function(t){var e=t,r=t+"form",d="",s=function(t,e,o,n){null!=e.title&&delete e.title;var i=r+"/"+t;e.CSRFToken=d,$.ajax({method:"POST",url:i,data:e,dataType:"json"}).done(o).fail(n)};return{getAPIURL:function(){return r},getAllForms:function(t,e){var o=r+"/categories";$.ajax({method:"GET",url:o,dataType:"json",cache:!1}).done(t).fail(e)},getBaseAPIURL:function(){return e},getIndicatorsForForm:function(t,e,o){var n=r+"/category&id="+t;$.ajax({method:"GET",url:n,dataType:"json",cache:!1}).done(e).fail(o)},modifyRequest:s,newRequest:function(t,o,n,i){var e=r+"/new",a={};a.CSRFToken=d,a["num"+t]=1,a.title=o.title,$.ajax({method:"POST",url:e,data:a,dataType:"json"}).done(function(e){s(e,o,function(t){0<t?n(e):i(!1)},i)}).fail(i)},setBaseAPIURL:function(t){r=(e=t)+"form"},setCSRFToken:function(t){d=t},setInitiator:function(t,e,o,n){var i=r+"/"+t+"/initiator",a={};a.CSRFToken=d,a.initiator=e,$.ajax({method:"POST",url:i,data:a,dataType:"json"}).done(o).fail(n)},query:function(t,e,o){var n=r+"/query/&q="+JSON.stringify(t);$.ajax({method:"GET",url:n,dataType:"json",cache:!1}).done(function(t){e(t)}).fail(function(t){o(t)})}}},PortalFormEditorAPI=function(t){var e=t,r=t+"formEditor",a="";return{getAPIURL:function(){return r},getBaseAPIURL:function(){return e},getIndicator:function(t,e,o,n,i){var a=r+"/indicator/"+t+(null!=i&&1==i?"&parseTemplate":"")+(null!=n&&null!=n?"&recordID="+n:"");$.ajax({method:"GET",url:a,dataType:"json",cache:!1}).done(function(t){e(t)}).fail(function(t){o(t)})},getIndicatorEditor:function(t,e,o,n){var i="ajaxIndex.php?a=getindicator&recordID="+e+"&indicatorID="+t+"&series=1";$.ajax({method:"GET",url:i,dataType:"html",cache:!1}).done(o).fail(n)},getIndicatorPrivileges:function(t,e,o){var n=r+"/indicator/"+t+"/privileges";$.ajax({method:"GET",url:n,dataType:"json",cache:!1}).done(function(t){e(t)}).fail(function(t){o(t)})},setBaseAPIURL:function(t){r=(e=t)+"formEditor"},setCSRFToken:function(t){a=t},removeIndicatorPrivilege:function(t,e,o,n){var i=r+"/indicator/"+t+"/privileges/remove";$.ajax({method:"POST",url:i,dataType:"text",data:{groupID:e,CSRFToken:a}}).done(function(t){o(t)}).fail(function(t){n(t)})},setIndicatorPrivileges:function(t,e,o,n){$.ajax({method:"POST",url:r+"/indicator/"+t+"/privileges",dataType:"text",data:{groupIDs:e,CSRFToken:a}}).done(function(t){o(t)}).fail(function(t){n(t)})}}},PortalImportAPI=function(t){var e=t,a=t+"import";return{getAPIURL:function(){return a},getBaseAPIURL:function(){return e},parseXLS:function(t,e,o,n){var i=a+"/xls&importFile="+t+"&hasHeaders="+(!0===e?1:0);$.ajax({method:"GET",url:i,dataType:"json",cache:!1}).done(o).fail(n)},setBaseAPIURL:function(t){a=(e=t)+"import"},setCSRFToken:function(t){t}}},PortalSignaturesAPI=function(t){var e=t,a=t+"signature",r="";return{getAPIURL:function(){return a},getBaseAPIURL:function(){return e},setBaseAPIURL:function(t){a=(e=t)+"signature"},setCSRFToken:function(t){r=t},create:function(t,e,o,n,i){$.ajax({method:"POST",url:a+"/create",dataType:"text",data:{signature:t,recordID:e,message:o,CSRFToken:r}}).done(function(t){n(t)}).fail(function(t){i(t)})}}},PortalSystemAPI=function(t){var e=t,o=t+"system";return{getAPIURL:function(){return o},getBaseAPIURL:function(){return e},getFileList:function(t,e){$.ajax({method:"GET",url:o+"/files",dataType:"json",cache:!1}).done(t).fail(e)},setBaseAPIURL:function(t){o=(e=t)+"system"},setCSRFToken:function(t){t}}},PortalWorkflowAPI=function(t){var e=t,a=t+"workflow",r="";return{getAPIURL:function(){return a},getBaseAPIURL:function(){return e},setBaseAPIURL:function(t){a=(e=t)+"workflow"},setCSRFToken:function(t){r=t},setStepSignatureRequirement:function(t,e,o,n,i){$.ajax({method:"POST",url:a+"/"+t+"/step/"+e+"/requiresig",dataType:"text",data:{requiresSig:o,CSRFToken:r}}).done(function(t){n(t)}).fail(function(t){i(t)})}}},FormQuery=function(){var i=[],e=[],o={column:"",direction:""},n=[],a=0,r=0,d=function(t,e,o){i.push({id:t,operator:e,match:o})},s=function(t,e,o,n){i.push({id:t,indicatorID:e,operator:o,match:n})},l=function(t){r=t};return{addDataTerm:s,addJoin:function(t){-1==e.indexOf(t)&&e.push(t)},addTerm:d,buildQuery:function(){var t={terms:i,joins:e,sort:o,getData:n};return 0<a&&(t.limit=a,0<r&&(t.limitOffset=r)),t},importQuery:function(t){for(var e in t.terms)switch(Object.keys(t.terms[e]).length){case 3:d(t.terms[e].id,t.terms[e].operator,t.terms[e].match);break;case 4:s(t.terms[e].id,t.terms[e].indicatorID,t.terms[e].operator,t.terms[e].match);break;default:console.log("Format error")}for(var e in t.joins)join(t.joins[e]);for(var e in t.getData)n(t.getData[e])},includeIndicator:function(t){-1==n.indexOf(t)&&n.push(t)},reset:function(){i=[],e=[],o={column:"",direction:""},n=[]},setLimit:function(t,e){a=t,void 0!==e&&(offset=e,l(offset))},setLimitOffset:l,sort:o=function(t,e){o.column=t,o.direction=e}}};