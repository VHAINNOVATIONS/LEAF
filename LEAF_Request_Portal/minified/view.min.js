var form,formValidator={},LeafForm=function(t){t=t;var n,r,o="LeafForm"+Math.floor(1e3*Math.random())+"_",d=o+"record",i=0;function a(){if(0==i)return console.log("recordID not set"),0;var e=$("#"+n.btnSaveID).html();$("#"+n.btnSaveID).empty().html('<img src="images/indicator.gif" alt="saving" /> Saving...'),$("#"+d).find(":input:disabled").removeAttr("disabled");var a={recordID:i};$("#"+d).serializeArray().map(function(t){a[t.name]=t.value}),$.ajax({type:"POST",url:"ajaxIndex.php?a=domodify",data:a,dataType:"text",success:function(t){null!=r&&r(),$("#"+n.btnSaveID).empty().html(e)},cache:!1})}return $("#"+t).html('<div id="'+o+'xhrDialog" style="display: none; background-color: white; border-style: none solid solid; border-width: 0 1px 1px; border-color: #e0e0e0; padding: 4px">\t\t\t<form id="'+o+'record" enctype="multipart/form-data" action="javascript:void(0);">\t\t\t    <div>\t\t\t        <button id="'+o+'button_cancelchange" class="buttonNorm" style="position: absolute; left: 10px"><img src="../libs/dynicons/?img=process-stop.svg&amp;w=16" alt="cancel" /> Cancel</button>\t\t\t        <button id="'+o+'button_save" class="buttonNorm" style="position: absolute; right: 10px"><img src="../libs/dynicons/?img=media-floppy.svg&amp;w=16" alt="save" /> Save Change</button>\t\t\t        <div style="border-bottom: 2px solid black; line-height: 30px"><br /></div>\t\t\t        <div id="'+o+'loadIndicator" style="visibility: hidden; position: absolute; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; height: 300px; width: 460px">Loading... <img src="images/largespinner.gif" alt="loading..." /></div>\t\t\t        <div id="'+o+'xhr" style="width: 540px; height: 420px; padding: 8px; overflow: auto"></div>\t\t\t    </div>\t\t\t</form>\t\t\t</div>'),n=new dialogController(o+"xhrDialog",o+"xhr",o+"loadIndicator",o+"button_save",o+"button_cancelchange"),{dialog:function(){return n},getHtmlFormID:function(){return d},serializeData:function(){return $("#"+d).serialize()},setRecordID:function(t){i=t},setPostModifyCallback:function(t){r=t},doModify:a,getForm:function(t,e){if(0==i)return console.log("recordID not set"),0;n.indicateBusy(),n.setSaveHandler(function(){a()}),formValidator=new Object,formRequired=new Object,$.ajax({type:"GET",url:"ajaxIndex.php?a=getindicator&recordID="+i+"&indicatorID="+t+"&series="+e,dataType:"text",success:function(t){for(var e in n.setTitle("Editing #"+i),n.setContent(t),formValidator){var a=e.slice(2);n.setValidator(a,formValidator[e].setValidator),n.setValidatorError(a,formValidator[e].setValidatorError),n.setValidatorOk(a,formValidator[e].setValidatorOk)}for(var e in formRequired)a=e.slice(2),n.setRequired(a,formRequired[e].setRequired),n.setRequiredError(a,formRequired[e].setRequiredError),n.setRequiredOk(a,formRequired[e].setRequiredOk);n.enableLiveValidation()},error:function(t){n.setContent("Error: "+t)},cache:!1})},initCustom:function(t,e,a,r,i){n=new dialogController(t,e,a,r,i),o="",d="record"},setHtmlFormID:function(t){d=t}}},LeafFormGrid=function(l,t){l=l;var u,f,p="LeafFormGrid"+Math.floor(1e3*Math.random())+"_",h=!0,g=[],b=0,s=!1,m=50,D=50,c="#d1dfff",v={},n=null,y=null,I=null,x="",_=!0,k=!1;$("#"+l).html('<div id="'+p+'grid"></div><div id="'+p+'form" style="display: none"></div>'),$("#"+p+"grid").html('<div style="position: relative"><div id="'+p+'gridToolbar" style="display: none; width: 90px; margin: 0 0 0 auto; text-align: right"></div></div><div id="'+p+'table_stickyHeader" style="display: none"></div><table id="'+p+'table" class="leaf_grid"><thead id="'+p+'thead" aria-label="Search Results"></thead><tbody id="'+p+'tbody"></tbody><tfoot id="'+p+'tfoot"></tfoot></table>'),$("#"+p+"thead").css({"background-color":c}),null==t&&(u=new LeafForm(p+"form"));var w=0;function T(a,t){"recordID"!=a&&D!=1/0&&H(0,1/0),$("."+p+"sort").css("display","none"),"asc"==t.toLowerCase()?($("#"+p+"header_"+a+"_sort").html(" &#9650;"),$("#"+p+"header_"+a+"_sort").css("vertical-align","super")):($("#"+p+"header_"+a+"_sort").html(" &#9660;"),$("#"+p+"header_"+a+"_sort").css("vertical-align","sub")),$("#"+p+"header_"+a+"_sort").css("display","inline");var e,r=[],i=$.isNumeric(a),n=!1,o="id"+a;for(var d in g)g[d].recordID=parseInt(g[d].recordID),null==g[d][a]&&(g[d][a]=$("#"+p+g[d].recordID+"_"+a).html(),g[d][a]=null==g[d][a]?"":g[d][a],g[d][a]=g[d][a].replace(/[\u200B-\u200E]/g,"")),i?(null==g[d].s1&&(g[d].s1={}),null!=g[d].s1[o]&&""!=g[d].s1[o]||(null==g[d].sDate&&(g[d].sDate={}),g[d].s1[o]="",g[d].sDate[a]=0),e=null,!isNaN(g[d].s1[o])||-1==g[d].s1[o].indexOf("-")&&-1==g[d].s1[o].indexOf("/")||(e=Date.parse(g[d].s1[o])),(n||null!=e&&!isNaN(e))&&(n=!0,null==g[d].sDate&&(g[d].sDate={}),g[d].sDate[a]=0,g[d].sDate[a]=isNaN(e)?0:e),$.isNumeric(g[d].s1[o])&&(g[d].s1[o]=parseFloat(g[d].s1[o]))):((e=null)==g[d].sDate&&(g[d].sDate={}),g[d].sDate[a]=0,!isNaN(g[d][a])||-1==g[d][a].indexOf("-")&&-1==g[d][a].indexOf("/")||(e=Date.parse(g[d][a])),(n||null!=e&&!isNaN(e))&&(n=!0,g[d].sDate[a]=isNaN(e)||null==e?0:e)),r.push(g[d]);n?r.sort(function(t,e){return e.sDate[a]>t.sDate[a]?1:e.sDate[a]<t.sDate[a]?-1:0}):$.isNumeric(a)?r.sort(function(t,e){return e.s1[o]>t.s1[o]?1:e.s1[o]<t.s1[o]?-1:0}):"recordID"==a?r.sort(function(t,e){return e[a]>t[a]?1:e[a]<t[a]?-1:0}):r.sort(function(t,e){return null==t[a]&&(t[a]=""),null==e[a]&&(e[a]=""),e[a].toLowerCase()>t[a].toLowerCase()?1:e[a].toLowerCase()<t[a].toLowerCase()?-1:0}),"asc"==t&&r.reverse(),g=r}function R(){if(!_)return!1;var e=[];$("#"+p+"thead>tr>th").each(function(){e.push($(this).css("width"))}),$("#"+p+"table_stickyHeader > table").css({width:$("#"+p+"thead").css("width"),height:"30px"}),$("#"+p+"table_stickyHeader > table > thead > tr > th").each(function(t){$(this).css({width:e[t],padding:"2px","font-weight":"normal"})}),$("#"+p+"table_stickyHeader > table").css({border:"1px solid black","border-collapse":"collapse",margin:"0 2px 0"}),$("#"+p+"table_stickyHeader > table > thead > tr").css({"background-color":"black",color:"white"}),$("#"+p+"table_stickyHeader > table > thead > tr > th").css("border","1px solid #e0e0e0")}function H(t,e){k=!0,null!=y&&y(),null==e&&(e=m),D=e;var a=!1;null!=t&&0!=t||(t=0,$("#"+p+"tbody").empty(),a=!0);var r="",i=[],n=h?f.length+1:f.length;0==g.length&&$("#"+p+"tbody").append('<tr><td colspan="'+n+'" style="text-align: center">No Results</td></tr>');for(var o=0,d=t;d<g.length;d++){if(e<=o){b=d;break}for(var l in r+='<tr id="'+p+"tbody_tr"+g[d].recordID+'">',h&&(r+='<td><a href="index.php?a=printview&recordID='+g[d].recordID+'">'+g[d].recordID+"</a></td>"),f)if(0!=f[l].visible)if(null!=g[d]){var s={};s.recordID=g[d].recordID,s.indicatorID=f[l].indicatorID,s.cellContainerID=p+g[d].recordID+"_"+f[l].indicatorID,s.index=d,s.data="";var c=!1;null!=f[l].editable&&0==f[l].editable||(c=!0),$.isNumeric(s.indicatorID)?(null==g[d].s1&&(g[d].s1={}),s.data=null!=g[d].s1["id"+f[l].indicatorID]?g[d].s1["id"+f[l].indicatorID]:"",r+='<td id="'+p+g[d].recordID+"_"+f[l].indicatorID+'" data-editable="'+c+'" data-record-id="'+g[d].recordID+'" data-indicator-id="'+f[l].indicatorID+'">'+s.data+"</td>"):null!=f[l].callback?r+='<td id="'+p+g[d].recordID+"_"+f[l].indicatorID+'" data-clickable="'+c+'"></td>':r+='<td id="'+p+g[d].recordID+"_"+f[l].indicatorID+'"></td>',null!=f[l].callback&&i.push(function(t,e){return function(){t(e,v)}}(f[l].callback,s))}else r+='<td id="'+p+g[d].recordID+"_"+f[l].indicatorID+'"></td>';r+="</tr>",o++,a&&(b=d+1)}for(var d in b+e>=g.length||null==e?$("#"+p+"tfoot").html(""):$("#"+p+"tfoot").html("<tr><td colspan="+n+' style="padding: 8px; background-color: #feffd1; font-size: 120%; font-weight: bold"><img src="'+x+'images/indicator.gif" style="vertical-align: middle" alt="Loading" /> Loading more results...</td></tr>'),$("#"+p+"tbody").append(r),$("#"+p+"tbody td[data-editable=true]").addClass("table_editable"),$("#"+p+"tbody td[data-clickable=true]").addClass("table_editable"),$("#"+p+"tbody").on("click","td[data-editable=true]",function(t){u.setRecordID($(this).data("record-id"));var e=$(this).data("indicator-id");u.setPostModifyCallback(function(){var i,t;i=e,t=1,$.ajax({type:"GET",url:x+"api/?a=form/"+recordID+"/rawIndicator/"+i+"/"+t,dataType:"json",success:function(t){var e=""!=t[i].displayedValue?t[i].displayedValue:t[i].value;if("checkboxes"==t[i].format&&Array.isArray(e)){var a="";for(var r in e)"no"!=e[r]&&(a+=", "+e[r]);e=a.substr(2)}$("#"+p+recordID+"_"+i).empty().html(e),$("#"+p+recordID+"_"+i).fadeOut(250,function(){$("#"+p+recordID+"_"+i).fadeIn(250)})},cache:!1}),u.dialog().hide()}),u.getForm(e,1),u.dialog().show()}),i)i[d]();$("#"+p+"table>tbody>tr>td").css({border:"1px solid black",padding:"8px","font-size":"12px"}),null!=I&&I(),R()}function r(t){s=!0,g=t}function i(t){v=t}return{getPrefixID:function(){return p},form:function(){return u},headers:function(){return f},getCurrentData:function(){return g},hideIndex:function(){h=!1},setHeaders:function(t){f=t;var e='<tr id="'+p+'thead_tr">',a='<tr id="'+p+'tVirt_tr">';for(var r in h&&(e+='<th id="'+p+'header_UID" style="text-align: center">UID</th>',a+='<th style="text-align: center">UID</th>'),$("#"+p+"thead").html(e),h&&($("#"+p+"header_UID").css("cursor","pointer"),$("#"+p+"header_UID").on("click",null,null,function(t){w=0==w?(T("recordID","asc"),1):(T("recordID","desc"),0),H(0,1/0)}),$("#"+p+"header_UID").on("mouseover",null,null,function(t){$("#"+p+"header_UID").css("background-color","#79a2ff")}),$("#"+p+"header_UID").on("mouseout",null,null,function(t){$("#"+p+"header_UID").css({"background-color":c})})),f)if(0!=f[r].visible){var i=null!=f[r].align?f[r].align:"center";$("#"+p+"thead_tr").append('<th id="'+p+"header_"+f[r].indicatorID+'" tabindex="0"  style="text-align:'+i+'">'+f[r].name+'<span id="'+p+"header_"+f[r].indicatorID+'_sort" class="'+p+'sort"></span></th>'),a+='<th id="Vheader_'+f[r].indicatorID+'" style="text-align:'+i+'">'+f[r].name+"</th>",null!=f[r].sortable&&1!=f[r].sortable||($("#"+p+"header_"+f[r].indicatorID).css("cursor","pointer"),$("#"+p+"header_"+f[r].indicatorID).on("click",null,f[r].indicatorID,function(t){w=0==w?(T(t.data,"asc"),1):(T(t.data,"desc"),0),H(0,1/0)}),$("#"+p+"header_"+f[r].indicatorID).on("keydown",null,f[r].indicatorID,function(t){13==t.keyCode&&(w=0==w?(T(t.data,"asc"),1):(T(t.data,"desc"),0),H(0,1/0))}),$("#"+p+"header_"+f[r].indicatorID).on("mouseover",null,f[r].indicatorID,function(t){$("#"+p+"header_"+t.data).css("background-color","#79a2ff")}),$("#"+p+"header_"+f[r].indicatorID).on("mouseout",null,f[r].indicatorID,function(t){$("#"+p+"header_"+t.data).css({"background-color":c})}))}$("#"+p+"thead").append("</tr>"),a+="</tr>",$("#"+p+"table>thead>tr>th").css({border:"1px solid black",padding:"4px 2px 4px 2px","font-size":"12px"});var n,o=!1;$("#"+p+"table_stickyHeader").html("<table><thead>"+a+"</thead></table>"),$(window).on("resize",function(){R()}),$(window).on("scroll",function(){o=!0});var d=[];setInterval(function(){scrollPos=$(window).scrollTop(),tableHeight=$("#"+p+"table").height(),pageHeight=$(window).height(),o&&null!=$("#"+p+"thead").offset()&&_&&(o=!1,n=$("#"+p+"thead").offset().top,scrollPos>n&&scrollPos<tableHeight+n?($("#"+p+"table_stickyHeader").css("display","inline"),$("#"+p+"table_stickyHeader").css({position:"absolute",top:scrollPos+"px"})):$("#"+p+"table_stickyHeader").css("display","none")),scrollPos>tableHeight-.8*pageHeight&&s&&k&&null==d[b]&&(d[b]=1,H(b,m))},100)},sort:T,renderVirtualHeader:R,renderBody:H,loadData:function(t,i){g=[];var e=h?f.length+1:f.length;$("#"+p+"tbody").html('<tr><td colspan="'+e+'" style="text-align: left; padding: 8px">Building report... <img src="'+x+'images/largespinner.gif" alt="loading..." /></td></tr>');var a="";for(var r in f)$.isNumeric(f[r].indicatorID)&&(a+=f[r].indicatorID+",");$.ajax({type:"POST",url:x+"api/?a=form/customData",dataType:"json",data:{recordList:t,indicatorList:a,CSRFToken:CSRFToken},success:function(t){for(var e in s=!0,t){if(null!=v[e])for(var a in v[e])if("object"==typeof v[e][a])for(var r in v[e][a])t[e][a]=t[e][a]||{},t[e][a][r]=v[e][a][r];else t[e][a]=v[e][a];g.push(t[e])}null!=n&&(g=n(g)),T("recordID","desc"),H(0,m),null!=i&&"function"==typeof i&&i()},cache:!1})},setData:r,setDataBlob:i,importQueryResult:function(t){var e=[];for(var a in t)e.push(t[a]);r(e),i(e)},enableToolbar:function(){l=p+"gridToolbar",$("#"+l).css("display","block"),$("#"+l).html('<button type="button" id="'+p+'getExcel" class="buttonNorm"><img src="../libs/dynicons/?img=x-office-spreadsheet.svg&w=32" alt="Icon of Spreadsheet" /> Export</button>'),$("#"+p+"getExcel").on("click",function(){b!=g.length&&H(0,1/0);var a=[],r=[];$("#"+p+"thead>tr>th").each(function(t,e){r.push($(e).text().trim())});var i={},n=0,o=(document.createElement("a"),r.length-1);$("#"+p+"tbody>tr>td").each(function(t,e){i[r[n]]=$(e).text().trim(),0==n&&"UID"==r[n]&&(i[r[n]]='=HYPERLINK("'+window.location.origin+window.location.pathname+"?a=printview&recordID="+$(e).text().trim()+'", "'+$(e).text().trim()+'")'),o<++n&&(a.push(i),i={},n=0)});var t=$(document.createElement("form"));t.attr({action:x+"api/?a=converter/json&format=csv",method:"POST"});var e=$(document.createElement("input")),d=$(document.createElement("input"));e.attr({type:"hidden",name:"input",value:JSON.stringify(a)}),d.attr({type:"hidden",name:"CSRFToken",value:CSRFToken}),t.append(e),t.append(d),t.appendTo("#"+l),t.submit(),t.remove()})},setPostProcessDataFunc:function(t){n=t},setPreRenderFunc:function(t){y=t},setPostRenderFunc:function(t){I=t},setDefaultLimit:function(t){m=t},getDefaultLimit:function(){return m},getDataByIndex:function(t){return g[t]},getDataByRecordID:function(t){for(var e in g)if(g[e].recordID==t)return g[e];return null},disableVirtualHeader:function(){_=!1},stop:function(){k=!1},setRootURL:function(t){x=t}}},XSSHelpers=(buildTagRegex=function(t){return new RegExp("(<\\/?\\s*\\b"+t+"\\b(.*?)\\s*>)","g")},cleanTag=function(t){return t.replace(/<\s*\/?|>/g,"").trim()},containsTag=function(t,e){return null!==buildTagRegex(cleanTag(e)).exec(t)},containsTags=function(t,e,a){null==a&&(a=!1);for(var r=0;r<e.length;r++){var i=containsTag(t,e[r]);if(a){if(!i)return!1}else if(i)return!0}return!1},stripAllTags=function(t){return t.replace(buildTagRegex(""),"")},stripTag=function(t,e){return t.replace(buildTagRegex(cleanTag(e)),"")},stripTags=function(t,e){for(var a=0;a<e.length;a++)t=stripTag(t,e[a]);return t},{buildTagRegex:buildTagRegex,containsTag:containsTag,containsTags:containsTags,stripAllTags:stripAllTags,stripTag:stripTag,stripTags:stripTags});"undefined"!=typeof module&&(module.exports=XSSHelpers);