var form,formValidator={},LeafForm=function(t){t=t;var n,a,r="LeafForm"+Math.floor(1e3*Math.random())+"_",l=r+"record",o=0;function i(){if(0==o)return console.log("recordID not set"),0;var e=$("#"+n.btnSaveID).html();$("#"+n.btnSaveID).empty().html('<img src="images/indicator.gif" alt="saving" /> Saving...'),$("#"+l).find(":input:disabled").removeAttr("disabled");var i={recordID:o};$("#"+l).serializeArray().map(function(t){i[t.name]=t.value}),$.ajax({type:"POST",url:"ajaxIndex.php?a=domodify",data:i,dataType:"text",success:function(t){null!=a&&a(),$("#"+n.btnSaveID).empty().html(e)},cache:!1})}return $("#"+t).html('<div id="'+r+'xhrDialog" style="display: none; background-color: white; border-style: none solid solid; border-width: 0 1px 1px; border-color: #e0e0e0; padding: 4px">\t\t\t<form id="'+r+'record" enctype="multipart/form-data" action="javascript:void(0);">\t\t\t    <div>\t\t\t        <button id="'+r+'button_cancelchange" class="buttonNorm" style="position: absolute; left: 10px"><img src="../libs/dynicons/?img=process-stop.svg&amp;w=16" alt="cancel" /> Cancel</button>\t\t\t        <button id="'+r+'button_save" class="buttonNorm" style="position: absolute; right: 10px"><img src="../libs/dynicons/?img=media-floppy.svg&amp;w=16" alt="save" /> Save Change</button>\t\t\t        <div style="border-bottom: 2px solid black; line-height: 30px"><br /></div>\t\t\t        <div id="'+r+'loadIndicator" style="visibility: hidden; position: absolute; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; height: 300px; width: 460px">Loading... <img src="images/largespinner.gif" alt="loading..." /></div>\t\t\t        <div id="'+r+'xhr" style="width: 540px; height: 420px; padding: 8px; overflow: auto"></div>\t\t\t    </div>\t\t\t</form>\t\t\t</div>'),n=new dialogController(r+"xhrDialog",r+"xhr",r+"loadIndicator",r+"button_save",r+"button_cancelchange"),{dialog:function(){return n},getHtmlFormID:function(){return l},serializeData:function(){return $("#"+l).serialize()},setRecordID:function(t){o=t},setPostModifyCallback:function(t){a=t},doModify:i,getForm:function(t,e){if(0==o)return console.log("recordID not set"),0;n.indicateBusy(),n.setSaveHandler(function(){i()}),formValidator=new Object,formRequired=new Object,$.ajax({type:"GET",url:"ajaxIndex.php?a=getindicator&recordID="+o+"&indicatorID="+t+"&series="+e,dataType:"text",success:function(t){for(var e in n.setTitle("Editing #"+o),n.setContent(t),formValidator){var i=e.slice(2);n.setValidator(i,formValidator[e].setValidator),n.setValidatorError(i,formValidator[e].setValidatorError),n.setValidatorOk(i,formValidator[e].setValidatorOk)}for(var e in formRequired)i=e.slice(2),n.setRequired(i,formRequired[e].setRequired),n.setRequiredError(i,formRequired[e].setRequiredError),n.setRequiredOk(i,formRequired[e].setRequiredOk);n.enableLiveValidation()},error:function(t){n.setContent("Error: "+t)},cache:!1})},initCustom:function(t,e,i,a,o){n=new dialogController(t,e,i,a,o),r="",l="record"},setHtmlFormID:function(t){l=t}}},LeafFormGrid=function(s,t){s=s;var p,u,h="LeafFormGrid"+Math.floor(1e3*Math.random())+"_",g=!0,m=[],f=0,d=!1,v=50,y=50,c="#d1dfff",w={},n=null,_=null,b=null,I="",D=!0,x=!1;$("#"+s).html('<div id="'+h+'grid"></div><div id="'+h+'form" style="display: none"></div>'),$("#"+h+"grid").html('<div style="position: relative"><div id="'+h+'gridToolbar" style="display: none; width: 90px; margin: 0 0 0 auto; text-align: right"></div></div><div id="'+h+'table_stickyHeader" style="display: none"></div><table id="'+h+'table" class="leaf_grid"><thead id="'+h+'thead" aria-label="Search Results"></thead><tbody id="'+h+'tbody"></tbody><tfoot id="'+h+'tfoot"></tfoot></table>'),$("#"+h+"thead").css({"background-color":c}),null==t&&(p=new LeafForm(h+"form"));var S=0;function T(i,t){"recordID"!=i&&y!=1/0&&C(0,1/0),$("."+h+"sort").css("display","none"),"asc"==t.toLowerCase()?($("#"+h+"header_"+i+"_sort").html(" &#9650;"),$("#"+h+"header_"+i+"_sort").css("vertical-align","super")):($("#"+h+"header_"+i+"_sort").html(" &#9660;"),$("#"+h+"header_"+i+"_sort").css("vertical-align","sub")),$("#"+h+"header_"+i+"_sort").css("display","inline");var e,a=[],o=$.isNumeric(i),n=!1,r="id"+i;for(var l in m)m[l].recordID=parseInt(m[l].recordID),null==m[l][i]&&(m[l][i]=$("#"+h+m[l].recordID+"_"+i).html(),m[l][i]=null==m[l][i]?"":m[l][i],m[l][i]=m[l][i].replace(/[\u200B-\u200E]/g,"")),o?(null==m[l].s1&&(m[l].s1={}),null!=m[l].s1[r]&&""!=m[l].s1[r]||(null==m[l].sDate&&(m[l].sDate={}),m[l].s1[r]="",m[l].sDate[i]=0),e=null,!isNaN(m[l].s1[r])||-1==m[l].s1[r].indexOf("-")&&-1==m[l].s1[r].indexOf("/")||(e=Date.parse(m[l].s1[r])),(n||null!=e&&!isNaN(e))&&(n=!0,null==m[l].sDate&&(m[l].sDate={}),m[l].sDate[i]=0,m[l].sDate[i]=isNaN(e)?0:e),$.isNumeric(m[l].s1[r])&&(m[l].s1[r]=parseFloat(m[l].s1[r]))):((e=null)==m[l].sDate&&(m[l].sDate={}),m[l].sDate[i]=0,!isNaN(m[l][i])||-1==m[l][i].indexOf("-")&&-1==m[l][i].indexOf("/")||(e=Date.parse(m[l][i])),(n||null!=e&&!isNaN(e))&&(n=!0,m[l].sDate[i]=isNaN(e)||null==e?0:e)),a.push(m[l]);n?a.sort(function(t,e){return e.sDate[i]>t.sDate[i]?1:e.sDate[i]<t.sDate[i]?-1:0}):$.isNumeric(i)?a.sort(function(t,e){return e.s1[r]>t.s1[r]?1:e.s1[r]<t.s1[r]?-1:0}):"recordID"==i?a.sort(function(t,e){return e[i]>t[i]?1:e[i]<t[i]?-1:0}):a.sort(function(t,e){return null==t[i]&&(t[i]=""),null==e[i]&&(e[i]=""),e[i].toLowerCase()>t[i].toLowerCase()?1:e[i].toLowerCase()<t[i].toLowerCase()?-1:0}),"asc"==t&&a.reverse(),m=a}function k(){if(!D)return!1;var e=[];$("#"+h+"thead>tr>th").each(function(){e.push($(this).css("width"))}),$("#"+h+"table_stickyHeader > table").css({width:$("#"+h+"thead").css("width"),height:"30px"}),$("#"+h+"table_stickyHeader > table > thead > tr > th").each(function(t){$(this).css({width:e[t],padding:"2px","font-weight":"normal"})}),$("#"+h+"table_stickyHeader > table").css({border:"1px solid black","border-collapse":"collapse",margin:"0 2px 0"}),$("#"+h+"table_stickyHeader > table > thead > tr").css({"background-color":"black",color:"white"}),$("#"+h+"table_stickyHeader > table > thead > tr > th").css("border","1px solid #e0e0e0")}function C(t,e){x=!0,null!=_&&_(),null==e&&(e=v),y=e;var i=!1;null!=t&&0!=t||(t=0,$("#"+h+"tbody").empty(),i=!0);var a="",o=[],n=g?u.length+1:u.length;0==m.length&&$("#"+h+"tbody").append('<tr><td colspan="'+n+'" style="text-align: center">No Results</td></tr>');for(var r=0,l=t;l<m.length;l++){if(e<=r){f=l;break}for(var s in a+='<tr id="'+h+"tbody_tr"+m[l].recordID+'">',g&&(a+='<td><a href="index.php?a=printview&recordID='+m[l].recordID+'">'+m[l].recordID+"</a></td>"),u)if(0!=u[s].visible)if(null!=m[l]){var d={};d.recordID=m[l].recordID,d.indicatorID=u[s].indicatorID,d.cellContainerID=h+m[l].recordID+"_"+u[s].indicatorID,d.index=l,d.data="";var c=!1;null!=u[s].editable&&0==u[s].editable||(c=!0),$.isNumeric(d.indicatorID)?(null==m[l].s1&&(m[l].s1={}),d.data=null!=m[l].s1["id"+u[s].indicatorID]?m[l].s1["id"+u[s].indicatorID]:"",a+='<td id="'+h+m[l].recordID+"_"+u[s].indicatorID+'" data-editable="'+c+'" data-record-id="'+m[l].recordID+'" data-indicator-id="'+u[s].indicatorID+'">'+d.data+"</td>"):null!=u[s].callback?a+='<td id="'+h+m[l].recordID+"_"+u[s].indicatorID+'" data-clickable="'+c+'"></td>':a+='<td id="'+h+m[l].recordID+"_"+u[s].indicatorID+'"></td>',null!=u[s].callback&&o.push(function(t,e){return function(){t(e,w)}}(u[s].callback,d))}else a+='<td id="'+h+m[l].recordID+"_"+u[s].indicatorID+'"></td>';a+="</tr>",r++,i&&(f=l+1)}for(var l in f+e>=m.length||null==e?$("#"+h+"tfoot").html(""):$("#"+h+"tfoot").html("<tr><td colspan="+n+' style="padding: 8px; background-color: #feffd1; font-size: 120%; font-weight: bold"><img src="'+I+'images/indicator.gif" style="vertical-align: middle" alt="Loading" /> Loading more results...</td></tr>'),$("#"+h+"tbody").append(a),$("#"+h+"tbody td[data-editable=true]").addClass("table_editable"),$("#"+h+"tbody td[data-clickable=true]").addClass("table_editable"),$("#"+h+"tbody").on("click","td[data-editable=true]",function(t){p.setRecordID($(this).data("record-id"));var e=$(this).data("indicator-id");p.setPostModifyCallback(function(){var o,t;o=e,t=1,$.ajax({type:"GET",url:I+"api/?a=form/"+recordID+"/rawIndicator/"+o+"/"+t,dataType:"json",success:function(t){var e=""!=t[o].displayedValue?t[o].displayedValue:t[o].value;if("checkboxes"==t[o].format&&Array.isArray(e)){var i="";for(var a in e)"no"!=e[a]&&(i+=", "+e[a]);e=i.substr(2)}$("#"+h+recordID+"_"+o).empty().html(e),$("#"+h+recordID+"_"+o).fadeOut(250,function(){$("#"+h+recordID+"_"+o).fadeIn(250)})},cache:!1}),p.dialog().hide()}),p.getForm(e,1),p.dialog().show()}),o)o[l]();$("#"+h+"table>tbody>tr>td").css({border:"1px solid black",padding:"8px","font-size":"12px"}),null!=b&&b(),k()}function a(t){d=!0,m=t}function o(t){w=t}return{getPrefixID:function(){return h},form:function(){return p},headers:function(){return u},getCurrentData:function(){return m},hideIndex:function(){g=!1},setHeaders:function(t){u=t;var e='<tr id="'+h+'thead_tr">',i='<tr id="'+h+'tVirt_tr">';for(var a in g&&(e+='<th id="'+h+'header_UID" style="text-align: center">UID</th>',i+='<th style="text-align: center">UID</th>'),$("#"+h+"thead").html(e),g&&($("#"+h+"header_UID").css("cursor","pointer"),$("#"+h+"header_UID").on("click",null,null,function(t){S=0==S?(T("recordID","asc"),1):(T("recordID","desc"),0),C(0,1/0)}),$("#"+h+"header_UID").on("mouseover",null,null,function(t){$("#"+h+"header_UID").css("background-color","#79a2ff")}),$("#"+h+"header_UID").on("mouseout",null,null,function(t){$("#"+h+"header_UID").css({"background-color":c})})),u)if(0!=u[a].visible){var o=null!=u[a].align?u[a].align:"center";$("#"+h+"thead_tr").append('<th id="'+h+"header_"+u[a].indicatorID+'" tabindex="0"  style="text-align:'+o+'">'+u[a].name+'<span id="'+h+"header_"+u[a].indicatorID+'_sort" class="'+h+'sort"></span></th>'),i+='<th id="Vheader_'+u[a].indicatorID+'" style="text-align:'+o+'">'+u[a].name+"</th>",null!=u[a].sortable&&1!=u[a].sortable||($("#"+h+"header_"+u[a].indicatorID).css("cursor","pointer"),$("#"+h+"header_"+u[a].indicatorID).on("click",null,u[a].indicatorID,function(t){S=0==S?(T(t.data,"asc"),1):(T(t.data,"desc"),0),C(0,1/0)}),$("#"+h+"header_"+u[a].indicatorID).on("keydown",null,u[a].indicatorID,function(t){13==t.keyCode&&(S=0==S?(T(t.data,"asc"),1):(T(t.data,"desc"),0),C(0,1/0))}),$("#"+h+"header_"+u[a].indicatorID).on("mouseover",null,u[a].indicatorID,function(t){$("#"+h+"header_"+t.data).css("background-color","#79a2ff")}),$("#"+h+"header_"+u[a].indicatorID).on("mouseout",null,u[a].indicatorID,function(t){$("#"+h+"header_"+t.data).css({"background-color":c})}))}$("#"+h+"thead").append("</tr>"),i+="</tr>",$("#"+h+"table>thead>tr>th").css({border:"1px solid black",padding:"4px 2px 4px 2px","font-size":"12px"});var n,r=!1;$("#"+h+"table_stickyHeader").html("<table><thead>"+i+"</thead></table>"),$(window).on("resize",function(){k()}),$(window).on("scroll",function(){r=!0});var l=[];setInterval(function(){scrollPos=$(window).scrollTop(),tableHeight=$("#"+h+"table").height(),pageHeight=$(window).height(),r&&null!=$("#"+h+"thead").offset()&&D&&(r=!1,n=$("#"+h+"thead").offset().top,scrollPos>n&&scrollPos<tableHeight+n?($("#"+h+"table_stickyHeader").css("display","inline"),$("#"+h+"table_stickyHeader").css({position:"absolute",top:scrollPos+"px"})):$("#"+h+"table_stickyHeader").css("display","none")),scrollPos>tableHeight-.8*pageHeight&&d&&x&&null==l[f]&&(l[f]=1,C(f,v))},100)},sort:T,renderVirtualHeader:k,renderBody:C,loadData:function(t,o){m=[];var e=g?u.length+1:u.length;$("#"+h+"tbody").html('<tr><td colspan="'+e+'" style="text-align: left; padding: 8px">Building report... <img src="'+I+'images/largespinner.gif" alt="loading..." /></td></tr>');var i="";for(var a in u)$.isNumeric(u[a].indicatorID)&&(i+=u[a].indicatorID+",");$.ajax({type:"POST",url:I+"api/?a=form/customData",dataType:"json",data:{recordList:t,indicatorList:i,CSRFToken:CSRFToken},success:function(t){for(var e in d=!0,t){if(null!=w[e])for(var i in w[e])if("object"==typeof w[e][i])for(var a in w[e][i])t[e][i]=t[e][i]||{},t[e][i][a]=w[e][i][a];else t[e][i]=w[e][i];m.push(t[e])}null!=n&&(m=n(m)),T("recordID","desc"),C(0,v),null!=o&&"function"==typeof o&&o()},cache:!1})},setData:a,setDataBlob:o,importQueryResult:function(t){var e=[];for(var i in t)e.push(t[i]);a(e),o(e)},enableToolbar:function(){s=h+"gridToolbar",$("#"+s).css("display","block"),$("#"+s).html('<button type="button" id="'+h+'getExcel" class="buttonNorm"><img src="../libs/dynicons/?img=x-office-spreadsheet.svg&w=32" alt="Icon of Spreadsheet" /> Export</button>'),$("#"+h+"getExcel").on("click",function(){f!=m.length&&C(0,1/0);var i=[],a=[];$("#"+h+"thead>tr>th").each(function(t,e){a.push($(e).text().trim())});var o={},n=0,r=(document.createElement("a"),a.length-1);$("#"+h+"tbody>tr>td").each(function(t,e){o[a[n]]=$(e).text().trim(),0==n&&"UID"==a[n]&&(o[a[n]]='=HYPERLINK("'+window.location.origin+window.location.pathname+"?a=printview&recordID="+$(e).text().trim()+'", "'+$(e).text().trim()+'")'),r<++n&&(i.push(o),o={},n=0)});var t=$(document.createElement("form"));t.attr({action:I+"api/?a=converter/json&format=csv",method:"POST"});var e=$(document.createElement("input")),l=$(document.createElement("input"));e.attr({type:"hidden",name:"input",value:JSON.stringify(i)}),l.attr({type:"hidden",name:"CSRFToken",value:CSRFToken}),t.append(e),t.append(l),t.appendTo("#"+s),t.submit(),t.remove()})},setPostProcessDataFunc:function(t){n=t},setPreRenderFunc:function(t){_=t},setPostRenderFunc:function(t){b=t},setDefaultLimit:function(t){v=t},getDefaultLimit:function(){return v},getDataByIndex:function(t){return m[t]},getDataByRecordID:function(t){for(var e in m)if(m[e].recordID==t)return m[e];return null},disableVirtualHeader:function(){D=!1},stop:function(){x=!1},setRootURL:function(t){I=t}}},LeafFormQuery=function(){var n={},e=null,i="",a=!1;function t(){n={terms:[],joins:[],sort:{},getData:[]}}function o(t,e,i){var a={};a.id=t,a.operator=e,a.match=i,n.terms.push(a)}function r(t,e,i,a){var o={};o.id=t,o.indicatorID=e,o.operator=i,o.match=a,n.terms.push(o)}function l(t){n.limitOffset=t}function s(t){-1==n.joins.indexOf(t)&&n.joins.push(t)}function d(t){-1==n.getData.indexOf(t)&&n.getData.push(t)}return t(),{clearTerms:t,addTerm:o,addDataTerm:r,importQuery:function(t){for(var e in t.terms)switch(Object.keys(t.terms[e]).length){case 3:o(t.terms[e].id,t.terms[e].operator,t.terms[e].match);break;case 4:r(t.terms[e].id,t.terms[e].indicatorID,t.terms[e].operator,t.terms[e].match);break;default:console.log("Format error")}for(var e in t.joins)s(t.joins[e]);for(var e in t.getData)d(t.getData[e])},getQuery:function(){return n},getData:d,updateTerm:function(t,e,i){for(var a in n.terms)if(n.terms[a].id==t&&n.terms[a].operator==e)return void(n.terms[a].match=i);o(t,e,i)},updateDataTerm:function(t,e,i,a){for(var o in n.terms)if(n.terms[o].id==t&&n.terms[o].indicatorID==e&&n.terms[o].operator==i)return void(n.terms[o].match=a);r(t,e,i,a)},setQuery:function(t){n=t},setLimit:function(t,e){void 0===e?n.limit=t:(n.limit=e,l(t))},setLimitOffset:l,setRootURL:function(t){i=t},getRootURL:function(){return i},useJSONP:function(t){a=t},join:s,sort:function(t,e){n.sort.column=t,n.sort.direction=e},onSuccess:function(t){e=t},execute:function(){return null!=n.getData&&0==n.getData.length&&delete n.getData,0==a?$.ajax({type:"GET",url:i+"api/?a=form/query&q="+JSON.stringify(n),dataType:"json",success:e,cache:!1}):$.ajax({type:"GET",url:i+"api/?a=form/query&q="+JSON.stringify(n)+"&format=jsonp",dataType:"jsonp",success:e,cache:!1})}}},LeafFormSearch=function(t){t=t;var l="LeafFormSearch"+Math.floor(1e3*Math.random())+"_",i="LeafFormSearch"+function(){var t,e,i,a=0;if(0==document.URL.length)return a;for(t=0,i=document.URL.length;t<i;t++)e=document.URL.charCodeAt(t),a=(a<<5)-a+e,a|=0;return a}(),a="",o=0,n="",r=null,s=null,e=null,d=new LeafFormQuery,c=0,p="",u="0",h="0.0";function g(){$("#"+t).html('<div>\t\t\t    <img id="'+l+'searchIcon" class="searchIcon" alt="search" style="vertical-align: middle; padding-right: 4px; display: inline;" src="'+p+'../libs/dynicons/?img=search.svg&w=16">\t\t\t    <img id="'+l+'searchIconBusy" class="searchIcon" alt="loading" style="vertical-align: middle; padding-right: 4px; display:none" src="'+p+'images/indicator.gif">\t\t\t    <input style="border: 1px solid black; padding: 4px" type="text" id="'+l+'searchtxt" name="searchtxt" size="50" title="Enter your search text" value="" />\t\t\t    <button class="buttonNorm" id="'+l+'advancedSearchButton">Advanced Options</button>\t\t\t    <fieldset id="'+l+'advancedOptions" style="position: relative; display: none; margin: 0px; border: 1px solid black; background-color: white">\t\t        <legend>Advanced Search Options</legend>\t\t        <img id="'+l+'advancedOptionsClose" src="'+p+'../libs/dynicons/?img=process-stop.svg&w=16" tabindex="0" style="float: right; margin-top: -20px; margin-right: -14px; display: none; cursor: pointer" alt="Close advanced search"/>\t\t        <div style="width: 550px">Find items where...</div>\t\t        <table id="'+l+'searchTerms"></table>\t\t        <button class="buttonNorm" id="'+l+'addTerm" style="float: left">And...</button>\t\t        <br /><br />\t\t        <button id="'+l+'advancedSearchApply" class="buttonNorm" style="text-align: center; width: 100%">Apply Filters</button>\t\t    </fieldset>\t\t    </div>\t\t    <div id="'+l+'_result" style="margin-top: 8px" aria-label="Search Results">\t\t    </div>');var e=0;$("#"+l+"advancedOptionsClose").on("click",function(){localStorage.setItem(i+".search",""),$("#"+l+"searchtxt").val(""),v(""),$("#"+l+"advancedOptionsClose").css("display","none"),$("#"+l+"advancedOptions").slideUp(function(){$("#"+l+"advancedSearchButton").fadeIn(),$("#"+l+"searchtxt").css("display","inline"),$("#"+l+"searchtxt").animate({width:e},400,"swing"),$("#"+l+"searchtxt").focus()})});e=0;$("#"+l+"advancedOptionsClose").on("keydown",function(t){13==t.keyCode&&(localStorage.setItem(i+".search",""),$("#"+l+"searchtxt").val(""),v(""),$("#"+l+"advancedOptionsClose").css("display","none"),$("#"+l+"advancedOptions").slideUp(function(){$("#"+l+"advancedSearchButton").fadeIn(),$("#"+l+"searchtxt").css("display","inline"),$("#"+l+"searchtxt").animate({width:e},400,"swing"),$("#"+l+"searchtxt").focus()}))}),$("#"+l+"advancedSearchButton").on("click",function(){e=$("#"+l+"searchtxt").width(),$("#"+l+"advancedSearchButton").fadeOut(),$("#"+l+"searchtxt").animate({width:"0px"},400,"swing",function(){$("#"+l+"searchtxt").css("display","none"),$("#"+l+"advancedOptions").slideDown(function(){$("#"+l+"advancedOptionsClose").fadeIn()}),$("#"+l+"advancedOptions").css("display","inline"),$(".chosen").chosen({disable_search_threshold:6}),m(),$("#"+l+"widgetMat_0").focus()})}),$("#"+l+"advancedSearchApply").on("click",function(){w(),T()}),$("#"+l+"addTerm").on("click",function(){S(),$(".chosen").chosen({disable_search_threshold:6})}),$("#"+l+"searchtxt").on("keydown",function(t){w(),o=0,13==t.keyCode&&v($("#"+l+"searchtxt").val())}),S()}function m(t){var e=!0,i={};try{i=null!=t?t:JSON.parse(f())}catch(t){e=!1}if(e&&null!=i&&c<=i.length){for(var a=1;a<i.length;a++)S();for(a=0;a<i.length;a++)$("#"+l+"widgetTerm_"+a).val(i[a].id),$("#"+l+"widgetTerm_"+a).trigger("chosen:updated"),null!=i[a].indicatorID||"serviceID"==i[a].id||"categoryID"==i[a].id||"stepID"==i[a].id?x(a,function(t,e,i,a){return function(){$("#"+l+"widgetIndicator_"+t).val(e),$("#"+l+"widgetIndicator_"+t).trigger("chosen:updated"),$("#"+l+"widgetCod_"+t).val(i),$("#"+l+"widgetCod_"+t).trigger("chosen:updated"),$("#"+l+"widgetMat_"+t).val(a.replace(/\*/g,"")),$("#"+l+"widgetMat_"+t).trigger("chosen:updated")}}(a,i[a].indicatorID,i[a].operator,i[a].match)):x(a),$("#"+l+"widgetCod_"+a).val(i[a].operator),"string"==typeof i[a].match&&$("#"+l+"widgetMat_"+a).val(i[a].match.replace(/\*/g,""))}}function f(){return localStorage.getItem(i+".search")}function v(t){return"*"!=t&&localStorage.setItem(i+".search",t),e(t)}function y(){$("#"+l+"searchtxt").focus()}function w(){$("#"+l+"searchIcon").css("display","none"),$("#"+l+"searchIconBusy").css("display","inline")}function _(){$("#"+l+"searchIcon").css("display","inline"),$("#"+l+"searchIconBusy").css("display","none")}function b(t,e){null==e&&(e="userName"),"undefined"==typeof employeeSelector?($("head").append('<link type="text/css" rel="stylesheet" href="'+a+'/css/employeeSelector.css" />'),$.ajax({type:"GET",url:a+"/js/employeeSelector.js",dataType:"script",success:function(){empSel=new employeeSelector(l+"widgetEmp_"+t),empSel.apiPath=a+"/api/",empSel.rootPath=a+"/",empSel.outputStyle="micro",empSel.setSelectHandler(function(){null!=empSel.selectionData[empSel.selection]&&(selection="empUID"==e?empSel.selection:empSel.selectionData[empSel.selection].userName,$("#"+l+"widgetMat_"+t).val(selection))}),empSel.setResultHandler(function(){null!=empSel.selectionData[empSel.selection]&&(selection="empUID"==e?empSel.selection:empSel.selectionData[empSel.selection].userName,$("#"+l+"widgetMat_"+t).val(selection))}),empSel.initialize()}})):(empSel=new employeeSelector(l+"widgetEmp_"+t),empSel.apiPath=a+"/api/",empSel.rootPath=a+"/",empSel.outputStyle="micro",empSel.setSelectHandler(function(){null!=empSel.selectionData[empSel.selection]&&(selection="empUID"==e?empSel.selection:empSel.selectionData[empSel.selection].userName,$("#"+l+"widgetMat_"+t).val(selection))}),empSel.setResultHandler(function(){null!=empSel.selectionData[empSel.selection]&&(selection="empUID"==e?empSel.selection:empSel.selectionData[empSel.selection].userName,$("#"+l+"widgetMat_"+t).val(selection))}),empSel.initialize())}function I(t){"undefined"==typeof positionSelector?($("head").append('<link type="text/css" rel="stylesheet" href="'+a+'/css/positionSelector.css" />'),$.ajax({type:"GET",url:a+"/js/positionSelector.js",dataType:"script",success:function(){posSel=new positionSelector(l+"widgetPos_"+t),posSel.apiPath=a+"/api/",posSel.rootPath=a+"/",posSel.setSelectHandler(function(){$("#"+l+"widgetMat_"+t).val(posSel.selection)}),posSel.setResultHandler(function(){$("#"+l+"widgetMat_"+t).val(posSel.selection)}),posSel.initialize()}})):(posSel=new positionSelector(l+"widgetPos_"+t),posSel.apiPath=a+"/api/",posSel.rootPath=a+"/",posSel.setSelectHandler(function(){$("#"+l+"widgetMat_"+t).val(posSel.selection)}),posSel.setResultHandler(function(){$("#"+l+"widgetMat_"+t).val(posSel.selection)}),posSel.initialize())}function D(t){"undefined"==typeof groupSelector?($("head").append('<link type="text/css" rel="stylesheet" href="'+a+'/css/groupSelector.css" />'),$.ajax({type:"GET",url:a+"/js/groupSelector.js",dataType:"script",success:function(){grpSel=new groupSelector(l+"widgetGrp_"+t),grpSel.apiPath=a+"/api/",grpSel.rootPath=a+"/",grpSel.setSelectHandler(function(){$("#"+l+"widgetMat_"+t).val(grpSel.selection)}),grpSel.setResultHandler(function(){$("#"+l+"widgetMat_"+t).val(grpSel.selection)}),grpSel.initialize()}})):(grpSel=new groupSelector(l+"widgetGrp_"+t),grpSel.apiPath=a+"/api/",grpSel.rootPath=a+"/",grpSel.setSelectHandler(function(){$("#"+l+"widgetMat_"+t).val(grpSel.selection)}),grpSel.setResultHandler(function(){$("#"+l+"widgetMat_"+t).val(grpSel.selection)}),grpSel.initialize())}function x(r,o){switch($("#"+l+"widgetTerm_"+r).val()){case"title":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" class="chosen"  aria-label="title" style="width: 120px">\t\t\t\t\t\t<option value="LIKE">CONTAINS</option>\t\t\t\t\t\t<option value="NOT LIKE">DOES NOT CONTAIN</option>\t            \t\t<option value="=">=</option>\t\t\t\t\t\t<option value="!=">!=</option>\t            \t</select>'),$("#"+l+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+l+"widgetMat_"+r+'" style="width: 250px" />');break;case"serviceID":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" class="chosen"  aria-label="title" style="width: 120px">                        <option value="=">IS</option>                        <option value="!=">IS NOT</option>                    </select>'),$.ajax({type:"GET",url:"./api/?a=system/services",dataType:"json",success:function(t){var e='<select id="'+l+"widgetMat_"+r+'" class="chosen" aria-label="services" style="width: 250px">';for(var i in t)e+='<option value="'+t[i].groupID+'">'+t[i].groupTitle+"</option>";e+="</select>",$("#"+l+"widgetMatch_"+r).html(e),$(".chosen").chosen({disable_search_threshold:6}),null!=o&&o()}});break;case"date":case"dateInitiated":case"dateSubmitted":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" style="width: 140px" class="chosen" aria-label="date">\t            \t\t<option value="=">ON</option>\t            \t\t<option value=">=">ON AND AFTER</option>\t            \t\t<option value="<=">ON AND BEFORE</option>\t            \t</select>'),$("#"+l+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+l+"widgetMat_"+r+'" style="width: 200px" />'),jQuery.ui?$("#"+l+"widgetMat_"+r).datepicker():$.getScript("../libs/js/jquery/jquery-ui.custom.min.js",function(){$("#"+l+"widgetMat_"+r).datepicker()});break;case"categoryID":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" style="width: 140px" class="chosen" aria-label="categoryID">\t            \t\t<option value="=">IS</option>\t            \t\t<option value="!=">IS NOT</option>\t            \t</select>'),$.ajax({type:"GET",url:"./api/?a=workflow/categoriesUnabridged",dataType:"json",success:function(t){var e='<select id="'+l+"widgetMat_"+r+'" class="chosen" aria-label="categories" style="width: 250px">';for(var i in t)e+='<option value="'+t[i].categoryID+'">'+t[i].categoryName+"</option>";e+="</select>",$("#"+l+"widgetMatch_"+r).html(e),$(".chosen").chosen({disable_search_threshold:6}),null!=o&&o()},cache:!1});break;case"userID":$("#"+l+"widgetCondition_"+r).html('<input type="hidden" id="'+l+"widgetCod_"+r+'" value="=" /> IS'),$("#"+l+"widgetMatch_"+r).html('<div id="'+l+"widgetEmp_"+r+'" style="width: 280px"></div><input type="hidden" id="'+l+"widgetMat_"+r+'" />'),b(r);break;case"dependencyID":$("#"+l+"widgetCondition_"+r).html('<input type="hidden" id="'+l+"widgetCod_"+r+'" value="=" /> ='),$.ajax({type:"GET",url:"./api/?a=workflow/dependencies",dataType:"json",success:function(t){var e='<select id="'+l+"widgetIndicator_"+r+'" class="chosen" aria-label="dependencies" style="width: 250px">';for(var i in t)e+='<option value="'+t[i].dependencyID+'">'+t[i].description+"</option>";e+="</select>",$("#"+l+"widgetTerm_"+r).after(e);var a='<select id="'+l+"widgetMat_"+r+'" class="chosen" aria-label="options" style="width: 250px">';a+='<option value="1">Reviewed</option>',a+='<option value="0">Not Reviewed</option>',a+='<option value="-1">Returned to a previous step</option>',a+="</select>",$("#"+l+"widgetMatch_"+r).html(a),$(".chosen").chosen({disable_search_threshold:6}),$("#"+l+"widgetTerm_"+r+"_chosen").css("display","none"),null!=o&&o()},cache:!1});break;case"stepID":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" style="width: 140px" class="chosen" aria-label="categoryID">\t            \t\t<option value="=">IS</option>\t            \t\t<option value="!=">IS NOT</option>\t            \t</select>'),$.ajax({type:"GET",url:"./api/?a=workflow/steps",dataType:"json",success:function(t){var e='<select id="'+l+"widgetMat_"+r+'" class="chosen" aria-label="stepID" style="width: 250px">';for(var i in e+='<option value="submitted">Submitted</option>',e+='<option value="deleted">Cancelled</option>',e+='<option value="resolved">Resolved</option>',t)e+='<option value="'+t[i].stepID+'">'+t[i].description+": "+t[i].stepTitle+"</option>";e+="</select>",$("#"+l+"widgetMatch_"+r).html(e),$(".chosen").chosen({disable_search_threshold:6}),null!=o&&o()},cache:!1});break;case"data":$.ajax({type:"GET",url:"./api/?a=form/indicator/list",dataType:"json",success:function(n){var t='<select id="'+l+"widgetIndicator_"+r+'" class="chosen" aria-label="data" style="width: 250px">';for(var e in t+='<option value="'+u+'">Any standard data field</option>',t+='<option value="'+h+'">Any Org. Chart employee field</option>',n)t+='<option value="'+n[e].indicatorID+'">'+n[e].categoryName+": "+n[e].name+"</option>";t+="</select><br />",$("#"+l+"widgetTerm_"+r).after(t),$(".chosen").chosen({disable_search_threshold:6}),$("#"+l+"widgetIndicator_"+r).css("float","right"),$("#"+l+"widgetIndicator_"+r).on("change chosen:updated",function(){for(var t in iID=$("#"+l+"widgetIndicator_"+r).val(),iID==u?($("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t\t\t<option value="LIKE">CONTAINS</option>\t\t\t\t\t\t\t\t\t\t<option value="NOT LIKE">DOES NOT CONTAIN</option>\t\t\t\t\t            \t\t<option value="=">=</option>\t\t\t\t\t\t\t\t\t\t<option value="!=">!=</option>\t\t\t\t\t            \t</select>'),$("#"+l+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+l+"widgetMat_"+r+'" style="width: 200px" />'),$(".chosen").chosen({disable_search_threshold:6})):iID==h&&($("#"+l+"widgetCondition_"+r).html('<input type="hidden" id="'+l+"widgetCod_"+r+'" value="=" /> IS'),$("#"+l+"widgetMatch_"+r).html('<div id="'+l+"widgetEmp_"+r+'" style="width: 280px"></div><input type="hidden" id="'+l+"widgetMat_"+r+'" />'),b(r,"empUID")),n)if(n[t].indicatorID==iID){var e=n[t].format.indexOf("\n");switch(-1==e?n[t].format:n[t].format.substr(0,e).trim()){case"number":case"currency":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" class="chosen" aria-label="currency" style="width: 55px">\t\t\t\t\t\t\t\t            \t\t<option value="=">=</option>\t\t\t\t\t\t\t\t            \t\t<option value=">">></option>\t\t\t\t\t\t\t\t            \t\t<option value=">=">>=</option>\t\t\t\t\t\t\t\t            \t\t<option value="<"><</option>\t\t\t\t\t\t\t\t            \t\t<option value="<="><=</option>\t\t\t\t\t\t\t\t            \t</select>'),$(".chosen").chosen({disable_search_threshold:6});break;case"date":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" style="width: 140px" class="chosen" aria-label="date">                            \t            \t\t<option value="=">ON</option>                            \t            \t\t<option value=">=">ON AND AFTER</option>                            \t            \t\t<option value="<=">ON AND BEFORE</option>                            \t            \t</select>'),$("#"+l+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+l+"widgetMat_"+r+'" style="width: 200px" />'),jQuery.ui?$("#"+l+"widgetMat_"+r).datepicker():$.getScript("../libs/js/jquery/jquery-ui.custom.min.js",function(){$("#"+l+"widgetMat_"+r).datepicker()}),$(".chosen").chosen({disable_search_threshold:6});break;case"orgchart_employee":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t            \t\t<option value="=">IS</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="!=">IS NOT</option>\t\t\t\t\t\t\t\t            \t</select>'),$("#"+l+"widgetMatch_"+r).html('<div id="'+l+"widgetEmp_"+r+'" style="width: 280px"></div><input type="hidden" id="'+l+"widgetMat_"+r+'" />'),$(".chosen").chosen({disable_search_threshold:6}),b(r,"empUID");break;case"orgchart_position":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t            \t\t<option value="=">IS</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="!=">IS NOT</option>\t\t\t\t\t\t\t\t            \t</select>'),$("#"+l+"widgetMatch_"+r).html('<div id="'+l+"widgetPos_"+r+'" style="width: 280px"></div><input type="hidden" id="'+l+"widgetMat_"+r+'" />'),$(".chosen").chosen({disable_search_threshold:6}),I(r);break;case"orgchart_group":$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t            \t\t<option value="=">IS</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="!=">IS NOT</option>\t\t\t\t\t\t\t\t            \t</select>'),$("#"+l+"widgetMatch_"+r).html('<div id="'+l+"widgetGrp_"+r+'" style="width: 280px"></div><input type="hidden" id="'+l+"widgetMat_"+r+'" />'),$(".chosen").chosen({disable_search_threshold:6}),D(r);break;case"dropdown":case"radio":$("#"+l+"widgetCondition_"+r).html('<input type="hidden" id="'+l+"widgetCod_"+r+'" value="=" /> IS');var i=n[t].format.split("\n");i.shift();var a='<select id="'+l+"widgetMat_"+r+'" class="chosen" aria-label="options" style="width: 250px">';for(var t in i){var o=-1==i[t].indexOf("default:")?i[t].trim():i[t].substr(8).trim();a+='<option value="'+o+'">'+o+"</option>"}a+="</select>",$("#"+l+"widgetMatch_"+r).html(a),$(".chosen").chosen({disable_search_threshold:6});break;default:$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 120px">\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="LIKE">CONTAINS</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="NOT LIKE">DOES NOT CONTAIN</option>\t\t\t\t\t\t\t\t            \t\t<option value="=">=</option>\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="!=">!=</option>\t\t\t\t\t\t\t\t            \t</select>'),$("#"+l+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+l+"widgetMat_"+r+'" style="width: 200px" />'),$(".chosen").chosen({disable_search_threshold:6})}}}),$("#"+l+"widgetTerm_"+r+"_chosen").css("display","none"),null!=o&&o()},cache:!1});break;default:$("#"+l+"widgetCondition_"+r).html('<select id="'+l+"widgetCod_"+r+'" class="chosen" aria-label="condition" style="width: 55px">\t\t            \t\t<option value="=">=</option>\t\t            \t\t<option value=">">></option>\t\t            \t\t<option value=">=">>=</option>\t\t            \t\t<option value="<"><</option>\t\t            \t\t<option value="<="><=</option>\t\t            \t\t<option value="LIKE">CONTAINS</option>\t\t            \t</select>'),$("#"+l+"widgetMatch_"+r).html('<input type="text" aria-label="text" id="'+l+"widgetMat_"+r+'" style="width: 200px" />')}}function S(){$('<tr id="'+l+"widget_"+c+'">\t\t\t\t\t\t<td id="'+l+"widgetRemove_"+c+'"><button id="widgetRemoveButton"><img src="'+p+'../libs/dynicons/?img=list-remove.svg&w=16" style="cursor: pointer" alt="remove search term" /></button></td>\t\t\t\t\t\t<td><select id="'+l+"widgetTerm_"+c+'" style="width: 150px" class="chosen" aria-label="condition">            \t\t\t\t<option value="title">Title</option>            \t\t\t\t<option value="serviceID">Service</option>            \t\t\t\t<option value="dateSubmitted">Date Submitted</option>            \t\t\t\t<option value="categoryID">Type</option>            \t\t\t\t<option value="userID">Initiator</option>            \t\t\t\t<option value="dependencyID">Requirement</option>            \t\t\t\t<option value="stepID">Current Status</option>            \t\t\t\t<option value="data">Data Field</option>            \t\t\t\t</select></td>\t\t\t            <td id="'+l+"widgetCondition_"+c+'"></td>\t\t\t\t\t\t<td id="'+l+"widgetMatch_"+c+'"></td>\t\t\t\t\t  </tr>').appendTo("#"+l+"searchTerms"),x(c),$("#"+l+"widgetTerm_"+c).on("change","",c,function(t){x(t.data),$(".chosen").chosen({disable_search_threshold:6})}),$("#"+l+"widgetRemove_"+c).on("click","",c,function(t){$("#"+l+"widget_"+t.data).remove()}),c++}function T(){d.clearTerms();for(var t=0;t<c;t++)null!=$("#"+l+"widgetTerm_"+t).val()&&(term=$("#"+l+"widgetTerm_"+t).val(),"data"!=term&&"dependencyID"!=term?(id=$("#"+l+"widgetTerm_"+t).val(),cod=$("#"+l+"widgetCod_"+t).val(),match=$("#"+l+"widgetMat_"+t).val(),"LIKE"==cod&&(match="*"+match+"*"),d.addTerm(id,cod,match)):(id=$("#"+l+"widgetTerm_"+t).val(),indicatorID=$("#"+l+"widgetIndicator_"+t).val(),cod=$("#"+l+"widgetCod_"+t).val(),match=$("#"+l+"widgetMat_"+t).val(),"LIKE"==cod&&(match="*"+match+"*"),d.addDataTerm(id,indicatorID,cod,match)));0<d.getQuery().terms.length?$("#"+l+"searchtxt").val(JSON.stringify(d.getQuery().terms)):$("#"+l+"searchtxt").val("*")}return{init:function(){if(g(),r=setInterval(function(){!function(){if(null==$("#"+l+"searchtxt"))return clearInterval(r);if(400<(o+=5e3<o?0:200)){var t=$("#"+l+"searchtxt").val();""!=t&&t!=n?(n=t,null!=s&&s.abort(),s=v(t)):(""==t&&(t!=n&&v(""),n=t,$("#"+this.prefixID+"_result").html(""),0),_())}}()},200),/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||y(),null==f())v("*");else{var t=f(),e=!0;try{JSON.parse(t)}catch(t){e=!1}"["!=t.substr(0,1)&&(e=!1),e?($("#"+l+"advancedSearchButton").click(),v(t)):(""==t&&v("*"),$("#"+l+"searchtxt").val(t))}},renderUI:g,setOrgchartPath:function(t){a=t},focus:y,getPrefixID:function(){return l},getSearchInput:function(){return $("#"+l+"searchtxt").val()},getResultContainerID:function(){return l+"_result"},getLastSearch:f,generateQuery:T,getLeafFormQuery:function(){return d},renderPreviousAdvancedSearch:m,setSearchFunc:function(t){e=t},search:v,showBusy:w,showNotBusy:_,setRootURL:function(t){p=t}}};