var form,workflow,formValidator={},LeafForm=function(e){e=e;var a,o,i="LeafForm"+Math.floor(1e3*Math.random())+"_",d=i+"record",r=0;function n(){if(0==r)return console.log("recordID not set"),0;var t=$("#"+a.btnSaveID).html();$("#"+a.btnSaveID).empty().html('<img src="images/indicator.gif" alt="saving" /> Saving...'),$("#"+d).find(":input:disabled").removeAttr("disabled");var n={recordID:r};$("#"+d).serializeArray().map(function(e){n[e.name]=e.value}),$.ajax({type:"POST",url:"ajaxIndex.php?a=domodify",data:n,dataType:"text",success:function(e){null!=o&&o(),$("#"+a.btnSaveID).empty().html(t)},cache:!1})}return $("#"+e).html('<div id="'+i+'xhrDialog" style="display: none; background-color: white; border-style: none solid solid; border-width: 0 1px 1px; border-color: #e0e0e0; padding: 4px">\t\t\t<form id="'+i+'record" enctype="multipart/form-data" action="javascript:void(0);">\t\t\t    <div>\t\t\t        <button id="'+i+'button_cancelchange" class="buttonNorm" style="position: absolute; left: 10px"><img src="../libs/dynicons/?img=process-stop.svg&amp;w=16" alt="cancel" /> Cancel</button>\t\t\t        <button id="'+i+'button_save" class="buttonNorm" style="position: absolute; right: 10px"><img src="../libs/dynicons/?img=media-floppy.svg&amp;w=16" alt="save" /> Save Change</button>\t\t\t        <div style="border-bottom: 2px solid black; line-height: 30px"><br /></div>\t\t\t        <div id="'+i+'loadIndicator" style="visibility: hidden; position: absolute; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; height: 300px; width: 460px">Loading... <img src="images/largespinner.gif" alt="loading..." /></div>\t\t\t        <div id="'+i+'xhr" style="width: 540px; height: 420px; padding: 8px; overflow: auto"></div>\t\t\t    </div>\t\t\t</form>\t\t\t</div>'),a=new dialogController(i+"xhrDialog",i+"xhr",i+"loadIndicator",i+"button_save",i+"button_cancelchange"),{dialog:function(){return a},getHtmlFormID:function(){return d},serializeData:function(){return $("#"+d).serialize()},setRecordID:function(e){r=e},setPostModifyCallback:function(e){o=e},doModify:n,getForm:function(e,t){if(0==r)return console.log("recordID not set"),0;a.indicateBusy(),a.setSaveHandler(function(){n()}),formValidator=new Object,formRequired=new Object,$.ajax({type:"GET",url:"ajaxIndex.php?a=getindicator&recordID="+r+"&indicatorID="+e+"&series="+t,dataType:"text",success:function(e){for(var t in a.setTitle("Editing #"+r),a.setContent(e),formValidator){var n=t.slice(2);a.setValidator(n,formValidator[t].setValidator),a.setValidatorError(n,formValidator[t].setValidatorError),a.setValidatorOk(n,formValidator[t].setValidatorOk)}for(var t in formRequired)n=t.slice(2),a.setRequired(n,formRequired[t].setRequired),a.setRequiredError(n,formRequired[t].setRequiredError),a.setRequiredOk(n,formRequired[t].setRequiredOk);a.enableLiveValidation()},error:function(e){a.setContent("Error: "+e)},cache:!1})},initCustom:function(e,t,n,o,r){a=new dialogController(e,t,n,o,r),i="",d="record"},setHtmlFormID:function(e){d=e}}},workflowModule=new Object,LeafWorkflow=function(a,i){a=a,i=i,Math.floor(1e3*Math.random());var d,s=0,l=0;function c(e){return bgColor=parseInt(e.substring(1),16),r=(16711680&bgColor)>>16,g=(65280&bgColor)>>8,b=255&bgColor,factor=-.1,r+=Math.round(r*factor),g+=Math.round(g*factor),b+=Math.round(b*factor),"#"+((r<<16)+(g<<8)+b).toString(16)}function u(o){if(1==l)return 1;l=1,$("#workflowbox_dep"+o.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Applying action... <img src="images/largespinner.gif" alt="loading..." /></div>'),$.ajax({type:"POST",url:"api/?a=formWorkflow/"+s+"/apply",data:o,success:function(e){if(0==e.errors.length)$("#workflowbox_dep"+o.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Action applied!</div>'),$("#workflowbox_dep"+o.dependencyID).hide("blind",500),m(s),null!=d&&d();else{var t="";for(var n in e.errors)t+=e.errors[n]+"<br />";$("#workflowbox_dep"+o.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%"><img src="../libs/dynicons/?img=dialog-error.svg&w=48" style="vertical-align: middle" alt="error icon" /> '+t+'<br /><span style="font-size: 14px; font-weight: normal">After resolving the errors, <button id="workflowbtn_tryagain" class="buttonNorm">click here to try again</button>.</span></div>'),$("#workflowbtn_tryagain").on("click",function(){m(s)})}l=0},error:function(e){$("#workflowbox_dep"+o.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Error: Workflow Events may not have triggered</div>')}})}function p(e){var t=null==e.description?"Your workflow is missing a requirement. Please check your workflow.":e.description;for(var n in $("#"+a).append('<div id="workflowbox_dep'+e.dependencyID+'" class="workflowbox">                <span>                <div id="stepDescription_dep'+e.dependencyID+'" style="background-color: '+c(e.stepBgColor)+'; padding: 8px">'+t+'</div>                </span>                <form id="form_dep'+e.dependencyID+'" enctype="multipart/form-data" action="#">                    <div id="form_dep_extension'+e.dependencyID+'"></div>                </form>                </div>'),$("#workflowbox_dep"+e.dependencyID).css({padding:"0px","background-color":e.stepBgColor,border:e.stepBorder}),$("#workflowbox_dep"+e.dependencyID+" span").css({"font-size":"120%","font-weight":"bold",color:e.stepFontColor}),$("#form_dep"+e.dependencyID).append('<div id="form_dep_container'+e.dependencyID+'">                <span class="noprint" aria-label="comments">Comments:</span><br />                <textarea id="comment_dep'+e.dependencyID+'" aria-label="comment text area"></textarea>                </div>'),$("#form_dep_container"+e.dependencyID).css({margin:"auto",width:"95%",padding:"8px"}),$("#workflowbox_dep"+e.dependencyID).append('<br style="clear: both"/>'),$("#comment_dep"+e.dependencyID).css({height:"40px",width:"100%",padding:"4px",resize:"vertical"}),e.dependencyActions){var o="";""!=e.dependencyActions[n].actionIcon&&(o='<img src="../libs/dynicons/?img='+e.dependencyActions[n].actionIcon+'&amp;w=22" alt="'+e.dependencyActions[n].actionText+'" style="vertical-align: middle" />'),$("#form_dep_container"+e.dependencyID).append('<div id="button_container'+e.dependencyID+"_"+e.dependencyActions[n].actionType+'" style="float: '+e.dependencyActions[n].actionAlignment+'">\t\t            <button type="button" id="button_step'+e.dependencyID+"_"+e.dependencyActions[n].actionType+'" class="button">\t\t            '+o+" "+e.dependencyActions[n].actionText+"\t\t            </button>\t\t            </div>"),$("#button_step"+e.dependencyID+"_"+e.dependencyActions[n].actionType).css({border:"1px solid black",padding:"6px",margin:"4px"}),$("#button_step"+e.dependencyID+"_"+e.dependencyActions[n].actionType).on("click",{step:e,idx:n},function(e){var t=new Object;t.comment=$("#comment_dep"+e.data.step.dependencyID).val(),t.actionType=e.data.step.dependencyActions[e.data.idx].actionType,t.dependencyID=e.data.step.dependencyID,t.CSRFToken=i,0<e.data.step.dependencyActions[e.data.idx].fillDependency&&void 0!==workflowModule[e.data.step.dependencyID]?workflowModule[e.data.step.dependencyID].trigger(function(){u(t)}):u(t)})}for(var r in e.jsSrcList)$.ajax({type:"GET",url:e.jsSrcList[r],dataType:"script",success:function(){workflowModule[e.dependencyID].init(s)}})}function f(t){$("#"+a).append('<div id="workflowbox_dep'+t.dependencyID+'" class="workflowbox"></div>'),$("#workflowbox_dep"+t.dependencyID).css({"background-color":t.stepBgColor,border:t.stepBorder,"text-align":"center",padding:"8px"}),-1==t.dependencyID?$.ajax({type:"GET",url:"api/?a=form/customData/_"+recordID+"/_"+t.indicatorID_for_assigned_empUID,success:function(e){$("#workflowbox_dep"+t.dependencyID).append("<span>Pending action from "+e[recordID].s1["id"+t.indicatorID_for_assigned_empUID]+"</span>"),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:t.stepFontColor})}}):-3==t.dependencyID?$.ajax({type:"GET",url:"api/?a=form/customData/_"+recordID+"/_"+t.indicatorID_for_assigned_groupID,success:function(e){$("#workflowbox_dep"+t.dependencyID).append("<span>Pending action from "+t.description+"</span>"),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:t.stepFontColor})}}):($("#workflowbox_dep"+t.dependencyID).append("<span>Pending "+t.description+"</span>"),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:t.stepFontColor}))}function m(o){$("#"+a).empty(),$("#"+a).css("display","none"),l=0,s=o,$.ajax({type:"GET",url:"api/?a=formWorkflow/"+o+"/currentStep",dataType:"json",success:function(e){for(var t in e)1==e[t].hasAccess?p(e[t]):f(e[t]);var n,r;n=o,r=e,$.ajax({type:"GET",url:"api/?a=formWorkflow/"+n+"/lastAction",dataType:"json",success:function(e){if(null==e)return null==r&&$("#"+a).append("No actions available"),null;e.stepBgColor=null==e.stepBgColor?"#e0e0e0":e.stepBgColor,e.stepFontColor=null==e.stepFontColor?"#000000":e.stepFontColor,e.stepBorder=null==e.stepBorder?"1px solid black":e.stepBorder;var t=5==e.dependencyID?e.categoryName:e.description;if(null!=r){5!=e.dependencyID&&($("#"+a).append('<div id="workflowbox_lastAction" class="workflowbox" style="padding: 0px; margin-top: 8px"></div>'),$("#workflowbox_lastAction").css({"background-color":e.stepBgColor,border:e.stepBorder}));var n=new Date(1e3*e.time),o="";null!=e.description&&null!=e.actionText?(o='<div style="background-color: '+c(e.stepBgColor)+'; padding: 4px"><span style="float: left; font-size: 90%">'+t+": "+e.actionTextPasttense+"</span>",o+='<span style="float: right; font-size: 90%">'+n.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+"</span><br /></div>",""!=e.comment&&null!=e.comment&&(o+='<div style="font-size: 80%; padding: 4px 8px 4px 8px">Comment:<br /><div style="font-weight: normal; padding-left: 16px; font-size: 12px">'+e.comment+"</div></div>")):o="[ Please refer to this request's history for current status ]",5!=e.dependencyID&&$("#workflowbox_lastAction").append('<span style="font-weight: bold; color: '+e.stepFontColor+'">'+o+"</span>")}else $("#workflowcontent").append('<div id="workflowbox_lastAction"></div>'),$("#workflowbox_lastAction").css({"background-color":e.stepBgColor,border:e.stepBorder,"text-align":"center",padding:"0px"}),$("#workflowbox_lastAction").addClass("workflowbox"),n=new Date(1e3*e.time),o="",null!=e.description&&null!=e.actionText?(o='<div style="padding: 4px; background-color: '+c(e.stepBgColor)+'">'+t+": "+e.actionTextPasttense,o+='<br /><span style="font-size: 60%">'+n.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+"</span></div>",""!=e.comment&&null!=e.comment&&(o+='<div style="padding: 4px 16px"><fieldset style="border: 1px solid black"><legend class="noprint">Comment</legend><span style="font-size: 80%; font-weight: normal">'+e.comment+"</span></fieldset></div>")):o="[ Please refer to this request's history for current status. ]",$("#workflowbox_lastAction").append('<span style="font-size: 150%; font-weight: bold", color: '+e.stepFontColor+">"+o+"</span>")},cache:!1}),$("#"+a).show("blind",250)},cache:!1})}return{getWorkflow:m,setActionSuccessCallback:function(e){d=e}}},LeafFormGrid=function(s,e){s=s;var u,p,f="LeafFormGrid"+Math.floor(1e3*Math.random())+"_",g=!0,m=[],h=0,l=!1,b=50,y=50,c="#d1dfff",x={},a=null,v=null,w=null,I="",D=!0,k=!1;$("#"+s).html('<div id="'+f+'grid"></div><div id="'+f+'form" style="display: none"></div>'),$("#"+f+"grid").html('<div style="position: relative"><div id="'+f+'gridToolbar" style="display: none; width: 90px; margin: 0 0 0 auto; text-align: right"></div></div><div id="'+f+'table_stickyHeader" style="display: none"></div><table id="'+f+'table" class="leaf_grid"><thead id="'+f+'thead" aria-label="Search Results"></thead><tbody id="'+f+'tbody"></tbody><tfoot id="'+f+'tfoot"></tfoot></table>'),$("#"+f+"thead").css({"background-color":c}),null==e&&(u=new LeafForm(f+"form"));var T=0;function _(n,e){"recordID"!=n&&y!=1/0&&P(0,1/0),$("."+f+"sort").css("display","none"),"asc"==e.toLowerCase()?($("#"+f+"header_"+n+"_sort").html(" &#9650;"),$("#"+f+"header_"+n+"_sort").css("vertical-align","super")):($("#"+f+"header_"+n+"_sort").html(" &#9660;"),$("#"+f+"header_"+n+"_sort").css("vertical-align","sub")),$("#"+f+"header_"+n+"_sort").css("display","inline");var t,o=[],r=$.isNumeric(n),a=!1,i="id"+n;for(var d in m)m[d].recordID=parseInt(m[d].recordID),null==m[d][n]&&(m[d][n]=$("#"+f+m[d].recordID+"_"+n).html(),m[d][n]=null==m[d][n]?"":m[d][n],m[d][n]=m[d][n].replace(/[\u200B-\u200E]/g,"")),r?(null==m[d].s1&&(m[d].s1={}),null!=m[d].s1[i]&&""!=m[d].s1[i]||(null==m[d].sDate&&(m[d].sDate={}),m[d].s1[i]="",m[d].sDate[n]=0),t=null,!isNaN(m[d].s1[i])||-1==m[d].s1[i].indexOf("-")&&-1==m[d].s1[i].indexOf("/")||(t=Date.parse(m[d].s1[i])),(a||null!=t&&!isNaN(t))&&(a=!0,null==m[d].sDate&&(m[d].sDate={}),m[d].sDate[n]=0,m[d].sDate[n]=isNaN(t)?0:t),$.isNumeric(m[d].s1[i])&&(m[d].s1[i]=parseFloat(m[d].s1[i]))):((t=null)==m[d].sDate&&(m[d].sDate={}),m[d].sDate[n]=0,!isNaN(m[d][n])||-1==m[d][n].indexOf("-")&&-1==m[d][n].indexOf("/")||(t=Date.parse(m[d][n])),(a||null!=t&&!isNaN(t))&&(a=!0,m[d].sDate[n]=isNaN(t)||null==t?0:t)),o.push(m[d]);a?o.sort(function(e,t){return t.sDate[n]>e.sDate[n]?1:t.sDate[n]<e.sDate[n]?-1:0}):$.isNumeric(n)?o.sort(function(e,t){return t.s1[i]>e.s1[i]?1:t.s1[i]<e.s1[i]?-1:0}):"recordID"==n?o.sort(function(e,t){return t[n]>e[n]?1:t[n]<e[n]?-1:0}):o.sort(function(e,t){return null==e[n]&&(e[n]=""),null==t[n]&&(t[n]=""),t[n].toLowerCase()>e[n].toLowerCase()?1:t[n].toLowerCase()<e[n].toLowerCase()?-1:0}),"asc"==e&&o.reverse(),m=o}function R(){if(!D)return!1;var t=[];$("#"+f+"thead>tr>th").each(function(){t.push($(this).css("width"))}),$("#"+f+"table_stickyHeader > table").css({width:$("#"+f+"thead").css("width"),height:"30px"}),$("#"+f+"table_stickyHeader > table > thead > tr > th").each(function(e){$(this).css({width:t[e],padding:"2px","font-weight":"normal"})}),$("#"+f+"table_stickyHeader > table").css({border:"1px solid black","border-collapse":"collapse",margin:"0 2px 0"}),$("#"+f+"table_stickyHeader > table > thead > tr").css({"background-color":"black",color:"white"}),$("#"+f+"table_stickyHeader > table > thead > tr > th").css("border","1px solid #e0e0e0")}function P(e,t){k=!0,null!=v&&v(),null==t&&(t=b),y=t;var n=!1;null!=e&&0!=e||(e=0,$("#"+f+"tbody").empty(),n=!0);var o="",r=[],a=g?p.length+1:p.length;0==m.length&&$("#"+f+"tbody").append('<tr><td colspan="'+a+'" style="text-align: center">No Results</td></tr>');for(var i=0,d=e;d<m.length;d++){if(t<=i){h=d;break}for(var s in o+='<tr id="'+f+"tbody_tr"+m[d].recordID+'">',g&&(o+='<td><a href="index.php?a=printview&recordID='+m[d].recordID+'">'+m[d].recordID+"</a></td>"),p)if(0!=p[s].visible)if(null!=m[d]){var l={};l.recordID=m[d].recordID,l.indicatorID=p[s].indicatorID,l.cellContainerID=f+m[d].recordID+"_"+p[s].indicatorID,l.index=d,l.data="";var c=!1;null!=p[s].editable&&0==p[s].editable||(c=!0),$.isNumeric(l.indicatorID)?(null==m[d].s1&&(m[d].s1={}),l.data=null!=m[d].s1["id"+p[s].indicatorID]?m[d].s1["id"+p[s].indicatorID]:"",o+='<td id="'+f+m[d].recordID+"_"+p[s].indicatorID+'" data-editable="'+c+'" data-record-id="'+m[d].recordID+'" data-indicator-id="'+p[s].indicatorID+'">'+l.data+"</td>"):null!=p[s].callback?o+='<td id="'+f+m[d].recordID+"_"+p[s].indicatorID+'" data-clickable="'+c+'"></td>':o+='<td id="'+f+m[d].recordID+"_"+p[s].indicatorID+'"></td>',null!=p[s].callback&&r.push(function(e,t){return function(){e(t,x)}}(p[s].callback,l))}else o+='<td id="'+f+m[d].recordID+"_"+p[s].indicatorID+'"></td>';o+="</tr>",i++,n&&(h=d+1)}for(var d in h+t>=m.length||null==t?$("#"+f+"tfoot").html(""):$("#"+f+"tfoot").html("<tr><td colspan="+a+' style="padding: 8px; background-color: #feffd1; font-size: 120%; font-weight: bold"><img src="'+I+'images/indicator.gif" style="vertical-align: middle" alt="Loading" /> Loading more results...</td></tr>'),$("#"+f+"tbody").append(o),$("#"+f+"tbody td[data-editable=true]").addClass("table_editable"),$("#"+f+"tbody td[data-clickable=true]").addClass("table_editable"),$("#"+f+"tbody").on("click","td[data-editable=true]",function(e){u.setRecordID($(this).data("record-id"));var t=$(this).data("indicator-id");u.setPostModifyCallback(function(){var r,e;r=t,e=1,$.ajax({type:"GET",url:I+"api/?a=form/"+recordID+"/rawIndicator/"+r+"/"+e,dataType:"json",success:function(e){var t=""!=e[r].displayedValue?e[r].displayedValue:e[r].value;if("checkboxes"==e[r].format&&Array.isArray(t)){var n="";for(var o in t)"no"!=t[o]&&(n+=", "+t[o]);t=n.substr(2)}$("#"+f+recordID+"_"+r).empty().html(t),$("#"+f+recordID+"_"+r).fadeOut(250,function(){$("#"+f+recordID+"_"+r).fadeIn(250)})},cache:!1}),u.dialog().hide()}),u.getForm(t,1),u.dialog().show()}),r)r[d]();$("#"+f+"table>tbody>tr>td").css({border:"1px solid black",padding:"8px","font-size":"12px"}),null!=w&&w(),R()}function o(e){l=!0,m=e}function r(e){x=e}return{getPrefixID:function(){return f},form:function(){return u},headers:function(){return p},getCurrentData:function(){return m},hideIndex:function(){g=!1},setHeaders:function(e){p=e;var t='<tr id="'+f+'thead_tr">',n='<tr id="'+f+'tVirt_tr">';for(var o in g&&(t+='<th id="'+f+'header_UID" style="text-align: center">UID</th>',n+='<th style="text-align: center">UID</th>'),$("#"+f+"thead").html(t),g&&($("#"+f+"header_UID").css("cursor","pointer"),$("#"+f+"header_UID").on("click",null,null,function(e){T=0==T?(_("recordID","asc"),1):(_("recordID","desc"),0),P(0,1/0)}),$("#"+f+"header_UID").on("mouseover",null,null,function(e){$("#"+f+"header_UID").css("background-color","#79a2ff")}),$("#"+f+"header_UID").on("mouseout",null,null,function(e){$("#"+f+"header_UID").css({"background-color":c})})),p)if(0!=p[o].visible){var r=null!=p[o].align?p[o].align:"center";$("#"+f+"thead_tr").append('<th id="'+f+"header_"+p[o].indicatorID+'" tabindex="0"  style="text-align:'+r+'">'+p[o].name+'<span id="'+f+"header_"+p[o].indicatorID+'_sort" class="'+f+'sort"></span></th>'),n+='<th id="Vheader_'+p[o].indicatorID+'" style="text-align:'+r+'">'+p[o].name+"</th>",null!=p[o].sortable&&1!=p[o].sortable||($("#"+f+"header_"+p[o].indicatorID).css("cursor","pointer"),$("#"+f+"header_"+p[o].indicatorID).on("click",null,p[o].indicatorID,function(e){T=0==T?(_(e.data,"asc"),1):(_(e.data,"desc"),0),P(0,1/0)}),$("#"+f+"header_"+p[o].indicatorID).on("keydown",null,p[o].indicatorID,function(e){13==e.keyCode&&(T=0==T?(_(e.data,"asc"),1):(_(e.data,"desc"),0),P(0,1/0))}),$("#"+f+"header_"+p[o].indicatorID).on("mouseover",null,p[o].indicatorID,function(e){$("#"+f+"header_"+e.data).css("background-color","#79a2ff")}),$("#"+f+"header_"+p[o].indicatorID).on("mouseout",null,p[o].indicatorID,function(e){$("#"+f+"header_"+e.data).css({"background-color":c})}))}$("#"+f+"thead").append("</tr>"),n+="</tr>",$("#"+f+"table>thead>tr>th").css({border:"1px solid black",padding:"4px 2px 4px 2px","font-size":"12px"});var a,i=!1;$("#"+f+"table_stickyHeader").html("<table><thead>"+n+"</thead></table>"),$(window).on("resize",function(){R()}),$(window).on("scroll",function(){i=!0});var d=[];setInterval(function(){scrollPos=$(window).scrollTop(),tableHeight=$("#"+f+"table").height(),pageHeight=$(window).height(),i&&null!=$("#"+f+"thead").offset()&&D&&(i=!1,a=$("#"+f+"thead").offset().top,scrollPos>a&&scrollPos<tableHeight+a?($("#"+f+"table_stickyHeader").css("display","inline"),$("#"+f+"table_stickyHeader").css({position:"absolute",top:scrollPos+"px"})):$("#"+f+"table_stickyHeader").css("display","none")),scrollPos>tableHeight-.8*pageHeight&&l&&k&&null==d[h]&&(d[h]=1,P(h,b))},100)},sort:_,renderVirtualHeader:R,renderBody:P,loadData:function(e,r){m=[];var t=g?p.length+1:p.length;$("#"+f+"tbody").html('<tr><td colspan="'+t+'" style="text-align: left; padding: 8px">Building report... <img src="'+I+'images/largespinner.gif" alt="loading..." /></td></tr>');var n="";for(var o in p)$.isNumeric(p[o].indicatorID)&&(n+=p[o].indicatorID+",");$.ajax({type:"POST",url:I+"api/?a=form/customData",dataType:"json",data:{recordList:e,indicatorList:n,CSRFToken:CSRFToken},success:function(e){for(var t in l=!0,e){if(null!=x[t])for(var n in x[t])if("object"==typeof x[t][n])for(var o in x[t][n])e[t][n]=e[t][n]||{},e[t][n][o]=x[t][n][o];else e[t][n]=x[t][n];m.push(e[t])}null!=a&&(m=a(m)),_("recordID","desc"),P(0,b),null!=r&&"function"==typeof r&&r()},cache:!1})},setData:o,setDataBlob:r,importQueryResult:function(e){var t=[];for(var n in e)t.push(e[n]);o(t),r(t)},enableToolbar:function(){s=f+"gridToolbar",$("#"+s).css("display","block"),$("#"+s).html('<button type="button" id="'+f+'getExcel" class="buttonNorm"><img src="../libs/dynicons/?img=x-office-spreadsheet.svg&w=32" alt="Icon of Spreadsheet" /> Export</button>'),$("#"+f+"getExcel").on("click",function(){h!=m.length&&P(0,1/0);var n=[],o=[];$("#"+f+"thead>tr>th").each(function(e,t){o.push($(t).text().trim())});var r={},a=0,i=(document.createElement("a"),o.length-1);$("#"+f+"tbody>tr>td").each(function(e,t){r[o[a]]=$(t).text().trim(),0==a&&"UID"==o[a]&&(r[o[a]]='=HYPERLINK("'+window.location.origin+window.location.pathname+"?a=printview&recordID="+$(t).text().trim()+'", "'+$(t).text().trim()+'")'),i<++a&&(n.push(r),r={},a=0)});var e=$(document.createElement("form"));e.attr({action:I+"api/?a=converter/json&format=csv",method:"POST"});var t=$(document.createElement("input")),d=$(document.createElement("input"));t.attr({type:"hidden",name:"input",value:JSON.stringify(n)}),d.attr({type:"hidden",name:"CSRFToken",value:CSRFToken}),e.append(t),e.append(d),e.appendTo("#"+s),e.submit(),e.remove()})},setPostProcessDataFunc:function(e){a=e},setPreRenderFunc:function(e){v=e},setPostRenderFunc:function(e){w=e},setDefaultLimit:function(e){b=e},getDefaultLimit:function(){return b},getDataByIndex:function(e){return m[e]},getDataByRecordID:function(e){for(var t in m)if(m[t].recordID==e)return m[t];return null},disableVirtualHeader:function(){D=!1},stop:function(){k=!1},setRootURL:function(e){I=e}}},LeafFormQuery=function(){var a={},t=null,n="",o=!1;function e(){a={terms:[],joins:[],sort:{},getData:[]}}function r(e,t,n){var o={};o.id=e,o.operator=t,o.match=n,a.terms.push(o)}function i(e,t,n,o){var r={};r.id=e,r.indicatorID=t,r.operator=n,r.match=o,a.terms.push(r)}function d(e){a.limitOffset=e}function s(e){-1==a.joins.indexOf(e)&&a.joins.push(e)}function l(e){-1==a.getData.indexOf(e)&&a.getData.push(e)}return e(),{clearTerms:e,addTerm:r,addDataTerm:i,importQuery:function(e){for(var t in e.terms)switch(Object.keys(e.terms[t]).length){case 3:r(e.terms[t].id,e.terms[t].operator,e.terms[t].match);break;case 4:i(e.terms[t].id,e.terms[t].indicatorID,e.terms[t].operator,e.terms[t].match);break;default:console.log("Format error")}for(var t in e.joins)s(e.joins[t]);for(var t in e.getData)l(e.getData[t])},getQuery:function(){return a},getData:l,updateTerm:function(e,t,n){for(var o in a.terms)if(a.terms[o].id==e&&a.terms[o].operator==t)return void(a.terms[o].match=n);r(e,t,n)},updateDataTerm:function(e,t,n,o){for(var r in a.terms)if(a.terms[r].id==e&&a.terms[r].indicatorID==t&&a.terms[r].operator==n)return void(a.terms[r].match=o);i(e,t,n,o)},setQuery:function(e){a=e},setLimit:function(e,t){void 0===t?a.limit=e:(a.limit=t,d(e))},setLimitOffset:d,setRootURL:function(e){n=e},getRootURL:function(){return n},useJSONP:function(e){o=e},join:s,sort:function(e,t){a.sort.column=e,a.sort.direction=t},onSuccess:function(e){t=e},execute:function(){return null!=a.getData&&0==a.getData.length&&delete a.getData,0==o?$.ajax({type:"GET",url:n+"api/?a=form/query&q="+JSON.stringify(a),dataType:"json",success:t,cache:!1}):$.ajax({type:"GET",url:n+"api/?a=form/query&q="+JSON.stringify(a)+"&format=jsonp",dataType:"jsonp",success:t,cache:!1})}}};function escape(e){var t=e;return t=(t=(t=(t=t.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/"/g,"&quot;")}function diffString(e,t){e=e.replace(/\s+$/,""),t=t.replace(/\s+$/,"");var n=diff(""==e?[]:e.split(/\s+/),""==t?[]:t.split(/\s+/)),o="",r=e.match(/\s+/g);null==r?r=["\n"]:r.push("\n");var a=t.match(/\s+/g);if(null==a?a=["\n"]:a.push("\n"),0==n.n.length)for(var i=0;i<n.o.length;i++)o+='<del style="background:#FFE6E6">'+escape(n.o[i])+r[i]+"</del>";else{if(null==n.n[0].text)for(t=0;t<n.o.length&&null==n.o[t].text;t++)o+='<del style="background:#FFE6E6">'+escape(n.o[t])+r[t]+"</del>";for(i=0;i<n.n.length;i++)if(null==n.n[i].text)o+='<ins style="background:#E6FFE6;">'+escape(n.n[i])+a[i]+"</ins>";else{var d="";for(t=n.n[i].row+1;t<n.o.length&&null==n.o[t].text;t++)d+='<del style="background:#FFE6E6">'+escape(n.o[t])+r[t]+"</del>";o+=" "+n.n[i].text+a[i]+d}}return o}function randomColor(){return"rgb("+100*Math.random()+"%, "+100*Math.random()+"%, "+100*Math.random()+"%)"}function diffString2(e,t){e=e.replace(/\s+$/,""),t=t.replace(/\s+$/,"");var n=diff(""==e?[]:e.split(/\s+/),""==t?[]:t.split(/\s+/)),o=e.match(/\s+/g);null==o?o=["\n"]:o.push("\n");var r=t.match(/\s+/g);null==r?r=["\n"]:r.push("\n");for(var a="",i=new Array,d=0;d<n.o.length;d++)i[d]=randomColor(),null!=n.o[d].text?a+='<span style="background-color: '+i[d]+'">'+escape(n.o[d].text)+o[d]+"</span>":a+='<del style="background:#FFE6E6">'+escape(n.o[d])+o[d]+"</del>";var s="";for(d=0;d<n.n.length;d++)null!=n.n[d].text?s+='<span style="background-color: '+i[n.n[d].row]+'">'+escape(n.n[d].text)+r[d]+"</span>":s+='<ins style="background:#E6FFE6;">'+escape(n.n[d])+r[d]+"</ins>";return{o:a,n:s}}function diff(e,t){for(var n=new Object,o=new Object,r=0;r<t.length;r++)null==n[t[r]]&&(n[t[r]]={rows:new Array,o:null}),n[t[r]].rows.push(r);for(r=0;r<e.length;r++)null==o[e[r]]&&(o[e[r]]={rows:new Array,n:null}),o[e[r]].rows.push(r);for(var r in n)1==n[r].rows.length&&void 0!==o[r]&&1==o[r].rows.length&&(t[n[r].rows[0]]={text:t[n[r].rows[0]],row:o[r].rows[0]},e[o[r].rows[0]]={text:e[o[r].rows[0]],row:n[r].rows[0]});for(r=0;r<t.length-1;r++)null!=t[r].text&&null==t[r+1].text&&t[r].row+1<e.length&&null==e[t[r].row+1].text&&t[r+1]==e[t[r].row+1]&&(t[r+1]={text:t[r+1],row:t[r].row+1},e[t[r].row+1]={text:e[t[r].row+1],row:r+1});for(r=t.length-1;0<r;r--)null!=t[r].text&&null==t[r-1].text&&0<t[r].row&&null==e[t[r].row-1].text&&t[r-1]==e[t[r].row-1]&&(t[r-1]={text:t[r-1],row:t[r].row-1},e[t[r].row-1]={text:e[t[r].row-1],row:r-1});return{o:e,n:t}}var XSSHelpers=(buildTagRegex=function(e){return new RegExp("(<\\/?\\s*\\b"+e+"\\b(.*?)\\s*>)","g")},cleanTag=function(e){return e.replace(/<\s*\/?|>/g,"").trim()},containsTag=function(e,t){return null!==buildTagRegex(cleanTag(t)).exec(e)},containsTags=function(e,t,n){null==n&&(n=!1);for(var o=0;o<t.length;o++){var r=containsTag(e,t[o]);if(n){if(!r)return!1}else if(r)return!0}return!1},stripAllTags=function(e){return e.replace(buildTagRegex(""),"")},stripTag=function(e,t){return e.replace(buildTagRegex(cleanTag(t)),"")},stripTags=function(e,t){for(var n=0;n<t.length;n++)e=stripTag(e,t[n]);return e},{buildTagRegex:buildTagRegex,containsTag:containsTag,containsTags:containsTags,stripAllTags:stripAllTags,stripTag:stripTag,stripTags:stripTags});"undefined"!=typeof module&&(module.exports=XSSHelpers);var LEAFRequestPortalAPI=function(){var t="./api/?a=",n=PortalFormsAPI(t),o=PortalFormEditorAPI(t),r=PortalImportAPI(t),a=PortalSignaturesAPI(t),i=PortalSystemAPI(t),d=PortalWorkflowAPI(t);return{getBaseURL:function(){return t},setBaseURL:function(e){t=e,n.setBaseAPIURL(t),o.setBaseAPIURL(t),r.setBaseAPIURL(t),a.setBaseAPIURL(t),i.setBaseAPIURL(t),d.setBaseAPIURL(t)},setCSRFToken:function(e){e,n.setCSRFToken(e),o.setCSRFToken(e),r.setCSRFToken(e),a.setCSRFToken(e),i.setCSRFToken(e),d.setCSRFToken(e)},Forms:n,FormEditor:o,Import:r,Signature:a,System:i,Workflow:d}},PortalFormsAPI=function(e){var t=e,i=e+"form",d="",s=function(e,t,n,o){null!=t.title&&delete t.title;var r=i+"/"+e;t.CSRFToken=d,$.ajax({method:"POST",url:r,data:t,dataType:"json"}).done(n).fail(o)};return{getAPIURL:function(){return i},getAllForms:function(e,t){var n=i+"/categories";$.ajax({method:"GET",url:n,dataType:"json",cache:!1}).done(e).fail(t)},getBaseAPIURL:function(){return t},getIndicatorsForForm:function(e,t,n){var o=i+"/category&id="+e;$.ajax({method:"GET",url:o,dataType:"json",cache:!1}).done(t).fail(n)},modifyRequest:s,newRequest:function(e,n,o,r){var t=i+"/new",a={};a.CSRFToken=d,a["num"+e]=1,a.title=n.title,$.ajax({method:"POST",url:t,data:a,dataType:"json"}).done(function(t){s(t,n,function(e){0<e?o(t):r(!1)},r)}).fail(r)},setBaseAPIURL:function(e){i=(t=e)+"form"},setCSRFToken:function(e){d=e},setInitiator:function(e,t,n,o){var r=i+"/"+e+"/initiator",a={};a.CSRFToken=d,a.initiator=t,$.ajax({method:"POST",url:r,data:a,dataType:"json"}).done(n).fail(o)},query:function(e,t,n){var o=i+"/query/&q="+JSON.stringify(e);$.ajax({method:"GET",url:o,dataType:"json",cache:!1}).done(function(e){t(e)}).fail(function(e){n(e)})}}},PortalFormEditorAPI=function(e){var t=e,i=e+"formEditor",a="";return{getAPIURL:function(){return i},getBaseAPIURL:function(){return t},getIndicator:function(e,t,n,o,r){var a=i+"/indicator/"+e+(null!=r&&1==r?"&parseTemplate":"")+(null!=o&&null!=o?"&recordID="+o:"");$.ajax({method:"GET",url:a,dataType:"json",cache:!1}).done(function(e){t(e)}).fail(function(e){n(e)})},getIndicatorEditor:function(e,t,n,o){var r="ajaxIndex.php?a=getindicator&recordID="+t+"&indicatorID="+e+"&series=1";$.ajax({method:"GET",url:r,dataType:"html",cache:!1}).done(n).fail(o)},getIndicatorPrivileges:function(e,t,n){var o=i+"/indicator/"+e+"/privileges";$.ajax({method:"GET",url:o,dataType:"json",cache:!1}).done(function(e){t(e)}).fail(function(e){n(e)})},setBaseAPIURL:function(e){i=(t=e)+"formEditor"},setCSRFToken:function(e){a=e},removeIndicatorPrivilege:function(e,t,n,o){var r=i+"/indicator/"+e+"/privileges/remove";$.ajax({method:"POST",url:r,dataType:"text",data:{groupID:t,CSRFToken:a}}).done(function(e){n(e)}).fail(function(e){o(e)})},setIndicatorPrivileges:function(e,t,n,o){$.ajax({method:"POST",url:i+"/indicator/"+e+"/privileges",dataType:"text",data:{groupIDs:t,CSRFToken:a}}).done(function(e){n(e)}).fail(function(e){o(e)})}}},PortalImportAPI=function(e){var t=e,a=e+"import";return{getAPIURL:function(){return a},getBaseAPIURL:function(){return t},parseXLS:function(e,t,n,o){var r=a+"/xls&importFile="+e+"&hasHeaders="+(!0===t?1:0);$.ajax({method:"GET",url:r,dataType:"json",cache:!1}).done(n).fail(o)},setBaseAPIURL:function(e){a=(t=e)+"import"},setCSRFToken:function(e){e}}},PortalSignaturesAPI=function(e){var t=e,a=e+"signature",i="";return{getAPIURL:function(){return a},getBaseAPIURL:function(){return t},setBaseAPIURL:function(e){a=(t=e)+"signature"},setCSRFToken:function(e){i=e},create:function(e,t,n,o,r){$.ajax({method:"POST",url:a+"/create",dataType:"text",data:{signature:e,recordID:t,message:n,CSRFToken:i}}).done(function(e){o(e)}).fail(function(e){r(e)})}}},PortalSystemAPI=function(e){var t=e,n=e+"system";return{getAPIURL:function(){return n},getBaseAPIURL:function(){return t},getFileList:function(e,t){$.ajax({method:"GET",url:n+"/files",dataType:"json",cache:!1}).done(e).fail(t)},setBaseAPIURL:function(e){n=(t=e)+"system"},setCSRFToken:function(e){e}}},PortalWorkflowAPI=function(e){var t=e,a=e+"workflow",i="";return{getAPIURL:function(){return a},getBaseAPIURL:function(){return t},setBaseAPIURL:function(e){a=(t=e)+"workflow"},setCSRFToken:function(e){i=e},setStepSignatureRequirement:function(e,t,n,o,r){$.ajax({method:"POST",url:a+"/"+e+"/step/"+t+"/requiresig",dataType:"text",data:{requiresSig:n,CSRFToken:i}}).done(function(e){o(e)}).fail(function(e){r(e)})}}};