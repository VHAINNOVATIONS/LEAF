var form,workflow,formValidator={},LeafForm=function(e){e=e;var a,n,i="LeafForm"+Math.floor(1e3*Math.random())+"_",d=i+"record",r=0;function o(){if(0==r)return console.log("recordID not set"),0;var t=$("#"+a.btnSaveID).html();$("#"+a.btnSaveID).empty().html('<img src="images/indicator.gif" alt="saving" /> Saving...'),$("#"+d).find(":input:disabled").removeAttr("disabled");var o={recordID:r};$("#"+d).serializeArray().map(function(e){o[e.name]=e.value}),$.ajax({type:"POST",url:"ajaxIndex.php?a=domodify",data:o,dataType:"text",success:function(e){null!=n&&n(),$("#"+a.btnSaveID).empty().html(t)},cache:!1})}return $("#"+e).html('<div id="'+i+'xhrDialog" style="display: none; background-color: white; border-style: none solid solid; border-width: 0 1px 1px; border-color: #e0e0e0; padding: 4px">\t\t\t<form id="'+i+'record" enctype="multipart/form-data" action="javascript:void(0);">\t\t\t    <div>\t\t\t        <button id="'+i+'button_cancelchange" class="buttonNorm" style="position: absolute; left: 10px"><img src="../libs/dynicons/?img=process-stop.svg&amp;w=16" alt="cancel" /> Cancel</button>\t\t\t        <button id="'+i+'button_save" class="buttonNorm" style="position: absolute; right: 10px"><img src="../libs/dynicons/?img=media-floppy.svg&amp;w=16" alt="save" /> Save Change</button>\t\t\t        <div style="border-bottom: 2px solid black; line-height: 30px"><br /></div>\t\t\t        <div id="'+i+'loadIndicator" style="visibility: hidden; position: absolute; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; height: 300px; width: 460px">Loading... <img src="images/largespinner.gif" alt="loading..." /></div>\t\t\t        <div id="'+i+'xhr" style="width: 540px; height: 420px; padding: 8px; overflow: auto"></div>\t\t\t    </div>\t\t\t</form>\t\t\t</div>'),a=new dialogController(i+"xhrDialog",i+"xhr",i+"loadIndicator",i+"button_save",i+"button_cancelchange"),{dialog:function(){return a},getHtmlFormID:function(){return d},serializeData:function(){return $("#"+d).serialize()},setRecordID:function(e){r=e},setPostModifyCallback:function(e){n=e},doModify:o,getForm:function(e,t){if(0==r)return console.log("recordID not set"),0;a.indicateBusy(),a.setSaveHandler(function(){o()}),formValidator=new Object,formRequired=new Object,$.ajax({type:"GET",url:"ajaxIndex.php?a=getindicator&recordID="+r+"&indicatorID="+e+"&series="+t,dataType:"text",success:function(e){for(var t in a.setTitle("Editing #"+r),a.setContent(e),formValidator){var o=t.slice(2);a.setValidator(o,formValidator[t].setValidator),a.setValidatorError(o,formValidator[t].setValidatorError),a.setValidatorOk(o,formValidator[t].setValidatorOk)}for(var t in formRequired)o=t.slice(2),a.setRequired(o,formRequired[t].setRequired),a.setRequiredError(o,formRequired[t].setRequiredError),a.setRequiredOk(o,formRequired[t].setRequiredOk);a.enableLiveValidation()},error:function(e){a.setContent("Error: "+e)},cache:!1})},initCustom:function(e,t,o,n,r){a=new dialogController(e,t,o,n,r),i="",d="record"},setHtmlFormID:function(e){d=e}}},workflowModule=new Object,LeafWorkflow=function(a,i){a=a,i=i,Math.floor(1e3*Math.random());var d,s=0,l=0;function c(e){return bgColor=parseInt(e.substring(1),16),r=(16711680&bgColor)>>16,g=(65280&bgColor)>>8,b=255&bgColor,factor=-.1,r+=Math.round(r*factor),g+=Math.round(g*factor),b+=Math.round(b*factor),"#"+((r<<16)+(g<<8)+b).toString(16)}function p(n){if(1==l)return 1;l=1,$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Applying action... <img src="images/largespinner.gif" alt="loading..." /></div>'),$.ajax({type:"POST",url:"api/?a=formWorkflow/"+s+"/apply",data:n,success:function(e){if(0==e.errors.length)$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Action applied!</div>'),$("#workflowbox_dep"+n.dependencyID).hide("blind",500),m(s),null!=d&&d();else{var t="";for(var o in e.errors)t+=e.errors[o]+"<br />";$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%"><img src="../libs/dynicons/?img=dialog-error.svg&w=48" style="vertical-align: middle" alt="error icon" /> '+t+'<br /><span style="font-size: 14px; font-weight: normal">After resolving the errors, <button id="workflowbtn_tryagain" class="buttonNorm">click here to try again</button>.</span></div>'),$("#workflowbtn_tryagain").on("click",function(){m(s)})}l=0},error:function(e){$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Error: Workflow Events may not have triggered</div>')}})}function u(e){var t=null==e.description?"Your workflow is missing a requirement. Please check your workflow.":e.description;for(var o in $("#"+a).append('<div id="workflowbox_dep'+e.dependencyID+'" class="workflowbox">                <span>                <div id="stepDescription_dep'+e.dependencyID+'" style="background-color: '+c(e.stepBgColor)+'; padding: 8px">'+t+'</div>                </span>                <form id="form_dep'+e.dependencyID+'" enctype="multipart/form-data" action="#">                    <div id="form_dep_extension'+e.dependencyID+'"></div>                </form>                </div>'),$("#workflowbox_dep"+e.dependencyID).css({padding:"0px","background-color":e.stepBgColor,border:e.stepBorder}),$("#workflowbox_dep"+e.dependencyID+" span").css({"font-size":"120%","font-weight":"bold",color:e.stepFontColor}),$("#form_dep"+e.dependencyID).append('<div id="form_dep_container'+e.dependencyID+'">                <span class="noprint" aria-label="comments">Comments:</span><br />                <textarea id="comment_dep'+e.dependencyID+'" aria-label="comment text area"></textarea>                </div>'),$("#form_dep_container"+e.dependencyID).css({margin:"auto",width:"95%",padding:"8px"}),$("#workflowbox_dep"+e.dependencyID).append('<br style="clear: both"/>'),$("#comment_dep"+e.dependencyID).css({height:"40px",width:"100%",padding:"4px",resize:"vertical"}),e.dependencyActions){var n="";""!=e.dependencyActions[o].actionIcon&&(n='<img src="../libs/dynicons/?img='+e.dependencyActions[o].actionIcon+'&amp;w=22" alt="'+e.dependencyActions[o].actionText+'" style="vertical-align: middle" />'),$("#form_dep_container"+e.dependencyID).append('<div id="button_container'+e.dependencyID+"_"+e.dependencyActions[o].actionType+'" style="float: '+e.dependencyActions[o].actionAlignment+'">\t\t            <button type="button" id="button_step'+e.dependencyID+"_"+e.dependencyActions[o].actionType+'" class="button">\t\t            '+n+" "+e.dependencyActions[o].actionText+"\t\t            </button>\t\t            </div>"),$("#button_step"+e.dependencyID+"_"+e.dependencyActions[o].actionType).css({border:"1px solid black",padding:"6px",margin:"4px"}),$("#button_step"+e.dependencyID+"_"+e.dependencyActions[o].actionType).on("click",{step:e,idx:o},function(e){var t=new Object;t.comment=$("#comment_dep"+e.data.step.dependencyID).val(),t.actionType=e.data.step.dependencyActions[e.data.idx].actionType,t.dependencyID=e.data.step.dependencyID,t.CSRFToken=i,0<e.data.step.dependencyActions[e.data.idx].fillDependency&&void 0!==workflowModule[e.data.step.dependencyID]?workflowModule[e.data.step.dependencyID].trigger(function(){p(t)}):p(t)})}for(var r in e.jsSrcList)$.ajax({type:"GET",url:e.jsSrcList[r],dataType:"script",success:function(){workflowModule[e.dependencyID].init(s)}})}function f(t){$("#"+a).append('<div id="workflowbox_dep'+t.dependencyID+'" class="workflowbox"></div>'),$("#workflowbox_dep"+t.dependencyID).css({"background-color":t.stepBgColor,border:t.stepBorder,"text-align":"center",padding:"8px"}),-1==t.dependencyID?$.ajax({type:"GET",url:"api/?a=form/customData/_"+recordID+"/_"+t.indicatorID_for_assigned_empUID,success:function(e){$("#workflowbox_dep"+t.dependencyID).append("<span>Pending action from "+e[recordID].s1["id"+t.indicatorID_for_assigned_empUID]+"</span>"),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:t.stepFontColor})}}):-3==t.dependencyID?$.ajax({type:"GET",url:"api/?a=form/customData/_"+recordID+"/_"+t.indicatorID_for_assigned_groupID,success:function(e){$("#workflowbox_dep"+t.dependencyID).append("<span>Pending action from "+t.description+"</span>"),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:t.stepFontColor})}}):($("#workflowbox_dep"+t.dependencyID).append("<span>Pending "+t.description+"</span>"),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:t.stepFontColor}))}function m(n){$("#"+a).empty(),$("#"+a).css("display","none"),l=0,s=n,$.ajax({type:"GET",url:"api/?a=formWorkflow/"+n+"/currentStep",dataType:"json",success:function(e){for(var t in e)1==e[t].hasAccess?u(e[t]):f(e[t]);var o,r;o=n,r=e,$.ajax({type:"GET",url:"api/?a=formWorkflow/"+o+"/lastAction",dataType:"json",success:function(e){if(null==e)return null==r&&$("#"+a).append("No actions available"),null;e.stepBgColor=null==e.stepBgColor?"#e0e0e0":e.stepBgColor,e.stepFontColor=null==e.stepFontColor?"#000000":e.stepFontColor,e.stepBorder=null==e.stepBorder?"1px solid black":e.stepBorder;var t=5==e.dependencyID?e.categoryName:e.description;if(null!=r){5!=e.dependencyID&&($("#"+a).append('<div id="workflowbox_lastAction" class="workflowbox" style="padding: 0px; margin-top: 8px"></div>'),$("#workflowbox_lastAction").css({"background-color":e.stepBgColor,border:e.stepBorder}));var o=new Date(1e3*e.time),n="";null!=e.description&&null!=e.actionText?(n='<div style="background-color: '+c(e.stepBgColor)+'; padding: 4px"><span style="float: left; font-size: 90%">'+t+": "+e.actionTextPasttense+"</span>",n+='<span style="float: right; font-size: 90%">'+o.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+"</span><br /></div>",""!=e.comment&&null!=e.comment&&(n+='<div style="font-size: 80%; padding: 4px 8px 4px 8px">Comment:<br /><div style="font-weight: normal; padding-left: 16px; font-size: 12px">'+e.comment+"</div></div>")):n="[ Please refer to this request's history for current status ]",5!=e.dependencyID&&$("#workflowbox_lastAction").append('<span style="font-weight: bold; color: '+e.stepFontColor+'">'+n+"</span>")}else $("#workflowcontent").append('<div id="workflowbox_lastAction"></div>'),$("#workflowbox_lastAction").css({"background-color":e.stepBgColor,border:e.stepBorder,"text-align":"center",padding:"0px"}),$("#workflowbox_lastAction").addClass("workflowbox"),o=new Date(1e3*e.time),n="",null!=e.description&&null!=e.actionText?(n='<div style="padding: 4px; background-color: '+c(e.stepBgColor)+'">'+t+": "+e.actionTextPasttense,n+='<br /><span style="font-size: 60%">'+o.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+"</span></div>",""!=e.comment&&null!=e.comment&&(n+='<div style="padding: 4px 16px"><fieldset style="border: 1px solid black"><legend class="noprint">Comment</legend><span style="font-size: 80%; font-weight: normal">'+e.comment+"</span></fieldset></div>")):n="[ Please refer to this request's history for current status. ]",$("#workflowbox_lastAction").append('<span style="font-size: 150%; font-weight: bold", color: '+e.stepFontColor+">"+n+"</span>")},cache:!1}),$("#"+a).show("blind",250)},cache:!1})}return{getWorkflow:m,setActionSuccessCallback:function(e){d=e}}},LeafFormGrid=function(s,e){s=s;var p,u,f="LeafFormGrid"+Math.floor(1e3*Math.random())+"_",g=!0,m=[],h=0,l=!1,b=50,y=50,c="#d1dfff",w={},a=null,x=null,v=null,D="",I=!0,k=!1;$("#"+s).html('<div id="'+f+'grid"></div><div id="'+f+'form" style="display: none"></div>'),$("#"+f+"grid").html('<div style="position: relative"><div id="'+f+'gridToolbar" style="display: none; width: 90px; margin: 0 0 0 auto; text-align: right"></div></div><div id="'+f+'table_stickyHeader" style="display: none"></div><table id="'+f+'table" class="leaf_grid"><thead id="'+f+'thead" aria-label="Search Results"></thead><tbody id="'+f+'tbody"></tbody><tfoot id="'+f+'tfoot"></tfoot></table>'),$("#"+f+"thead").css({"background-color":c}),null==e&&(p=new LeafForm(f+"form"));var _=0;function C(o,e){"recordID"!=o&&y!=1/0&&F(0,1/0),$("."+f+"sort").css("display","none"),"asc"==e.toLowerCase()?($("#"+f+"header_"+o+"_sort").html(" &#9650;"),$("#"+f+"header_"+o+"_sort").css("vertical-align","super")):($("#"+f+"header_"+o+"_sort").html(" &#9660;"),$("#"+f+"header_"+o+"_sort").css("vertical-align","sub")),$("#"+f+"header_"+o+"_sort").css("display","inline");var t,n=[],r=$.isNumeric(o),a=!1,i="id"+o;for(var d in m)m[d].recordID=parseInt(m[d].recordID),null==m[d][o]&&(m[d][o]=$("#"+f+m[d].recordID+"_"+o).html(),m[d][o]=null==m[d][o]?"":m[d][o],m[d][o]=m[d][o].replace(/[\u200B-\u200E]/g,"")),r?(null==m[d].s1&&(m[d].s1={}),null!=m[d].s1[i]&&""!=m[d].s1[i]||(null==m[d].sDate&&(m[d].sDate={}),m[d].s1[i]="",m[d].sDate[o]=0),t=null,!isNaN(m[d].s1[i])||-1==m[d].s1[i].indexOf("-")&&-1==m[d].s1[i].indexOf("/")||(t=Date.parse(m[d].s1[i])),(a||null!=t&&!isNaN(t))&&(a=!0,null==m[d].sDate&&(m[d].sDate={}),m[d].sDate[o]=0,m[d].sDate[o]=isNaN(t)?0:t),$.isNumeric(m[d].s1[i])&&(m[d].s1[i]=parseFloat(m[d].s1[i]))):((t=null)==m[d].sDate&&(m[d].sDate={}),m[d].sDate[o]=0,!isNaN(m[d][o])||-1==m[d][o].indexOf("-")&&-1==m[d][o].indexOf("/")||(t=Date.parse(m[d][o])),(a||null!=t&&!isNaN(t))&&(a=!0,m[d].sDate[o]=isNaN(t)||null==t?0:t)),n.push(m[d]);a?n.sort(function(e,t){return t.sDate[o]>e.sDate[o]?1:t.sDate[o]<e.sDate[o]?-1:0}):$.isNumeric(o)?n.sort(function(e,t){return t.s1[i]>e.s1[i]?1:t.s1[i]<e.s1[i]?-1:0}):"recordID"==o?n.sort(function(e,t){return t[o]>e[o]?1:t[o]<e[o]?-1:0}):n.sort(function(e,t){return null==e[o]&&(e[o]=""),null==t[o]&&(t[o]=""),t[o].toLowerCase()>e[o].toLowerCase()?1:t[o].toLowerCase()<e[o].toLowerCase()?-1:0}),"asc"==e&&n.reverse(),m=n}function T(){if(!I)return!1;var t=[];$("#"+f+"thead>tr>th").each(function(){t.push($(this).css("width"))}),$("#"+f+"table_stickyHeader > table").css({width:$("#"+f+"thead").css("width"),height:"30px"}),$("#"+f+"table_stickyHeader > table > thead > tr > th").each(function(e){$(this).css({width:t[e],padding:"2px","font-weight":"normal"})}),$("#"+f+"table_stickyHeader > table").css({border:"1px solid black","border-collapse":"collapse",margin:"0 2px 0"}),$("#"+f+"table_stickyHeader > table > thead > tr").css({"background-color":"black",color:"white"}),$("#"+f+"table_stickyHeader > table > thead > tr > th").css("border","1px solid #e0e0e0")}function F(e,t){k=!0,null!=x&&x(),null==t&&(t=b),y=t;var o=!1;null!=e&&0!=e||(e=0,$("#"+f+"tbody").empty(),o=!0);var n="",r=[],a=g?u.length+1:u.length;0==m.length&&$("#"+f+"tbody").append('<tr><td colspan="'+a+'" style="text-align: center">No Results</td></tr>');for(var i=0,d=e;d<m.length;d++){if(t<=i){h=d;break}for(var s in n+='<tr id="'+f+"tbody_tr"+m[d].recordID+'">',g&&(n+='<td><a href="index.php?a=printview&recordID='+m[d].recordID+'">'+m[d].recordID+"</a></td>"),u)if(0!=u[s].visible)if(null!=m[d]){var l={};l.recordID=m[d].recordID,l.indicatorID=u[s].indicatorID,l.cellContainerID=f+m[d].recordID+"_"+u[s].indicatorID,l.index=d,l.data="";var c=!1;null!=u[s].editable&&0==u[s].editable||(c=!0),$.isNumeric(l.indicatorID)?(null==m[d].s1&&(m[d].s1={}),l.data=null!=m[d].s1["id"+u[s].indicatorID]?m[d].s1["id"+u[s].indicatorID]:"",n+='<td id="'+f+m[d].recordID+"_"+u[s].indicatorID+'" data-editable="'+c+'" data-record-id="'+m[d].recordID+'" data-indicator-id="'+u[s].indicatorID+'">'+l.data+"</td>"):null!=u[s].callback?n+='<td id="'+f+m[d].recordID+"_"+u[s].indicatorID+'" data-clickable="'+c+'"></td>':n+='<td id="'+f+m[d].recordID+"_"+u[s].indicatorID+'"></td>',null!=u[s].callback&&r.push(function(e,t){return function(){e(t,w)}}(u[s].callback,l))}else n+='<td id="'+f+m[d].recordID+"_"+u[s].indicatorID+'"></td>';n+="</tr>",i++,o&&(h=d+1)}for(var d in h+t>=m.length||null==t?$("#"+f+"tfoot").html(""):$("#"+f+"tfoot").html("<tr><td colspan="+a+' style="padding: 8px; background-color: #feffd1; font-size: 120%; font-weight: bold"><img src="'+D+'images/indicator.gif" style="vertical-align: middle" alt="Loading" /> Loading more results...</td></tr>'),$("#"+f+"tbody").append(n),$("#"+f+"tbody td[data-editable=true]").addClass("table_editable"),$("#"+f+"tbody td[data-clickable=true]").addClass("table_editable"),$("#"+f+"tbody").on("click","td[data-editable=true]",function(e){p.setRecordID($(this).data("record-id"));var t=$(this).data("indicator-id");p.setPostModifyCallback(function(){var r,e;r=t,e=1,$.ajax({type:"GET",url:D+"api/?a=form/"+recordID+"/rawIndicator/"+r+"/"+e,dataType:"json",success:function(e){var t=""!=e[r].displayedValue?e[r].displayedValue:e[r].value;if("checkboxes"==e[r].format&&Array.isArray(t)){var o="";for(var n in t)"no"!=t[n]&&(o+=", "+t[n]);t=o.substr(2)}$("#"+f+recordID+"_"+r).empty().html(t),$("#"+f+recordID+"_"+r).fadeOut(250,function(){$("#"+f+recordID+"_"+r).fadeIn(250)})},cache:!1}),p.dialog().hide()}),p.getForm(t,1),p.dialog().show()}),r)r[d]();$("#"+f+"table>tbody>tr>td").css({border:"1px solid black",padding:"8px","font-size":"12px"}),null!=v&&v(),T()}function n(e){l=!0,m=e}function r(e){w=e}return{getPrefixID:function(){return f},form:function(){return p},headers:function(){return u},getCurrentData:function(){return m},hideIndex:function(){g=!1},setHeaders:function(e){u=e;var t='<tr id="'+f+'thead_tr">',o='<tr id="'+f+'tVirt_tr">';for(var n in g&&(t+='<th id="'+f+'header_UID" style="text-align: center">UID</th>',o+='<th style="text-align: center">UID</th>'),$("#"+f+"thead").html(t),g&&($("#"+f+"header_UID").css("cursor","pointer"),$("#"+f+"header_UID").on("click",null,null,function(e){_=0==_?(C("recordID","asc"),1):(C("recordID","desc"),0),F(0,1/0)}),$("#"+f+"header_UID").on("mouseover",null,null,function(e){$("#"+f+"header_UID").css("background-color","#79a2ff")}),$("#"+f+"header_UID").on("mouseout",null,null,function(e){$("#"+f+"header_UID").css({"background-color":c})})),u)if(0!=u[n].visible){var r=null!=u[n].align?u[n].align:"center";$("#"+f+"thead_tr").append('<th id="'+f+"header_"+u[n].indicatorID+'" tabindex="0"  style="text-align:'+r+'">'+u[n].name+'<span id="'+f+"header_"+u[n].indicatorID+'_sort" class="'+f+'sort"></span></th>'),o+='<th id="Vheader_'+u[n].indicatorID+'" style="text-align:'+r+'">'+u[n].name+"</th>",null!=u[n].sortable&&1!=u[n].sortable||($("#"+f+"header_"+u[n].indicatorID).css("cursor","pointer"),$("#"+f+"header_"+u[n].indicatorID).on("click",null,u[n].indicatorID,function(e){_=0==_?(C(e.data,"asc"),1):(C(e.data,"desc"),0),F(0,1/0)}),$("#"+f+"header_"+u[n].indicatorID).on("keydown",null,u[n].indicatorID,function(e){13==e.keyCode&&(_=0==_?(C(e.data,"asc"),1):(C(e.data,"desc"),0),F(0,1/0))}),$("#"+f+"header_"+u[n].indicatorID).on("mouseover",null,u[n].indicatorID,function(e){$("#"+f+"header_"+e.data).css("background-color","#79a2ff")}),$("#"+f+"header_"+u[n].indicatorID).on("mouseout",null,u[n].indicatorID,function(e){$("#"+f+"header_"+e.data).css({"background-color":c})}))}$("#"+f+"thead").append("</tr>"),o+="</tr>",$("#"+f+"table>thead>tr>th").css({border:"1px solid black",padding:"4px 2px 4px 2px","font-size":"12px"});var a,i=!1;$("#"+f+"table_stickyHeader").html("<table><thead>"+o+"</thead></table>"),$(window).on("resize",function(){T()}),$(window).on("scroll",function(){i=!0});var d=[];setInterval(function(){scrollPos=$(window).scrollTop(),tableHeight=$("#"+f+"table").height(),pageHeight=$(window).height(),i&&null!=$("#"+f+"thead").offset()&&I&&(i=!1,a=$("#"+f+"thead").offset().top,scrollPos>a&&scrollPos<tableHeight+a?($("#"+f+"table_stickyHeader").css("display","inline"),$("#"+f+"table_stickyHeader").css({position:"absolute",top:scrollPos+"px"})):$("#"+f+"table_stickyHeader").css("display","none")),scrollPos>tableHeight-.8*pageHeight&&l&&k&&null==d[h]&&(d[h]=1,F(h,b))},100)},sort:C,renderVirtualHeader:T,renderBody:F,loadData:function(e,r){m=[];var t=g?u.length+1:u.length;$("#"+f+"tbody").html('<tr><td colspan="'+t+'" style="text-align: left; padding: 8px">Building report... <img src="'+D+'images/largespinner.gif" alt="loading..." /></td></tr>');var o="";for(var n in u)$.isNumeric(u[n].indicatorID)&&(o+=u[n].indicatorID+",");$.ajax({type:"POST",url:D+"api/?a=form/customData",dataType:"json",data:{recordList:e,indicatorList:o,CSRFToken:CSRFToken},success:function(e){for(var t in l=!0,e){if(null!=w[t])for(var o in w[t])if("object"==typeof w[t][o])for(var n in w[t][o])e[t][o]=e[t][o]||{},e[t][o][n]=w[t][o][n];else e[t][o]=w[t][o];m.push(e[t])}null!=a&&(m=a(m)),C("recordID","desc"),F(0,b),null!=r&&"function"==typeof r&&r()},cache:!1})},setData:n,setDataBlob:r,importQueryResult:function(e){var t=[];for(var o in e)t.push(e[o]);n(t),r(t)},enableToolbar:function(){s=f+"gridToolbar",$("#"+s).css("display","block"),$("#"+s).html('<button type="button" id="'+f+'getExcel" class="buttonNorm"><img src="../libs/dynicons/?img=x-office-spreadsheet.svg&w=32" alt="Icon of Spreadsheet" /> Export</button>'),$("#"+f+"getExcel").on("click",function(){h!=m.length&&F(0,1/0);var o=[],n=[];$("#"+f+"thead>tr>th").each(function(e,t){n.push($(t).text().trim())});var r={},a=0,i=(document.createElement("a"),n.length-1);$("#"+f+"tbody>tr>td").each(function(e,t){r[n[a]]=$(t).text().trim(),0==a&&"UID"==n[a]&&(r[n[a]]='=HYPERLINK("'+window.location.origin+window.location.pathname+"?a=printview&recordID="+$(t).text().trim()+'", "'+$(t).text().trim()+'")'),i<++a&&(o.push(r),r={},a=0)});var e=$(document.createElement("form"));e.attr({action:D+"api/?a=converter/json&format=csv",method:"POST"});var t=$(document.createElement("input")),d=$(document.createElement("input"));t.attr({type:"hidden",name:"input",value:JSON.stringify(o)}),d.attr({type:"hidden",name:"CSRFToken",value:CSRFToken}),e.append(t),e.append(d),e.appendTo("#"+s),e.submit(),e.remove()})},setPostProcessDataFunc:function(e){a=e},setPreRenderFunc:function(e){x=e},setPostRenderFunc:function(e){v=e},setDefaultLimit:function(e){b=e},getDefaultLimit:function(){return b},getDataByIndex:function(e){return m[e]},getDataByRecordID:function(e){for(var t in m)if(m[t].recordID==e)return m[t];return null},disableVirtualHeader:function(){I=!1},stop:function(){k=!1},setRootURL:function(e){D=e}}},LeafFormQuery=function(){var a={},t=null,o="",n=!1;function e(){a={terms:[],joins:[],sort:{},getData:[]}}function r(e,t,o){var n={};n.id=e,n.operator=t,n.match=o,a.terms.push(n)}function i(e,t,o,n){var r={};r.id=e,r.indicatorID=t,r.operator=o,r.match=n,a.terms.push(r)}function d(e){a.limitOffset=e}function s(e){-1==a.joins.indexOf(e)&&a.joins.push(e)}function l(e){-1==a.getData.indexOf(e)&&a.getData.push(e)}return e(),{clearTerms:e,addTerm:r,addDataTerm:i,importQuery:function(e){for(var t in e.terms)switch(Object.keys(e.terms[t]).length){case 3:r(e.terms[t].id,e.terms[t].operator,e.terms[t].match);break;case 4:i(e.terms[t].id,e.terms[t].indicatorID,e.terms[t].operator,e.terms[t].match);break;default:console.log("Format error")}for(var t in e.joins)s(e.joins[t]);for(var t in e.getData)l(e.getData[t])},getQuery:function(){return a},getData:l,updateTerm:function(e,t,o){for(var n in a.terms)if(a.terms[n].id==e&&a.terms[n].operator==t)return void(a.terms[n].match=o);r(e,t,o)},updateDataTerm:function(e,t,o,n){for(var r in a.terms)if(a.terms[r].id==e&&a.terms[r].indicatorID==t&&a.terms[r].operator==o)return void(a.terms[r].match=n);i(e,t,o,n)},setQuery:function(e){a=e},setLimit:function(e,t){void 0===t?a.limit=e:(a.limit=t,d(e))},setLimitOffset:d,setRootURL:function(e){o=e},getRootURL:function(){return o},useJSONP:function(e){n=e},join:s,sort:function(e,t){a.sort.column=e,a.sort.direction=t},onSuccess:function(e){t=e},execute:function(){return null!=a.getData&&0==a.getData.length&&delete a.getData,0==n?$.ajax({type:"GET",url:o+"api/?a=form/query&q="+JSON.stringify(a),dataType:"json",success:t,cache:!1}):$.ajax({type:"GET",url:o+"api/?a=form/query&q="+JSON.stringify(a)+"&format=jsonp",dataType:"jsonp",success:t,cache:!1})}}};function escape(e){var t=e;return t=(t=(t=(t=t.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/"/g,"&quot;")}function diffString(e,t){e=e.replace(/\s+$/,""),t=t.replace(/\s+$/,"");var o=diff(""==e?[]:e.split(/\s+/),""==t?[]:t.split(/\s+/)),n="",r=e.match(/\s+/g);null==r?r=["\n"]:r.push("\n");var a=t.match(/\s+/g);if(null==a?a=["\n"]:a.push("\n"),0==o.n.length)for(var i=0;i<o.o.length;i++)n+='<del style="background:#FFE6E6">'+escape(o.o[i])+r[i]+"</del>";else{if(null==o.n[0].text)for(t=0;t<o.o.length&&null==o.o[t].text;t++)n+='<del style="background:#FFE6E6">'+escape(o.o[t])+r[t]+"</del>";for(i=0;i<o.n.length;i++)if(null==o.n[i].text)n+='<ins style="background:#E6FFE6;">'+escape(o.n[i])+a[i]+"</ins>";else{var d="";for(t=o.n[i].row+1;t<o.o.length&&null==o.o[t].text;t++)d+='<del style="background:#FFE6E6">'+escape(o.o[t])+r[t]+"</del>";n+=" "+o.n[i].text+a[i]+d}}return n}function randomColor(){return"rgb("+100*Math.random()+"%, "+100*Math.random()+"%, "+100*Math.random()+"%)"}function diffString2(e,t){e=e.replace(/\s+$/,""),t=t.replace(/\s+$/,"");var o=diff(""==e?[]:e.split(/\s+/),""==t?[]:t.split(/\s+/)),n=e.match(/\s+/g);null==n?n=["\n"]:n.push("\n");var r=t.match(/\s+/g);null==r?r=["\n"]:r.push("\n");for(var a="",i=new Array,d=0;d<o.o.length;d++)i[d]=randomColor(),null!=o.o[d].text?a+='<span style="background-color: '+i[d]+'">'+escape(o.o[d].text)+n[d]+"</span>":a+='<del style="background:#FFE6E6">'+escape(o.o[d])+n[d]+"</del>";var s="";for(d=0;d<o.n.length;d++)null!=o.n[d].text?s+='<span style="background-color: '+i[o.n[d].row]+'">'+escape(o.n[d].text)+r[d]+"</span>":s+='<ins style="background:#E6FFE6;">'+escape(o.n[d])+r[d]+"</ins>";return{o:a,n:s}}function diff(e,t){for(var o=new Object,n=new Object,r=0;r<t.length;r++)null==o[t[r]]&&(o[t[r]]={rows:new Array,o:null}),o[t[r]].rows.push(r);for(r=0;r<e.length;r++)null==n[e[r]]&&(n[e[r]]={rows:new Array,n:null}),n[e[r]].rows.push(r);for(var r in o)1==o[r].rows.length&&void 0!==n[r]&&1==n[r].rows.length&&(t[o[r].rows[0]]={text:t[o[r].rows[0]],row:n[r].rows[0]},e[n[r].rows[0]]={text:e[n[r].rows[0]],row:o[r].rows[0]});for(r=0;r<t.length-1;r++)null!=t[r].text&&null==t[r+1].text&&t[r].row+1<e.length&&null==e[t[r].row+1].text&&t[r+1]==e[t[r].row+1]&&(t[r+1]={text:t[r+1],row:t[r].row+1},e[t[r].row+1]={text:e[t[r].row+1],row:r+1});for(r=t.length-1;0<r;r--)null!=t[r].text&&null==t[r-1].text&&0<t[r].row&&null==e[t[r].row-1].text&&t[r-1]==e[t[r].row-1]&&(t[r-1]={text:t[r-1],row:t[r].row-1},e[t[r].row-1]={text:e[t[r].row-1],row:r-1});return{o:e,n:t}}