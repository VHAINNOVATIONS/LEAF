var form,workflow,formValidator={},LeafForm=function(e){e=e;var a,n,i="LeafForm"+Math.floor(1e3*Math.random())+"_",d=i+"record",r=0;function o(){if(0==r)return console.log("recordID not set"),0;var t=$("#"+a.btnSaveID).html();$("#"+a.btnSaveID).empty().html('<img src="images/indicator.gif" alt="saving" /> Saving...'),$("#"+d).find(":input:disabled").removeAttr("disabled");var o={recordID:r};$("#"+d).serializeArray().map(function(e){o[e.name]=e.value}),$.ajax({type:"POST",url:"ajaxIndex.php?a=domodify",data:o,dataType:"text",success:function(e){null!=n&&n(),$("#"+a.btnSaveID).empty().html(t)},cache:!1})}return $("#"+e).html('<div id="'+i+'xhrDialog" style="display: none; background-color: white; border-style: none solid solid; border-width: 0 1px 1px; border-color: #e0e0e0; padding: 4px">\t\t\t<form id="'+i+'record" enctype="multipart/form-data" action="javascript:void(0);">\t\t\t    <div>\t\t\t        <button id="'+i+'button_cancelchange" class="buttonNorm" style="position: absolute; left: 10px"><img src="../libs/dynicons/?img=process-stop.svg&amp;w=16" alt="cancel" /> Cancel</button>\t\t\t        <button id="'+i+'button_save" class="buttonNorm" style="position: absolute; right: 10px"><img src="../libs/dynicons/?img=media-floppy.svg&amp;w=16" alt="save" /> Save Change</button>\t\t\t        <div style="border-bottom: 2px solid black; line-height: 30px"><br /></div>\t\t\t        <div id="'+i+'loadIndicator" style="visibility: hidden; position: absolute; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; height: 300px; width: 460px">Loading... <img src="images/largespinner.gif" alt="loading..." /></div>\t\t\t        <div id="'+i+'xhr" style="width: 540px; height: 420px; padding: 8px; overflow: auto"></div>\t\t\t    </div>\t\t\t</form>\t\t\t</div>'),a=new dialogController(i+"xhrDialog",i+"xhr",i+"loadIndicator",i+"button_save",i+"button_cancelchange"),{dialog:function(){return a},getHtmlFormID:function(){return d},serializeData:function(){return $("#"+d).serialize()},setRecordID:function(e){r=e},setPostModifyCallback:function(e){n=e},doModify:o,getForm:function(e,t){if(0==r)return console.log("recordID not set"),0;a.indicateBusy(),a.setSaveHandler(function(){o()}),formValidator=new Object,formRequired=new Object,$.ajax({type:"GET",url:"ajaxIndex.php?a=getindicator&recordID="+r+"&indicatorID="+e+"&series="+t,dataType:"text",success:function(e){for(var t in a.setTitle("Editing #"+r),a.setContent(e),formValidator){var o=t.slice(2);a.setValidator(o,formValidator[t].setValidator),a.setValidatorError(o,formValidator[t].setValidatorError),a.setValidatorOk(o,formValidator[t].setValidatorOk)}for(var t in formRequired)o=t.slice(2),a.setRequired(o,formRequired[t].setRequired),a.setRequiredError(o,formRequired[t].setRequiredError),a.setRequiredOk(o,formRequired[t].setRequiredOk);a.enableLiveValidation()},error:function(e){a.setContent("Error: "+e)},cache:!1})},initCustom:function(e,t,o,n,r){a=new dialogController(e,t,o,n,r),i="",d="record"},setHtmlFormID:function(e){d=e}}},workflowModule=new Object,LeafWorkflow=function(a,i){a=a,i=i,Math.floor(1e3*Math.random());var d,l=0,s=0;function c(e){return bgColor=parseInt(e.substring(1),16),r=(16711680&bgColor)>>16,g=(65280&bgColor)>>8,b=255&bgColor,factor=-.1,r+=Math.round(r*factor),g+=Math.round(g*factor),b+=Math.round(b*factor),"#"+((r<<16)+(g<<8)+b).toString(16)}function p(n){if(1==s)return 1;s=1,$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Applying action... <img src="images/largespinner.gif" alt="loading..." /></div>'),$.ajax({type:"POST",url:"api/?a=formWorkflow/"+l+"/apply",data:n,success:function(e){if(0==e.errors.length)$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Action applied!</div>'),$("#workflowbox_dep"+n.dependencyID).hide("blind",500),h(l),null!=d&&d();else{var t="";for(var o in e.errors)t+=e.errors[o]+"<br />";$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%"><img src="../libs/dynicons/?img=dialog-error.svg&w=48" style="vertical-align: middle" alt="error icon" /> '+t+'<br /><span style="font-size: 14px; font-weight: normal">After resolving the errors, <button id="workflowbtn_tryagain" class="buttonNorm">click here to try again</button>.</span></div>'),$("#workflowbtn_tryagain").on("click",function(){h(l)})}s=0},error:function(e){$("#workflowbox_dep"+n.dependencyID).html('<div style="border: 2px solid black; text-align: center; font-size: 24px; font-weight: bold; background: white; padding: 16px; width: 95%">Error: Workflow Events may not have triggered</div>')}})}function u(e){var t=null==e.description?"Your workflow is missing a requirement. Please check your workflow.":e.description;for(var o in $("#"+a).append('<div id="workflowbox_dep'+e.dependencyID+'" class="workflowbox">                <span>                <div id="stepDescription_dep'+e.dependencyID+'" style="background-color: '+c(e.stepBgColor)+'; padding: 8px">'+t+'</div>                </span>                <form id="form_dep'+e.dependencyID+'" enctype="multipart/form-data" action="#">                    <div id="form_dep_extension'+e.dependencyID+'"></div>                </form>                </div>'),$("#workflowbox_dep"+e.dependencyID).css({padding:"0px","background-color":e.stepBgColor,border:e.stepBorder}),$("#workflowbox_dep"+e.dependencyID+" span").css({"font-size":"120%","font-weight":"bold",color:e.stepFontColor}),$("#form_dep"+e.dependencyID).append('<div id="form_dep_container'+e.dependencyID+'">                <span class="noprint" aria-label="comments">Comments:</span><br />                <textarea id="comment_dep'+e.dependencyID+'" aria-label="comment text area"></textarea>                </div>'),$("#form_dep_container"+e.dependencyID).css({margin:"auto",width:"95%",padding:"8px"}),$("#workflowbox_dep"+e.dependencyID).append('<br style="clear: both"/>'),$("#comment_dep"+e.dependencyID).css({height:"40px",width:"100%",padding:"4px",resize:"vertical"}),e.dependencyActions){var n="";""!=e.dependencyActions[o].actionIcon&&(n='<img src="../libs/dynicons/?img='+e.dependencyActions[o].actionIcon+'&amp;w=22" alt="'+e.dependencyActions[o].actionText+'" style="vertical-align: middle" />'),$("#form_dep_container"+e.dependencyID).append('<div id="button_container'+e.dependencyID+"_"+e.dependencyActions[o].actionType+'" style="float: '+e.dependencyActions[o].actionAlignment+'">\t\t            <button type="button" id="button_step'+e.dependencyID+"_"+e.dependencyActions[o].actionType+'" class="button">\t\t            '+n+" "+e.dependencyActions[o].actionText+"\t\t            </button>\t\t            </div>"),$("#button_step"+e.dependencyID+"_"+e.dependencyActions[o].actionType).css({border:"1px solid black",padding:"6px",margin:"4px"}),$("#button_step"+e.dependencyID+"_"+e.dependencyActions[o].actionType).on("click",{step:e,idx:o},function(e){var t=new Object;t.comment=$("#comment_dep"+e.data.step.dependencyID).val(),t.actionType=e.data.step.dependencyActions[e.data.idx].actionType,t.dependencyID=e.data.step.dependencyID,t.CSRFToken=i,0<e.data.step.dependencyActions[e.data.idx].fillDependency&&void 0!==workflowModule[e.data.step.dependencyID]?workflowModule[e.data.step.dependencyID].trigger(function(){p(t)}):p(t)})}for(var r in e.jsSrcList)$.ajax({type:"GET",url:e.jsSrcList[r],dataType:"script",success:function(){workflowModule[e.dependencyID].init(l)}})}function f(t){$("#"+a).append('<div id="workflowbox_dep'+t.dependencyID+'" class="workflowbox"></div>'),$("#workflowbox_dep"+t.dependencyID).css({"background-color":t.stepBgColor,border:t.stepBorder,"text-align":"center",padding:"8px"}),-1==t.dependencyID?$.ajax({type:"GET",url:"api/?a=form/customData/_"+recordID+"/_"+t.indicatorID_for_assigned_empUID,success:function(e){$("#workflowbox_dep"+t.dependencyID).append("<span>Pending action from "+e[recordID].s1["id"+t.indicatorID_for_assigned_empUID]+"</span>"),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:t.stepFontColor})}}):-3==t.dependencyID?$.ajax({type:"GET",url:"api/?a=form/customData/_"+recordID+"/_"+t.indicatorID_for_assigned_groupID,success:function(e){$("#workflowbox_dep"+t.dependencyID).append("<span>Pending action from "+t.description+"</span>"),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:t.stepFontColor})}}):($("#workflowbox_dep"+t.dependencyID).append("<span>Pending "+t.description+"</span>"),$("#workflowbox_dep"+t.dependencyID+" span").css({"font-size":"150%","font-weight":"bold",color:t.stepFontColor}))}function h(n){$("#"+a).empty(),$("#"+a).css("display","none"),s=0,l=n,$.ajax({type:"GET",url:"api/?a=formWorkflow/"+n+"/currentStep",dataType:"json",success:function(e){for(var t in e)1==e[t].hasAccess?u(e[t]):f(e[t]);var o,r;o=n,r=e,$.ajax({type:"GET",url:"api/?a=formWorkflow/"+o+"/lastAction",dataType:"json",success:function(e){if(null==e)return null==r&&$("#"+a).append("No actions available"),null;e.stepBgColor=null==e.stepBgColor?"#e0e0e0":e.stepBgColor,e.stepFontColor=null==e.stepFontColor?"#000000":e.stepFontColor,e.stepBorder=null==e.stepBorder?"1px solid black":e.stepBorder;var t=5==e.dependencyID?e.categoryName:e.description;if(null!=r){5!=e.dependencyID&&($("#"+a).append('<div id="workflowbox_lastAction" class="workflowbox" style="padding: 0px; margin-top: 8px"></div>'),$("#workflowbox_lastAction").css({"background-color":e.stepBgColor,border:e.stepBorder}));var o=new Date(1e3*e.time),n="";null!=e.description&&null!=e.actionText?(n='<div style="background-color: '+c(e.stepBgColor)+'; padding: 4px"><span style="float: left; font-size: 90%">'+t+": "+e.actionTextPasttense+"</span>",n+='<span style="float: right; font-size: 90%">'+o.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+"</span><br /></div>",""!=e.comment&&null!=e.comment&&(n+='<div style="font-size: 80%; padding: 4px 8px 4px 8px">Comment:<br /><div style="font-weight: normal; padding-left: 16px; font-size: 12px">'+e.comment+"</div></div>")):n="[ Please refer to this request's history for current status ]",5!=e.dependencyID&&$("#workflowbox_lastAction").append('<span style="font-weight: bold; color: '+e.stepFontColor+'">'+n+"</span>")}else $("#workflowcontent").append('<div id="workflowbox_lastAction"></div>'),$("#workflowbox_lastAction").css({"background-color":e.stepBgColor,border:e.stepBorder,"text-align":"center",padding:"0px"}),$("#workflowbox_lastAction").addClass("workflowbox"),o=new Date(1e3*e.time),n="",null!=e.description&&null!=e.actionText?(n='<div style="padding: 4px; background-color: '+c(e.stepBgColor)+'">'+t+": "+e.actionTextPasttense,n+='<br /><span style="font-size: 60%">'+o.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+"</span></div>",""!=e.comment&&null!=e.comment&&(n+='<div style="padding: 4px 16px"><fieldset style="border: 1px solid black"><legend class="noprint">Comment</legend><span style="font-size: 80%; font-weight: normal">'+e.comment+"</span></fieldset></div>")):n="[ Please refer to this request's history for current status. ]",$("#workflowbox_lastAction").append('<span style="font-size: 150%; font-weight: bold", color: '+e.stepFontColor+">"+n+"</span>")},cache:!1}),$("#"+a).show("blind",250)},cache:!1})}return{getWorkflow:h,setActionSuccessCallback:function(e){d=e}}},LeafFormGrid=function(l,e){l=l;var p,u,f="LeafFormGrid"+Math.floor(1e3*Math.random())+"_",b=!0,g=[],h=0,s=!1,m=50,y=50,c="#d1dfff",x={},a=null,D=null,w=null,v="",I=!0,_=!1;$("#"+l).html('<div id="'+f+'grid"></div><div id="'+f+'form" style="display: none"></div>'),$("#"+f+"grid").html('<div style="position: relative"><div id="'+f+'gridToolbar" style="display: none; width: 90px; margin: 0 0 0 auto; text-align: right"></div></div><div id="'+f+'table_stickyHeader" style="display: none"></div><table id="'+f+'table" class="leaf_grid"><thead id="'+f+'thead" aria-label="Search Results"></thead><tbody id="'+f+'tbody"></tbody><tfoot id="'+f+'tfoot"></tfoot></table>'),$("#"+f+"thead").css({"background-color":c}),null==e&&(p=new LeafForm(f+"form"));var k=0;function C(o,e){"recordID"!=o&&y!=1/0&&A(0,1/0),$("."+f+"sort").css("display","none"),"asc"==e.toLowerCase()?($("#"+f+"header_"+o+"_sort").html(" &#9650;"),$("#"+f+"header_"+o+"_sort").css("vertical-align","super")):($("#"+f+"header_"+o+"_sort").html(" &#9660;"),$("#"+f+"header_"+o+"_sort").css("vertical-align","sub")),$("#"+f+"header_"+o+"_sort").css("display","inline");var t,n=[],r=$.isNumeric(o),a=!1,i="id"+o;for(var d in g)g[d].recordID=parseInt(g[d].recordID),null==g[d][o]&&(g[d][o]=$("#"+f+g[d].recordID+"_"+o).html(),g[d][o]=null==g[d][o]?"":g[d][o],g[d][o]=g[d][o].replace(/[\u200B-\u200E]/g,"")),r?(null==g[d].s1&&(g[d].s1={}),null!=g[d].s1[i]&&""!=g[d].s1[i]||(null==g[d].sDate&&(g[d].sDate={}),g[d].s1[i]="",g[d].sDate[o]=0),t=null,!isNaN(g[d].s1[i])||-1==g[d].s1[i].indexOf("-")&&-1==g[d].s1[i].indexOf("/")||(t=Date.parse(g[d].s1[i])),(a||null!=t&&!isNaN(t))&&(a=!0,null==g[d].sDate&&(g[d].sDate={}),g[d].sDate[o]=0,g[d].sDate[o]=isNaN(t)?0:t),$.isNumeric(g[d].s1[i])&&(g[d].s1[i]=parseFloat(g[d].s1[i]))):((t=null)==g[d].sDate&&(g[d].sDate={}),g[d].sDate[o]=0,!isNaN(g[d][o])||-1==g[d][o].indexOf("-")&&-1==g[d][o].indexOf("/")||(t=Date.parse(g[d][o])),(a||null!=t&&!isNaN(t))&&(a=!0,g[d].sDate[o]=isNaN(t)||null==t?0:t)),n.push(g[d]);a?n.sort(function(e,t){return t.sDate[o]>e.sDate[o]?1:t.sDate[o]<e.sDate[o]?-1:0}):$.isNumeric(o)?n.sort(function(e,t){return t.s1[i]>e.s1[i]?1:t.s1[i]<e.s1[i]?-1:0}):"recordID"==o?n.sort(function(e,t){return t[o]>e[o]?1:t[o]<e[o]?-1:0}):n.sort(function(e,t){return null==e[o]&&(e[o]=""),null==t[o]&&(t[o]=""),t[o].toLowerCase()>e[o].toLowerCase()?1:t[o].toLowerCase()<e[o].toLowerCase()?-1:0}),"asc"==e&&n.reverse(),g=n}function T(){if(!I)return!1;var t=[];$("#"+f+"thead>tr>th").each(function(){t.push($(this).css("width"))}),$("#"+f+"table_stickyHeader > table").css({width:$("#"+f+"thead").css("width"),height:"30px"}),$("#"+f+"table_stickyHeader > table > thead > tr > th").each(function(e){$(this).css({width:t[e],padding:"2px","font-weight":"normal"})}),$("#"+f+"table_stickyHeader > table").css({border:"1px solid black","border-collapse":"collapse",margin:"0 2px 0"}),$("#"+f+"table_stickyHeader > table > thead > tr").css({"background-color":"black",color:"white"}),$("#"+f+"table_stickyHeader > table > thead > tr > th").css("border","1px solid #e0e0e0")}function A(e,t){_=!0,null!=D&&D(),null==t&&(t=m),y=t;var o=!1;null!=e&&0!=e||(e=0,$("#"+f+"tbody").empty(),o=!0);var n="",r=[],a=b?u.length+1:u.length;0==g.length&&$("#"+f+"tbody").append('<tr><td colspan="'+a+'" style="text-align: center">No Results</td></tr>');for(var i=0,d=e;d<g.length;d++){if(t<=i){h=d;break}for(var l in n+='<tr id="'+f+"tbody_tr"+g[d].recordID+'">',b&&(n+='<td><a href="index.php?a=printview&recordID='+g[d].recordID+'">'+g[d].recordID+"</a></td>"),u)if(0!=u[l].visible)if(null!=g[d]){var s={};s.recordID=g[d].recordID,s.indicatorID=u[l].indicatorID,s.cellContainerID=f+g[d].recordID+"_"+u[l].indicatorID,s.index=d,s.data="";var c=!1;null!=u[l].editable&&0==u[l].editable||(c=!0),$.isNumeric(s.indicatorID)?(null==g[d].s1&&(g[d].s1={}),s.data=null!=g[d].s1["id"+u[l].indicatorID]?g[d].s1["id"+u[l].indicatorID]:"",n+='<td id="'+f+g[d].recordID+"_"+u[l].indicatorID+'" data-editable="'+c+'" data-record-id="'+g[d].recordID+'" data-indicator-id="'+u[l].indicatorID+'">'+s.data+"</td>"):null!=u[l].callback?n+='<td id="'+f+g[d].recordID+"_"+u[l].indicatorID+'" data-clickable="'+c+'"></td>':n+='<td id="'+f+g[d].recordID+"_"+u[l].indicatorID+'"></td>',null!=u[l].callback&&r.push(function(e,t){return function(){e(t,x)}}(u[l].callback,s))}else n+='<td id="'+f+g[d].recordID+"_"+u[l].indicatorID+'"></td>';n+="</tr>",i++,o&&(h=d+1)}for(var d in h+t>=g.length||null==t?$("#"+f+"tfoot").html(""):$("#"+f+"tfoot").html("<tr><td colspan="+a+' style="padding: 8px; background-color: #feffd1; font-size: 120%; font-weight: bold"><img src="'+v+'images/indicator.gif" style="vertical-align: middle" alt="Loading" /> Loading more results...</td></tr>'),$("#"+f+"tbody").append(n),$("#"+f+"tbody td[data-editable=true]").addClass("table_editable"),$("#"+f+"tbody td[data-clickable=true]").addClass("table_editable"),$("#"+f+"tbody").on("click","td[data-editable=true]",function(e){p.setRecordID($(this).data("record-id"));var t=$(this).data("indicator-id");p.setPostModifyCallback(function(){var r,e;r=t,e=1,$.ajax({type:"GET",url:v+"api/?a=form/"+recordID+"/rawIndicator/"+r+"/"+e,dataType:"json",success:function(e){var t=""!=e[r].displayedValue?e[r].displayedValue:e[r].value;if("checkboxes"==e[r].format&&Array.isArray(t)){var o="";for(var n in t)"no"!=t[n]&&(o+=", "+t[n]);t=o.substr(2)}$("#"+f+recordID+"_"+r).empty().html(t),$("#"+f+recordID+"_"+r).fadeOut(250,function(){$("#"+f+recordID+"_"+r).fadeIn(250)})},cache:!1}),p.dialog().hide()}),p.getForm(t,1),p.dialog().show()}),r)r[d]();$("#"+f+"table>tbody>tr>td").css({border:"1px solid black",padding:"8px","font-size":"12px"}),null!=w&&w(),T()}function n(e){s=!0,g=e}function r(e){x=e}return{getPrefixID:function(){return f},form:function(){return p},headers:function(){return u},getCurrentData:function(){return g},hideIndex:function(){b=!1},setHeaders:function(e){u=e;var t='<tr id="'+f+'thead_tr">',o='<tr id="'+f+'tVirt_tr">';for(var n in b&&(t+='<th id="'+f+'header_UID" style="text-align: center">UID</th>',o+='<th style="text-align: center">UID</th>'),$("#"+f+"thead").html(t),b&&($("#"+f+"header_UID").css("cursor","pointer"),$("#"+f+"header_UID").on("click",null,null,function(e){k=0==k?(C("recordID","asc"),1):(C("recordID","desc"),0),A(0,1/0)}),$("#"+f+"header_UID").on("mouseover",null,null,function(e){$("#"+f+"header_UID").css("background-color","#79a2ff")}),$("#"+f+"header_UID").on("mouseout",null,null,function(e){$("#"+f+"header_UID").css({"background-color":c})})),u)if(0!=u[n].visible){var r=null!=u[n].align?u[n].align:"center";$("#"+f+"thead_tr").append('<th id="'+f+"header_"+u[n].indicatorID+'" tabindex="0"  style="text-align:'+r+'">'+u[n].name+'<span id="'+f+"header_"+u[n].indicatorID+'_sort" class="'+f+'sort"></span></th>'),o+='<th id="Vheader_'+u[n].indicatorID+'" style="text-align:'+r+'">'+u[n].name+"</th>",null!=u[n].sortable&&1!=u[n].sortable||($("#"+f+"header_"+u[n].indicatorID).css("cursor","pointer"),$("#"+f+"header_"+u[n].indicatorID).on("click",null,u[n].indicatorID,function(e){k=0==k?(C(e.data,"asc"),1):(C(e.data,"desc"),0),A(0,1/0)}),$("#"+f+"header_"+u[n].indicatorID).on("keydown",null,u[n].indicatorID,function(e){13==e.keyCode&&(k=0==k?(C(e.data,"asc"),1):(C(e.data,"desc"),0),A(0,1/0))}),$("#"+f+"header_"+u[n].indicatorID).on("mouseover",null,u[n].indicatorID,function(e){$("#"+f+"header_"+e.data).css("background-color","#79a2ff")}),$("#"+f+"header_"+u[n].indicatorID).on("mouseout",null,u[n].indicatorID,function(e){$("#"+f+"header_"+e.data).css({"background-color":c})}))}$("#"+f+"thead").append("</tr>"),o+="</tr>",$("#"+f+"table>thead>tr>th").css({border:"1px solid black",padding:"4px 2px 4px 2px","font-size":"12px"});var a,i=!1;$("#"+f+"table_stickyHeader").html("<table><thead>"+o+"</thead></table>"),$(window).on("resize",function(){T()}),$(window).on("scroll",function(){i=!0});var d=[];setInterval(function(){scrollPos=$(window).scrollTop(),tableHeight=$("#"+f+"table").height(),pageHeight=$(window).height(),i&&null!=$("#"+f+"thead").offset()&&I&&(i=!1,a=$("#"+f+"thead").offset().top,scrollPos>a&&scrollPos<tableHeight+a?($("#"+f+"table_stickyHeader").css("display","inline"),$("#"+f+"table_stickyHeader").css({position:"absolute",top:scrollPos+"px"})):$("#"+f+"table_stickyHeader").css("display","none")),scrollPos>tableHeight-.8*pageHeight&&s&&_&&null==d[h]&&(d[h]=1,A(h,m))},100)},sort:C,renderVirtualHeader:T,renderBody:A,loadData:function(e,r){g=[];var t=b?u.length+1:u.length;$("#"+f+"tbody").html('<tr><td colspan="'+t+'" style="text-align: left; padding: 8px">Building report... <img src="'+v+'images/largespinner.gif" alt="loading..." /></td></tr>');var o="";for(var n in u)$.isNumeric(u[n].indicatorID)&&(o+=u[n].indicatorID+",");$.ajax({type:"POST",url:v+"api/?a=form/customData",dataType:"json",data:{recordList:e,indicatorList:o,CSRFToken:CSRFToken},success:function(e){for(var t in s=!0,e){if(null!=x[t])for(var o in x[t])if("object"==typeof x[t][o])for(var n in x[t][o])e[t][o]=e[t][o]||{},e[t][o][n]=x[t][o][n];else e[t][o]=x[t][o];g.push(e[t])}null!=a&&(g=a(g)),C("recordID","desc"),A(0,m),null!=r&&"function"==typeof r&&r()},cache:!1})},setData:n,setDataBlob:r,importQueryResult:function(e){var t=[];for(var o in e)t.push(e[o]);n(t),r(t)},enableToolbar:function(){l=f+"gridToolbar",$("#"+l).css("display","block"),$("#"+l).html('<button type="button" id="'+f+'getExcel" class="buttonNorm"><img src="../libs/dynicons/?img=x-office-spreadsheet.svg&w=32" alt="Icon of Spreadsheet" /> Export</button>'),$("#"+f+"getExcel").on("click",function(){h!=g.length&&A(0,1/0);var o=[],n=[];$("#"+f+"thead>tr>th").each(function(e,t){n.push($(t).text().trim())});var r={},a=0,i=(document.createElement("a"),n.length-1);$("#"+f+"tbody>tr>td").each(function(e,t){r[n[a]]=$(t).text().trim(),0==a&&"UID"==n[a]&&(r[n[a]]='=HYPERLINK("'+window.location.origin+window.location.pathname+"?a=printview&recordID="+$(t).text().trim()+'", "'+$(t).text().trim()+'")'),i<++a&&(o.push(r),r={},a=0)});var e=$(document.createElement("form"));e.attr({action:v+"api/?a=converter/json&format=csv",method:"POST"});var t=$(document.createElement("input")),d=$(document.createElement("input"));t.attr({type:"hidden",name:"input",value:JSON.stringify(o)}),d.attr({type:"hidden",name:"CSRFToken",value:CSRFToken}),e.append(t),e.append(d),e.appendTo("#"+l),e.submit(),e.remove()})},setPostProcessDataFunc:function(e){a=e},setPreRenderFunc:function(e){D=e},setPostRenderFunc:function(e){w=e},setDefaultLimit:function(e){m=e},getDefaultLimit:function(){return m},getDataByIndex:function(e){return g[e]},getDataByRecordID:function(e){for(var t in g)if(g[t].recordID==e)return g[t];return null},disableVirtualHeader:function(){I=!1},stop:function(){_=!1},setRootURL:function(e){v=e}}};